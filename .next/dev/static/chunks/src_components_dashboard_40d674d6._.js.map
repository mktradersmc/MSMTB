{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/dashboard/SystemView.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Activity, Zap, Shield, Database, Clock, RefreshCw, FileText, Monitor, Moon, Sun } from 'lucide-react';\r\nimport { useTheme } from '../../context/ThemeProvider';\r\nimport { useChartTheme } from '../../context/ChartThemeContext';\r\nimport { fetchDirect } from '../../lib/client-api';\r\n\r\ninterface Features {\r\n    ENABLE_STARTUP_RESTORATION: boolean;\r\n    ENABLE_STARTUP_SANITY_CHECK: boolean;\r\n    ENABLE_PERIODIC_SANITY_CHECK: boolean;\r\n    ENABLE_REGISTRATION_SANITY_CHECK: boolean;\r\n    ENABLE_CONSISTENCY_SCHEDULER: boolean;\r\n    ENABLE_DEEP_HISTORY_SYNC: boolean;\r\n    ENABLE_TICK_LOGGING: boolean;\r\n    ENABLE_INDICATOR_LOGGING: boolean;\r\n}\r\n\r\nexport function SystemView() {\r\n    const { theme, setTheme } = useTheme();\r\n    const { mode: chartMode, setMode: setChartMode } = useChartTheme();\r\n    const [features, setFeatures] = useState<Features | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n\r\n    useEffect(() => {\r\n        loadFeatures();\r\n    }, []);\r\n\r\n    const loadFeatures = async () => {\r\n        try {\r\n            const res = await fetchDirect('/features');\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setFeatures(data.features);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Failed to load features\", e);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const toggleFeature = async (key: keyof Features) => {\r\n        if (!features) return;\r\n\r\n        const newValue = !features[key];\r\n        const newFeatures = { ...features, [key]: newValue };\r\n        setFeatures(newFeatures); // Optimistic update\r\n\r\n        try {\r\n            setIsSaving(true);\r\n            await fetchDirect('/features', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ [key]: newValue })\r\n            });\r\n        } catch (e) {\r\n            console.error(\"Failed to save feature\", e);\r\n            // Revert on error\r\n            setFeatures(features);\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const FeatureCard = ({ id, label, desc, icon: Icon, colorClass }: { id: keyof Features, label: string, desc: string, icon: any, colorClass: string }) => (\r\n        <div className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-6 flex justify-between items-start hover:border-slate-300 dark:hover:border-slate-700 transition-all shadow-sm\">\r\n            <div className=\"flex gap-4\">\r\n                <div className={`w-12 h-12 rounded-lg ${colorClass} bg-opacity-10 flex items-center justify-center shrink-0 border border-white/5`}>\r\n                    <Icon className={colorClass} size={24} />\r\n                </div>\r\n                <div>\r\n                    <h3 className=\"font-bold text-slate-900 dark:text-slate-200 text-lg\">{label}</h3>\r\n                    <p className=\"text-slate-500 text-sm mt-1 max-w-md\">{desc}</p>\r\n                </div>\r\n            </div>\r\n\r\n            <button\r\n                onClick={() => toggleFeature(id)}\r\n                className={`w-14 h-7 rounded-full transition-colors relative ${features?.[id] ? 'bg-indigo-600' : 'bg-slate-200 dark:bg-slate-700'}`}\r\n            >\r\n                <div className={`absolute top-1 w-5 h-5 rounded-full bg-white transition-transform ${features?.[id] ? 'left-8' : 'left-1'}`} />\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n    if (isLoading) return <div className=\"h-full flex items-center justify-center text-slate-500\">Loading Configuration...</div>;\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col p-8 animate-in fade-in zoom-in-95 duration-300 overflow-y-auto\">\r\n            <header className=\"mb-8 border-b border-slate-200 dark:border-slate-800 pb-6\">\r\n                <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3\">\r\n                    <Activity className=\"text-indigo-600 dark:text-indigo-400\" /> System Performance\r\n                </h2>\r\n                <p className=\"text-slate-500 dark:text-slate-400 mt-1\">Manage core process isolation and background services.</p>\r\n            </header>\r\n\r\n            <div className=\"space-y-8 max-w-4xl\">\r\n                {/* Visual Settings */}\r\n                <div>\r\n                    <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 pl-1\">Appearance</h3>\r\n                    <section className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-6 shadow-sm\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            {/* Platform Theme */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">Platform Theme</label>\r\n                                <div className=\"relative\">\r\n                                    <select\r\n                                        value={theme}\r\n                                        onChange={(e) => setTheme(e.target.value as any)}\r\n                                        className=\"w-full appearance-none bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 text-slate-900 dark:text-white rounded-lg px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all cursor-pointer\"\r\n                                    >\r\n                                        <option value=\"dark\">Dark Mode</option>\r\n                                        <option value=\"light\">Light Mode</option>\r\n                                    </select>\r\n                                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500\">\r\n                                        {theme === 'light' ? <Sun size={18} /> : <Moon size={18} />}\r\n                                    </div>\r\n                                </div>\r\n                                <p className=\"text-xs text-slate-500 mt-2\">Controls the overall application colors.</p>\r\n                            </div>\r\n\r\n                            {/* Chart Theme */}\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">Chart Theme</label>\r\n                                <div className=\"relative\">\r\n                                    <select\r\n                                        value={chartMode}\r\n                                        onChange={(e) => setChartMode(e.target.value as 'light' | 'dark')}\r\n                                        className=\"w-full appearance-none bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 text-slate-900 dark:text-white rounded-lg px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all cursor-pointer\"\r\n                                    >\r\n                                        <option value=\"light\">Light Mode</option>\r\n                                        <option value=\"dark\">Dark Mode</option>\r\n                                    </select>\r\n                                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500\">\r\n                                        {chartMode === 'light' ? <Sun size={18} /> : <Moon size={18} />}\r\n                                    </div>\r\n                                </div>\r\n                                <p className=\"text-xs text-slate-500 mt-2\">Controls the colors of trading charts.</p>\r\n                            </div>\r\n                        </div>\r\n                    </section>\r\n                </div>\r\n\r\n                {/* Startup Section */}\r\n                <div>\r\n                    <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 pl-1\">Startup & Initialization</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <FeatureCard\r\n                            id=\"ENABLE_STARTUP_RESTORATION\"\r\n                            label=\"Startup Cache Restoration\"\r\n                            desc=\"Immediately restores known symbols from the Broker Cache on startup (500ms), bypassing the need to wait for bots to report in.\"\r\n                            icon={Database}\r\n                            colorClass=\"text-blue-400\"\r\n                        />\r\n                        <FeatureCard\r\n                            id=\"ENABLE_STARTUP_SANITY_CHECK\"\r\n                            label=\"Startup Sanity Sweep\"\r\n                            desc=\"Triggers a full Sanity Check 10 seconds after server boot to verify data integrity across all registered bots.\"\r\n                            icon={Shield}\r\n                            colorClass=\"text-emerald-400\"\r\n                        />\r\n                        <FeatureCard\r\n                            id=\"ENABLE_REGISTRATION_SANITY_CHECK\"\r\n                            label=\"Registration Integrity Check\"\r\n                            desc=\"Automatically runs a Sanity Check whenever a new Bot registers or reconnects.\"\r\n                            icon={RefreshCw}\r\n                            colorClass=\"text-teal-400\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Runtime Section */}\r\n                <div>\r\n                    <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 pl-1 mt-8\">Runtime & Background</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <FeatureCard\r\n                            id=\"ENABLE_CONSISTENCY_SCHEDULER\"\r\n                            label=\"Consistency Scheduler\"\r\n                            desc=\"Enables the background scheduler that runs Minutely (Recent) and Hourly (Deep) gap checks.\"\r\n                            icon={Clock}\r\n                            colorClass=\"text-amber-400\"\r\n                        />\r\n                        <FeatureCard\r\n                            id=\"ENABLE_PERIODIC_SANITY_CHECK\"\r\n                            label=\"Periodic Heartbeat Audit\"\r\n                            desc=\"Runs a Sanity Check every 5 minutes if triggered by a Bot Heartbeat.\"\r\n                            icon={Activity}\r\n                            colorClass=\"text-purple-400\"\r\n                        />\r\n                        <FeatureCard\r\n                            id=\"ENABLE_DEEP_HISTORY_SYNC\"\r\n                            label=\"Deep History Sync\"\r\n                            desc=\"Allows the system to recursively fetch deep history (years back) when new data is ingested.\"\r\n                            icon={Zap}\r\n                            colorClass=\"text-orange-400\"\r\n                        />\r\n                        <FeatureCard\r\n                            id=\"ENABLE_TICK_LOGGING\"\r\n                            label=\"Verbose Tick Logging\"\r\n                            desc=\"Enables detailed console logging for every tick emitted to the frontend. Default is OFF to reduce noise.\"\r\n                            icon={FileText}\r\n                            colorClass=\"text-pink-400\"\r\n                        />\r\n                        <FeatureCard\r\n                            id=\"ENABLE_INDICATOR_LOGGING\"\r\n                            label=\"Detailed Indicator Logging\"\r\n                            desc=\"Enables detailed logs for indicator calculations (e.g. ICT Sessions). Default is OFF.\"\r\n                            icon={Activity}\r\n                            colorClass=\"text-cyan-400\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 560, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/dashboard/SettingsView.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Plus, Trash, Server, Briefcase, FileJson, X, Save, Pencil } from 'lucide-react';\r\nimport { Broker } from '@/lib/mt-manager/types';\r\nimport { fetchDirect } from '../../lib/client-api';\r\n\r\nexport function SettingsView() {\r\n    const [brokers, setBrokers] = useState<Broker[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isAddOpen, setIsAddOpen] = useState(false);\r\n\r\n    // Form State\r\n    const [newBrokerName, setNewBrokerName] = useState('');\r\n    const [newBrokerShort, setNewBrokerShort] = useState('');\r\n    const [newBrokerDefaultSymbol, setNewBrokerDefaultSymbol] = useState('EURUSD');\r\n    const [newBrokerServers, setNewBrokerServers] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Edit State\r\n    const [editingId, setEditingId] = useState<string | null>(null);\r\n\r\n    // Mapping State\r\n    const [editingBroker, setEditingBroker] = useState<Broker | null>(null);\r\n    const [mappingList, setMappingList] = useState<{ key: string, value: string }[]>([]);\r\n\r\n    useEffect(() => {\r\n        loadBrokers();\r\n    }, []);\r\n\r\n    const loadBrokers = async () => {\r\n        try {\r\n            const res = await fetchDirect('/brokers');\r\n            const data = await res.json();\r\n            setBrokers(data);\r\n        } catch (e) {\r\n            console.error(\"Failed to load brokers\", e);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        if (!newBrokerName || !newBrokerShort) return;\r\n\r\n        // Find existing broker to preserve mappings if editing\r\n        const existingBroker = editingId ? brokers.find(b => b.id === editingId) : null;\r\n\r\n        const payload = {\r\n            id: editingId || undefined,\r\n            name: newBrokerName,\r\n            shorthand: newBrokerShort,\r\n            defaultSymbol: newBrokerDefaultSymbol,\r\n            servers: newBrokerServers.split(',').map(s => s.trim()).filter(Boolean),\r\n            symbolMappings: existingBroker?.symbolMappings || {} // Preserve existing mappings\r\n        };\r\n\r\n        await fetchDirect('/brokers', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload)\r\n        });\r\n\r\n        setIsAddOpen(false);\r\n        resetForm();\r\n        loadBrokers();\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setEditingId(null);\r\n        setNewBrokerName('');\r\n        setNewBrokerShort('');\r\n        setNewBrokerDefaultSymbol('EURUSD');\r\n        setNewBrokerServers('');\r\n    };\r\n\r\n    const handleEdit = (broker: Broker) => {\r\n        setEditingId(broker.id);\r\n        setNewBrokerName(broker.name);\r\n        setNewBrokerShort(broker.shorthand);\r\n        setNewBrokerDefaultSymbol(broker.defaultSymbol || 'EURUSD');\r\n        setNewBrokerServers(broker.servers.join(', '));\r\n        setIsAddOpen(true);\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm('Delete this broker?')) return;\r\n        await fetchDirect(`/brokers/${id}`, { method: 'DELETE' });\r\n        loadBrokers();\r\n    };\r\n\r\n    const handleOpenMappings = (broker: Broker) => {\r\n        setEditingBroker(broker);\r\n        const list = Object.entries(broker.symbolMappings || {}).map(([key, value]) => ({ key, value }));\r\n        if (list.length === 0) list.push({ key: '', value: '' });\r\n        setMappingList(list);\r\n    };\r\n\r\n    const handleSaveMappings = async () => {\r\n        if (!editingBroker) return;\r\n\r\n        const mappings: Record<string, string> = {};\r\n        mappingList.forEach(m => {\r\n            if (m.key.trim() && m.value.trim()) {\r\n                mappings[m.key.trim()] = m.value.trim();\r\n            }\r\n        });\r\n\r\n        const updatedBroker = { ...editingBroker, symbolMappings: mappings };\r\n\r\n        await fetchDirect('/brokers', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(updatedBroker)\r\n        });\r\n\r\n        setEditingBroker(null);\r\n        loadBrokers();\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col p-8 animate-in fade-in zoom-in-95 duration-300 overflow-y-auto bg-slate-50 dark:bg-transparent\">\r\n            <header className=\"mb-6 flex justify-between items-center border-b border-slate-200 dark:border-slate-800 pb-6\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3\">\r\n                        <Briefcase className=\"text-indigo-600 dark:text-indigo-400\" /> Brokers\r\n                    </h2>\r\n                    <p className=\"text-slate-500 dark:text-slate-400 mt-1\">Manage Broker Connections</p>\r\n                </div>\r\n                <button\r\n                    onClick={() => { resetForm(); setIsAddOpen(true); }}\r\n                    className=\"bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium shadow-lg shadow-indigo-500/20\"\r\n                >\r\n                    <Plus size={18} /> Add Broker\r\n                </button>\r\n            </header>\r\n\r\n            {/* Brokers List */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-in slide-in-from-right-4 fade-in duration-300\">\r\n                {brokers.map(broker => (\r\n                    <div key={broker.id} className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-6 relative group hover:border-indigo-500/50 transition-all shadow-sm\">\r\n                        <div className=\"flex justify-between items-start mb-4\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"w-10 h-10 rounded-lg bg-indigo-50 dark:bg-indigo-500/10 flex items-center justify-center text-indigo-600 dark:text-indigo-400 font-bold border border-indigo-100 dark:border-indigo-500/20\">\r\n                                    {broker.shorthand.substring(0, 2)}\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"font-bold text-slate-900 dark:text-slate-200\">{broker.name}</h3>\r\n                                    <p className=\"text-xs text-slate-500 font-mono\">{broker.shorthand}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"absolute top-6 right-6 flex items-center gap-1 bg-slate-100 dark:bg-slate-800/50 p-1 rounded-lg backdrop-blur-sm border border-slate-200 dark:border-slate-700/50\">\r\n                            <button\r\n                                onClick={() => handleEdit(broker)}\r\n                                className=\"text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors p-1.5 hover:bg-white dark:hover:bg-slate-700 rounded\"\r\n                                title=\"Edit Broker Details\"\r\n                            >\r\n                                <Pencil size={14} />\r\n                            </button>\r\n                            <button\r\n                                onClick={() => handleDelete(broker.id)}\r\n                                className=\"text-slate-500 dark:text-slate-400 hover:text-red-500 dark:hover:text-red-400 transition-colors p-1.5 hover:bg-white dark:hover:bg-slate-700 rounded\"\r\n                                title=\"Delete Broker\"\r\n                            >\r\n                                <Trash size={14} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <div className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Servers</div>\r\n                            <div className=\"flex flex-wrap gap-2\">\r\n                                {broker.servers.length > 0 ? broker.servers.map(s => (\r\n                                    <span key={s} className=\"px-2 py-1 bg-slate-100 dark:bg-slate-800 rounded text-xs text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 flex items-center gap-1\">\r\n                                        <Server size={10} className=\"text-slate-500\" /> {s}\r\n                                    </span>\r\n                                )) : <span className=\"text-xs text-slate-400 dark:text-slate-600 italic\">No servers defined</span>}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Modal */}\r\n            {isAddOpen && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\r\n                    <div className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl shadow-2xl w-full max-w-md p-6 animate-in zoom-in-95\">\r\n                        <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-6\">{editingId ? 'Edit Broker' : 'Add New Broker'}</h3>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Broker Name</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Broker Name (e.g. FTMO)\"\r\n                                    className=\"bg-slate-100 dark:bg-slate-700 border-none rounded p-2 text-slate-900 dark:text-white text-sm w-full\"\r\n                                    value={newBrokerName}\r\n                                    onChange={e => setNewBrokerName(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Shorthand (ID)</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Shorthand (e.g. FTMO)\"\r\n                                    className=\"bg-slate-100 dark:bg-slate-700 border-none rounded p-2 text-slate-900 dark:text-white text-sm w-full\"\r\n                                    value={newBrokerShort}\r\n                                    onChange={e => setNewBrokerShort(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Default Symbol</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Default Symbol (e.g. EURUSD)\"\r\n                                    className=\"bg-slate-100 dark:bg-slate-700 border-none rounded p-2 text-slate-900 dark:text-white text-sm w-full\"\r\n                                    value={newBrokerDefaultSymbol}\r\n                                    onChange={e => setNewBrokerDefaultSymbol(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Servers (comma separated)</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"e.g. FTMO-Demo, FTMO-Live\"\r\n                                    className=\"bg-slate-100 dark:bg-slate-700 border-none rounded p-2 text-slate-900 dark:text-white text-sm w-full\"\r\n                                    value={newBrokerServers}\r\n                                    onChange={e => setNewBrokerServers(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end gap-3 mt-8\">\r\n                            <button onClick={() => setIsAddOpen(false)} className=\"px-4 py-2 rounded-lg text-slate-400 hover:bg-slate-800 transition-colors\">Cancel</button>\r\n                            <button\r\n                                onClick={handleSave}\r\n                                disabled={!newBrokerName || !newBrokerShort}\r\n                                className=\"px-6 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                {editingId ? 'Update Broker' : 'Save Broker'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Mappings Modal */}\r\n            {editingBroker && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\r\n                    <div className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl shadow-2xl w-full max-w-2xl p-6 animate-in zoom-in-95 flex flex-col max-h-[90vh]\">\r\n                        <div className=\"flex justify-between items-center mb-6 border-b border-slate-200 dark:border-slate-800 pb-4\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">Symbol Mappings</h3>\r\n                                <p className=\"text-slate-500 dark:text-slate-400 text-sm\">Map internal symbols to broker-specific names for <span className=\"text-indigo-600 dark:text-indigo-400\">{editingBroker.name}</span></p>\r\n                            </div>\r\n                            <button onClick={() => setEditingBroker(null)} className=\"text-slate-500 hover:text-slate-900 dark:hover:text-white\"><X size={20} /></button>\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 overflow-y-auto pr-2 space-y-3\">\r\n                            <div className=\"grid grid-cols-[1fr,1fr,auto] gap-3 text-xs font-bold text-slate-500 uppercase px-1\">\r\n                                <div>Internal (e.g. GER40)</div>\r\n                                <div>Broker (e.g. DAX30)</div>\r\n                                <div></div>\r\n                            </div>\r\n                            {mappingList.map((m, idx) => (\r\n                                <div key={idx} className=\"grid grid-cols-[1fr,1fr,auto] gap-3\">\r\n                                    <input\r\n                                        className=\"bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded px-3 py-2 text-slate-900 dark:text-slate-200 focus:border-indigo-500 outline-none\"\r\n                                        placeholder=\"Internal\"\r\n                                        value={m.key}\r\n                                        onChange={e => {\r\n                                            const newList = [...mappingList];\r\n                                            newList[idx].key = e.target.value;\r\n                                            setMappingList(newList);\r\n                                        }}\r\n                                    />\r\n                                    <input\r\n                                        className=\"bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded px-3 py-2 text-slate-900 dark:text-slate-200 focus:border-indigo-500 outline-none\"\r\n                                        placeholder=\"Broker Symbol\"\r\n                                        value={m.value}\r\n                                        onChange={e => {\r\n                                            const newList = [...mappingList];\r\n                                            newList[idx].value = e.target.value;\r\n                                            setMappingList(newList);\r\n                                        }}\r\n                                    />\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            const newList = mappingList.filter((_, i) => i !== idx);\r\n                                            setMappingList(newList);\r\n                                        }}\r\n                                        className=\"text-slate-600 hover:text-red-400 p-2\"\r\n                                    >\r\n                                        <Trash size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                            <button\r\n                                onClick={() => setMappingList([...mappingList, { key: '', value: '' }])}\r\n                                className=\"flex items-center gap-2 text-indigo-400 hover:text-indigo-300 text-sm font-medium mt-2 px-1\"\r\n                            >\r\n                                <Plus size={16} /> Add Mapping\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end gap-3 mt-8 pt-4 border-t border-slate-200 dark:border-slate-800\">\r\n                            <button onClick={() => setEditingBroker(null)} className=\"px-4 py-2 rounded-lg text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\">Cancel</button>\r\n                            <button onClick={handleSaveMappings} className=\"px-6 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white font-medium transition-colors flex items-center gap-2\">\r\n                                <Save size={18} /> Save Mappings\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1328, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/dashboard/AddAccountModal.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { X, Server, Key, User, Download } from 'lucide-react';\r\nimport { Broker, TradingAccount } from '@/lib/mt-manager/types';\r\nimport { fetchDirect, fetchSystem } from '../../lib/client-api';\r\n\r\ninterface AddAccountModalProps {\r\n    onClose: () => void;\r\n    onSuccess: () => void;\r\n    title?: string;\r\n    initialType?: 'TRADING' | 'DATAFEED';\r\n    existingAccounts?: TradingAccount[];\r\n    isTestMode?: boolean;\r\n}\r\n\r\nexport function AddAccountModal({ onClose, onSuccess, title, initialType = 'TRADING', existingAccounts = [], isTestMode = false }: AddAccountModalProps) {\r\n    const [brokers, setBrokers] = useState<Broker[]>([]);\r\n\r\n    // Form\r\n    const [selectedBrokerId, setSelectedBrokerId] = useState('');\r\n    const [login, setLogin] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [server, setServer] = useState('');\r\n    const [accountType] = useState<'TRADING' | 'DATAFEED'>(initialType);\r\n    const [isDeploying, setIsDeploying] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Initialize with parent mode if provided\r\n    const [isTest, setIsTest] = useState(isTestMode);\r\n\r\n    // Import State\r\n    const [importAccountId, setImportAccountId] = useState('');\r\n\r\n    useEffect(() => {\r\n        fetchDirect('/brokers').then(r => r.json()).then(setBrokers);\r\n    }, []);\r\n\r\n    const selectedBroker = brokers.find(b => b.id === selectedBrokerId);\r\n\r\n    // Filter available accounts for import (Trading only, not Datafeed)\r\n    const importableAccounts = existingAccounts.filter(a => a.accountType !== 'DATAFEED' && !a.isDatafeed);\r\n\r\n    const handleImportAccount = (accId: string) => {\r\n        setImportAccountId(accId);\r\n        if (!accId) {\r\n            // Reset form if cleared? maybe not clear, just stop tracking\r\n            return;\r\n        }\r\n\r\n        const acc = existingAccounts.find(a => a.id === accId);\r\n        if (acc) {\r\n            setSelectedBrokerId(acc.brokerId);\r\n            setLogin(acc.login);\r\n            setPassword(acc.password);\r\n            setServer(acc.server);\r\n            setIsTest(!!acc.isTest);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!selectedBrokerId || !login || !password || !server) {\r\n            setError(\"All fields are required\");\r\n            return;\r\n        }\r\n\r\n        setIsDeploying(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const res = await fetchSystem('/accounts', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    brokerId: selectedBrokerId,\r\n                    login,\r\n                    password,\r\n                    server,\r\n                    accountType,\r\n                    isTest // Pass to API\r\n                })\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || 'Deployment failed');\r\n            }\r\n\r\n            onSuccess();\r\n            onClose();\r\n\r\n        } catch (e: any) {\r\n            setError(e.message);\r\n            setIsDeploying(false);\r\n        }\r\n    };\r\n\r\n    // Calculate Header Styles based on Mode\r\n    const headerBgClass = isTestMode ? \"bg-amber-600 text-white\" : \"bg-indigo-600 text-white\";\r\n    const headerTitle = title || (initialType === 'DATAFEED'\r\n        ? 'New Datafeed'\r\n        : (isTestMode ? 'New TEST Trading Account' : 'New LIVE Trading Account'));\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 dark:bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in zoom-in-95\">\r\n                <div className={`h-14 ${headerBgClass} flex items-center justify-between px-6 shadow-lg`}>\r\n                    <h3 className=\"font-bold flex items-center gap-2\">\r\n                        {headerTitle}\r\n                    </h3>\r\n                    <button onClick={onClose} className=\"text-white/70 hover:text-white transition-colors\"><X size={20} /></button>\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-5\">\r\n\r\n                    {/* Import Option (Only for Datafeed) */}\r\n                    {accountType === 'DATAFEED' && importableAccounts.length > 0 && (\r\n                        <div className=\"p-3 bg-indigo-500/10 border border-indigo-500/20 rounded-lg\">\r\n                            <label className=\"block text-xs font-bold text-indigo-400 uppercase mb-2 flex items-center gap-2\">\r\n                                <Download size={12} /> Import Configuration\r\n                            </label>\r\n                            <select\r\n                                className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg p-2 text-sm text-slate-900 dark:text-slate-300 focus:border-indigo-500 outline-none\"\r\n                                value={importAccountId}\r\n                                onChange={(e) => handleImportAccount(e.target.value)}\r\n                            >\r\n                                <option value=\"\">Select Existing Trading Account...</option>\r\n                                <option value=\"\">---</option>\r\n                                {importableAccounts.map(acc => (\r\n                                    <option key={acc.id} value={acc.id}>\r\n                                        {acc.login} ({acc.server})\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Info Banner for Mode */}\r\n                    {accountType === 'TRADING' && (\r\n                        <div className={`p-3 rounded-lg border flex flex-col gap-1 ${isTestMode ? 'bg-amber-500/10 border-amber-500/20 text-amber-500' : 'bg-indigo-500/10 border-indigo-500/20 text-indigo-400'}`}>\r\n                            <div className=\"text-xs font-bold uppercase tracking-wider opacity-80\">\r\n                                {isTestMode ? \"Test Environment Active\" : \"Live Environment Active\"}\r\n                            </div>\r\n                            <div className=\"text-sm\">\r\n                                You are creating a <strong className=\"underline\">{isTestMode ? \"SIMULATION\" : \"REAL SPEC\"}</strong> account.\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Broker Select */}\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Broker</label>\r\n                        <select\r\n                            className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg p-3 text-slate-900 dark:text-slate-200 focus:border-indigo-500 outline-none transition-colors\"\r\n                            value={selectedBrokerId}\r\n                            onChange={e => { setSelectedBrokerId(e.target.value); setServer(''); }}\r\n                        >\r\n                            <option value=\"\">Select Broker...</option>\r\n                            {brokers.map(b => <option key={b.id} value={b.id}>{b.name}</option>)}\r\n                        </select>\r\n                    </div>\r\n\r\n                    {/* Server Select (Dependent) */}\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Broker Server</label>\r\n                        <select\r\n                            className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg p-3 text-slate-900 dark:text-slate-200 focus:border-indigo-500 outline-none transition-colors disabled:opacity-50\"\r\n                            value={server}\r\n                            onChange={e => setServer(e.target.value)}\r\n                            disabled={!selectedBroker}\r\n                        >\r\n                            <option value=\"\">Select Server...</option>\r\n                            {selectedBroker?.servers.map(s => <option key={s} value={s}>{s}</option>)}\r\n                        </select>\r\n                    </div>\r\n\r\n                    {/* Login */}\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Login (Account #)</label>\r\n                        <div className=\"relative\">\r\n                            <User size={16} className=\"absolute left-3 top-3.5 text-slate-500\" />\r\n                            <input\r\n                                className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg p-3 pl-10 text-slate-900 dark:text-slate-200 focus:border-indigo-500 outline-none transition-colors\"\r\n                                placeholder=\"12345678\"\r\n                                value={login}\r\n                                onChange={e => setLogin(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Password */}\r\n                    <div>\r\n                        <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Password</label>\r\n                        <div className=\"relative\">\r\n                            <Key size={16} className=\"absolute left-3 top-3.5 text-slate-500\" />\r\n                            <input\r\n                                type=\"password\"\r\n                                className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg p-3 pl-10 text-slate-900 dark:text-slate-200 focus:border-indigo-500 outline-none transition-colors\"\r\n                                placeholder=\"\"\r\n                                value={password}\r\n                                onChange={e => setPassword(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <div className=\"p-3 bg-red-500/10 border border-red-500/20 text-red-400 text-sm rounded-lg\">\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    <button\r\n                        onClick={handleSubmit}\r\n                        disabled={isDeploying}\r\n                        className=\"w-full py-3 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white font-bold transition-all shadow-lg shadow-indigo-500/20 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2\"\r\n                    >\r\n                        {isDeploying ? (\r\n                            <>\r\n                                <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                Deploying...\r\n                            </>\r\n                        ) : 'Deploy Instance'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1797, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/dashboard/AccountsView.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { Users, Activity, Play, Square, RotateCw, Trash2, Power, Database, AlertCircle, Download, ShieldAlert, CheckCircle2, Clock } from 'lucide-react';\r\nimport { AddAccountModal } from './AddAccountModal';\r\nimport { TradingAccount, Broker, StatusData } from '../../lib/mt-manager/types';\r\nimport { fetchDirect, fetchSystem, API_URLS } from '../../lib/client-api';\r\nimport { socketService } from '../../services/socket';\r\n\r\nexport function AccountsView() {\r\n    const [accounts, setAccounts] = useState<TradingAccount[]>([]);\r\n    const [brokers, setBrokers] = useState<Broker[]>([]);\r\n    const [isAddOpen, setIsAddOpen] = useState(false);\r\n    const [loadingAction, setLoadingAction] = useState<string | null>(null);\r\n    const [statuses, setStatuses] = useState<Record<string, StatusData>>({});\r\n    const [serverTime, setServerTime] = useState<number>(Date.now());\r\n    const fetchIdRef = useRef(0);\r\n\r\n    // Updates\r\n    const [updateAvailable, setUpdateAvailable] = useState<{ hasUpdate: boolean, lastDeployed: number, available: number, updatedFiles: string[] } | null>(null);\r\n    const [updateScope, setUpdateScope] = useState<string | null>(null);\r\n    const [isUpdating, setIsUpdating] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [notification, setNotification] = useState<{ type: 'success' | 'error', message: string } | null>(null);\r\n\r\n    const [isTestMode, setIsTestMode] = useState(false); // Mode Toggle\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n        checkUpdates();\r\n\r\n        const statusInterval = setInterval(fetchStatus, 2000);\r\n        const updateInterval = setInterval(checkUpdates, 30000); // Check every 30s\r\n\r\n        return () => {\r\n            clearInterval(statusInterval);\r\n            clearInterval(updateInterval);\r\n        };\r\n    }, []);\r\n\r\n    // DIRECT BACKEND ACCESS (Bypassing Next.js due to Windows Latency)\r\n    // Now handled by client-api.ts\r\n\r\n    const checkUpdates = async () => {\r\n        try {\r\n            // This is a local file check, so we keep using Next.js API for this one (it's fast)\r\n            const res = await fetchSystem('/system/check-updates');\r\n            const data = await res.json();\r\n            setUpdateAvailable(data);\r\n        } catch (e) {\r\n            console.error(\"Update check failed\", e);\r\n        }\r\n    };\r\n\r\n    const handleMassUpdate = async () => {\r\n        if (!updateAvailable) return;\r\n\r\n        // Determine scope\r\n        const files = updateAvailable.updatedFiles || [];\r\n        const updateDatafeed = files.includes('DatafeedExpert.ex5');\r\n        const updateTrading = files.includes('TradingExpert.ex5');\r\n\r\n        let scope = 'ALL';\r\n        let msg = \"This will RESTART ALL running bots.\";\r\n\r\n        if (updateDatafeed && !updateTrading) {\r\n            scope = 'DATAFEED';\r\n            msg = \"This will RESTART only Datafeed instances.\";\r\n        } else if (updateTrading && !updateDatafeed) {\r\n            scope = 'TRADING';\r\n            msg = \"This will RESTART only Trading Bot instances.\";\r\n        }\r\n\r\n        if (!confirm(`Deploy Updates (${scope})?\\n\\n${msg}\\n\\nContinue?`)) return;\r\n\r\n        setIsUpdating(true);\r\n        setUpdateScope(scope);\r\n        setNotification(null);\r\n\r\n        // Visual Feedback: Set loading state for affected accounts\r\n        const affectedIds = accounts.filter(a => {\r\n            const isDF = a.accountType === 'DATAFEED' || a.isDatafeed;\r\n            return scope === 'ALL' || (scope === 'DATAFEED' && isDF) || (scope === 'TRADING' && !isDF);\r\n        }).map(a => a.id);\r\n\r\n        try {\r\n            const res = await fetchSystem('/system/update-bots', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ scope })\r\n            });\r\n            const data = await res.json();\r\n\r\n            // Show nicer notification\r\n            setNotification({\r\n                type: 'success',\r\n                message: `Deployment Successful! Updated ${data.results.length} instances.`\r\n            });\r\n\r\n            // Clear notification after 5s\r\n            setTimeout(() => setNotification(null), 5000);\r\n\r\n            await checkUpdates(); // Refresh status\r\n            await loadData(); // Refresh accounts\r\n        } catch (e: any) {\r\n            setNotification({\r\n                type: 'error',\r\n                message: \"Update Failed: \" + e.message\r\n            });\r\n        } finally {\r\n            setIsUpdating(false);\r\n        }\r\n    };\r\n\r\n    const handleRecovery = async () => {\r\n        if (!confirm(\"Scan disk for lost accounts? This is a disaster recovery action.\")) return;\r\n        try {\r\n            const res = await fetchSystem('/system/recovery', { method: 'POST' });\r\n            const data = await res.json();\r\n            alert(`Recovery Complete: Found ${data.recoveredCount} accounts.`);\r\n            await loadData();\r\n        } catch (e: any) {\r\n            alert(\"Recovery Failed: \" + e.message);\r\n        }\r\n    };\r\n\r\n    const fetchStatus = async () => {\r\n        const currentId = ++fetchIdRef.current;\r\n        try {\r\n            // Direct status check (already was direct)\r\n            const res = await fetch(`${API_URLS.DIRECT_BASE}/status/heartbeat`);\r\n            const data = await res.json();\r\n\r\n            // Race Condition Check: Discard if a newer request started\r\n            if (currentId !== fetchIdRef.current) return;\r\n\r\n            if (data.success) {\r\n                setStatuses(data.services);\r\n                if (data.serverTime) setServerTime(data.serverTime);\r\n            }\r\n        } catch (e) {\r\n            // console.error(\"Status fetch failed\", e);\r\n        }\r\n    };\r\n\r\n    const loadData = async () => {\r\n        const traceId = Math.floor(Math.random() * 10000);\r\n        console.log(`[PERF ${Date.now()}] [Trace-${traceId}]  AccountsView: Starting Data Load`);\r\n\r\n        setIsLoading(true); // Don't block UI if refreshing\r\n        // But initial load?\r\n        try {\r\n            console.log(`[PERF ${Date.now()}] [Trace-${traceId}]  Fetching Accounts & Brokers...`);\r\n\r\n            const start = performance.now();\r\n            const [accRes, brokerRes] = await Promise.all([\r\n                fetchDirect('/accounts'),\r\n                fetchDirect('/brokers')\r\n            ]);\r\n\r\n            const accData = await accRes.json();\r\n            const brokerData = await brokerRes.json();\r\n\r\n            // Support both Array and Object wrapper (API V2)\r\n            const accountsList = Array.isArray(accData) ? accData : (accData.accounts || []);\r\n            setAccounts(accountsList);\r\n\r\n            setBrokers(brokerData);\r\n\r\n            console.log(`[PERF ${Date.now()}] [Trace-${traceId}]  Accounts Loaded: ${accountsList.length}`);\r\n        } catch (error) {\r\n            console.error(\"Failed to load data:\", error);\r\n        } finally {\r\n            setIsLoading(false);\r\n            const duration = (performance.now() - (traceId ? traceId : 0) * 0); // Fake usage to silence unused var if needed, or just standard finally\r\n            // console.timeEnd('Client-LoadData'); // REMOVED to prevent errors\r\n        }\r\n    };\r\n\r\n    const handleAction = async (id: string, action: 'START' | 'STOP' | 'RESTART' | 'DELETE') => {\r\n        if (action === 'DELETE' && !confirm('Are you sure you want to delete this account?')) return;\r\n\r\n        setLoadingAction(id);\r\n        try {\r\n            const res = await fetchSystem(`/accounts/${id}/action`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ action })\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (!res.ok) {\r\n                alert(`Action Failed: ${data.error || 'Unknown Error'}`);\r\n                console.error(\"Action failed:\", data);\r\n            } else {\r\n                await loadData();\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Request failed:\", e);\r\n            alert(\"Network or Server Error\");\r\n        } finally {\r\n            setLoadingAction(null);\r\n        }\r\n    };\r\n\r\n    // RENDER\r\n    return (\r\n        <div className=\"h-full flex flex-col p-6 animate-in fade-in zoom-in-95 duration-300 overflow-y-auto\">\r\n            {/* Notification Toast */}\r\n            {notification && (\r\n                <div className={`fixed bottom-6 right-6 z-50 px-6 py-4 rounded-xl shadow-2xl border flex items-center gap-3 animate-in slide-in-from-bottom-5 ${notification.type === 'success' ? 'bg-emerald-900/90 border-emerald-500 text-white' : 'bg-red-900/90 border-red-500 text-white'\r\n                    }`}>\r\n                    {notification.type === 'success' ? <CheckCircle2 size={24} className=\"text-emerald-400\" /> : <AlertCircle size={24} className=\"text-red-400\" />}\r\n                    <div>\r\n                        <h4 className=\"font-bold\">{notification.type === 'success' ? 'Success' : 'Error'}</h4>\r\n                        <p className=\"text-sm opacity-90\">{notification.message}</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Update Banner */}\r\n            {updateAvailable?.hasUpdate && updateAvailable.updatedFiles?.includes('TradingExpert.ex5') && (\r\n                <div className=\"mb-6 bg-indigo-500/10 border border-indigo-500/30 rounded-xl p-4 flex items-center justify-between shadow-lg shadow-indigo-500/10\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 bg-indigo-500 rounded-lg text-white animate-pulse\">\r\n                            <AlertCircle size={24} />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className=\"font-bold text-white text-lg\">New Trading Bot Available</h3>\r\n                            <p className=\"text-slate-400 text-sm\">\r\n                                TradingExpert.ex5 v{new Date(updateAvailable.available).toLocaleTimeString()} is ready for deployment.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleMassUpdate}\r\n                        disabled={isUpdating}\r\n                        className=\"px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg flex items-center gap-2 shadow-lg transition-all active:scale-95 disabled:opacity-50\"\r\n                    >\r\n                        {isUpdating ? <RotateCw className=\"animate-spin\" /> : <Download size={20} />}\r\n                        Deploy Trading Updates\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n                <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2\">\r\n                    <Activity className={isTestMode ? \"text-amber-500\" : \"text-emerald-400\"} />\r\n                    Trading Accounts\r\n                    {isTestMode && <span className=\"text-sm bg-amber-500 text-black px-2 py-0.5 rounded font-bold uppercase ml-2\">Test Mode</span>}\r\n                </h2>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    {/* DEBUG LATENCY */}\r\n\r\n                    {/* MODE TOGGLE */}\r\n                    <div className=\"flex bg-white dark:bg-slate-900 p-1 rounded-lg border border-slate-300 dark:border-slate-800 mr-2 shadow-sm\">\r\n                        <button\r\n                            onClick={() => setIsTestMode(false)}\r\n                            className={cn(\r\n                                \"px-3 py-1.5 rounded-md text-xs font-bold transition-all\",\r\n                                !isTestMode ? \"bg-indigo-600 text-white shadow\" : \"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            LIVE\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setIsTestMode(true)}\r\n                            className={cn(\r\n                                \"px-3 py-1.5 rounded-md text-xs font-bold transition-all\",\r\n                                isTestMode ? \"bg-amber-500 text-black shadow\" : \"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            TEST\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"w-px h-6 bg-slate-300 dark:bg-slate-800 mr-2\"></div>\r\n\r\n                    <button\r\n                        onClick={() => setIsAddOpen(true)}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg shadow-lg transition-all active:scale-95 text-sm\"\r\n                    >\r\n                        <Users size={16} /> Add New Account\r\n                    </button>\r\n\r\n                    {/* Recovery Action */}\r\n                    <button\r\n                        onClick={handleRecovery}\r\n                        className=\"flex items-center gap-2 text-xs font-bold text-slate-500 hover:text-amber-500 transition-colors uppercase tracking-wider px-3 py-1.5 border border-slate-800 rounded hover:border-amber-500/50 hover:bg-amber-500/10\"\r\n                    >\r\n                        <ShieldAlert size={14} /> Recovery Scan\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"mb-8\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                    {accounts.filter(a =>\r\n                        a.accountType !== 'DATAFEED' &&\r\n                        !a.isDatafeed &&\r\n                        (isTestMode ? a.isTest : !a.isTest) // Filter strictly by mode\r\n                    ).map(acc => (\r\n                        <AccountCard\r\n                            key={acc.id}\r\n                            acc={acc}\r\n                            statuses={statuses}\r\n                            serverTime={serverTime}\r\n                            loadingAction={loadingAction}\r\n                            onAction={handleAction}\r\n                            brokers={brokers}\r\n                            isDatafeedSection={false}\r\n                            isUpdating={isUpdating}\r\n                            updateScope={updateScope}\r\n                        />\r\n                    ))}\r\n                    {accounts.filter(a => a.accountType !== 'DATAFEED' && !a.isDatafeed && (isTestMode ? a.isTest : !a.isTest)).length === 0 && (\r\n                        <div className=\"col-span-full py-12 flex flex-col items-center justify-center text-slate-500 border-2 border-dashed border-slate-800 rounded-2xl bg-slate-900/30\">\r\n                            <Users size={48} className=\"opacity-20 mb-4\" />\r\n                            <p className=\"font-medium text-lg\">No {isTestMode ? 'Test' : 'Live'} Accounts Found</p>\r\n                            <p className=\"text-sm\">Click \"Add New Account\" to connect.</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {isAddOpen && <AddAccountModal onClose={() => setIsAddOpen(false)} onSuccess={loadData} existingAccounts={accounts} isTestMode={isTestMode} />}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction cn(...classes: (string | undefined | null | boolean)[]) {\r\n    return classes.filter(Boolean).join(\" \");\r\n}\r\n\r\nconst getBrokerShorthand = (id: string, brokers: Broker[]) => brokers.find(b => b.id === id)?.shorthand || 'UNK';\r\nconst getBrokerName = (id: string, brokers: Broker[]) => brokers.find(b => b.id === id)?.name || 'Unknown Broker';\r\n\r\nconst getBotId = (acc: TradingAccount, brokers: Broker[]) => {\r\n    const short = getBrokerShorthand(acc.brokerId, brokers).replace(/\\s+/g, '');\r\n    let id = `${short}_${acc.login}`;\r\n    if (acc.accountType === 'DATAFEED' || acc.isDatafeed) {\r\n        id += '_DATAFEED';\r\n    }\r\n    return id;\r\n};\r\n\r\nfunction AccountCard({ acc, statuses, serverTime, loadingAction, onAction, brokers, isDatafeedSection, isUpdating, updateScope }: {\r\n    acc: TradingAccount,\r\n    statuses: Record<string, StatusData>,\r\n    serverTime: number,\r\n    loadingAction: string | null,\r\n    onAction: (id: string, action: 'START' | 'STOP' | 'RESTART' | 'DELETE') => void,\r\n    brokers: Broker[],\r\n    isDatafeedSection: boolean,\r\n    isUpdating?: boolean,\r\n    updateScope?: string | null\r\n}) {\r\n    // Determine if this account is in scope for the current mass update\r\n    const isInScope = updateScope === 'ALL' ||\r\n        (updateScope === 'DATAFEED' && (acc.accountType === 'DATAFEED' || acc.isDatafeed)) ||\r\n        (updateScope === 'TRADING' && !(acc.accountType === 'DATAFEED' || acc.isDatafeed));\r\n\r\n    const isProcessing = loadingAction === acc.id || (!!isUpdating && isInScope && acc.status === 'RUNNING');\r\n    const isRunning = acc.status === 'RUNNING';\r\n    const botId = getBotId(acc, brokers);\r\n    const status = statuses[botId];\r\n\r\n    // Status Logic\r\n    const lastSeen = status?.lastSeen || 0;\r\n    // Use serverTime for Diff to be robust against client-side lag/clock drift\r\n    // Fallback to Date.now() if serverTime is 0 (first render)\r\n    const timeRef = serverTime || Date.now();\r\n    const isAlive = (timeRef - lastSeen) < 30000; // 30s grace as requested\r\n\r\n    const mt5Ok = isRunning;\r\n    const eaOk = isAlive;\r\n    const accOk = eaOk ? !!status?.account?.connected : (acc.brokerConnectionStatus === 'CONNECTED');\r\n    const tz = status?.timezone || '??';\r\n\r\n    return (\r\n        <div className={`bg-white dark:bg-slate-900 border rounded-xl p-4 relative overflow-hidden group transition-colors min-h-[180px] flex flex-col justify-between ${isDatafeedSection ? 'border-emerald-500/30' : 'border-slate-300 dark:border-slate-800 hover:border-indigo-500/50 shadow-sm'}`}>\r\n\r\n            {/* Top Row: Title */}\r\n            <div className=\"flex justify-between items-start\">\r\n                <div>\r\n                    <h3 className=\"text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2\">\r\n                        {getBrokerName(acc.brokerId, brokers)}\r\n                    </h3>\r\n\r\n                    {/* Badge for Datafeed */}\r\n                    {isDatafeedSection && (\r\n                        <span className=\"inline-block mt-1 px-2 py-0.5 bg-emerald-500/20 text-emerald-400 text-[10px] font-bold uppercase tracking-wider rounded\">\r\n                            Datafeed Source\r\n                        </span>\r\n                    )}\r\n                    {acc.isTest && (\r\n                        <span className=\"inline-block mt-1 ml-2 px-2 py-0.5 bg-amber-500/20 text-amber-500 text-[10px] font-bold uppercase tracking-wider rounded border border-amber-500/30\">\r\n                            TEST ACCOUNT\r\n                        </span>\r\n                    )}\r\n\r\n                    {/* 3-Tile Status Indicator */}\r\n                    <div className=\"flex gap-2 mt-2 mb-3\">\r\n                        <div className={`px-2 py-0.5 rounded text-[10px] font-bold border ${mt5Ok ? 'bg-emerald-500/10 border-emerald-500/50 text-emerald-400' : 'bg-red-500/10 border-red-500/50 text-red-400'}`}>\r\n                            MT5\r\n                        </div>\r\n                        <div\r\n                            title={acc.brokerConnectionStatus || 'Unknown'}\r\n                            className={`px-2 py-0.5 rounded text-[10px] font-bold border ${accOk ? 'bg-emerald-500/10 border-emerald-500/50 text-emerald-400' : 'bg-red-500/10 border-red-500/50 text-red-400'}`}>\r\n                            ACC\r\n                        </div>\r\n                        <div className={`px-2 py-0.5 rounded text-[10px] font-bold border ${eaOk ? 'bg-emerald-500/10 border-emerald-500/50 text-emerald-400' : 'bg-red-500/10 border-red-500/50 text-red-400'}`}>\r\n                            EA\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-1 text-[10px] text-slate-500 font-mono bg-slate-50 dark:bg-slate-950 px-2 py-1 rounded w-fit\" title=\"Broker Timezone\">\r\n                    <Clock size={10} /> {tz.split('/')[1] || tz}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Middle Info Section */}\r\n            <div className=\"space-y-1 mb-4\">\r\n                <div className=\"text-sm text-slate-600 dark:text-slate-300 flex items-center gap-2\">\r\n                    <span className=\"text-slate-500 w-16\">Benutzer:</span>\r\n                    <span className=\"font-mono\">{acc.login}</span>\r\n                </div>\r\n                {!isDatafeedSection && (\r\n                    <div className=\"text-sm text-slate-600 dark:text-slate-300 flex items-center gap-2 mt-2\">\r\n                        <span className=\"text-slate-500 w-16\">Saldo:</span>\r\n                        <span className=\"text-emerald-600 dark:text-emerald-400 font-mono\">\r\n                            {status?.account?.balance ? `$${status.account.balance.toFixed(2)}` : '-'}\r\n                        </span>\r\n                    </div>\r\n                )}\r\n                <div className=\"text-sm text-slate-600 dark:text-slate-300 flex items-center gap-2\">\r\n                    <span className=\"text-slate-500 w-16\">Server:</span>\r\n                    <span className=\"font-mono truncate\">{acc.server}</span>\r\n                </div>\r\n\r\n\r\n            </div>\r\n\r\n            {/* Bottom Row: Actions (Right Aligned) */}\r\n            <div className=\"flex justify-end items-center gap-2 pt-3 border-t border-slate-200 dark:border-slate-800\">\r\n                {!isRunning ? (\r\n                    <button onClick={() => onAction(acc.id, 'START')} className=\"p-1.5 hover:bg-emerald-500/20 text-emerald-400 rounded transition-colors\" title=\"Start\">\r\n                        <Play size={16} />\r\n                    </button>\r\n                ) : (\r\n                    <button onClick={() => onAction(acc.id, 'STOP')} className=\"p-1.5 hover:bg-red-500/20 text-red-400 rounded transition-colors\" title=\"Stop\">\r\n                        <Square size={16} />\r\n                    </button>\r\n                )}\r\n                <button onClick={() => onAction(acc.id, 'RESTART')} className=\"p-1.5 hover:bg-amber-500/20 text-amber-400 rounded transition-colors\" title=\"Restart\">\r\n                    <RotateCw size={16} />\r\n                </button>\r\n                <div className=\"w-px h-4 bg-slate-300 dark:bg-slate-700 mx-1\"></div>\r\n                <button onClick={() => onAction(acc.id, 'DELETE')} className=\"p-1.5 hover:bg-red-900/40 text-slate-500 hover:text-red-500 rounded transition-colors\" title=\"Delete\">\r\n                    <Trash2 size={16} />\r\n                </button>\r\n            </div>\r\n\r\n            {\r\n                isProcessing && (\r\n                    <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-20\">\r\n                        <RotateCw className=\"animate-spin text-white\" size={32} />\r\n                    </div>\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2661, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/dashboard/DatafeedSelectionModal.tsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\r\nimport { Search, Folder, ChevronRight, ChevronDown, Server, CheckCircle2, X } from 'lucide-react';\r\n\r\ninterface SymbolItem {\r\n    name: string;\r\n    path: string;\r\n    desc: string;\r\n    botId?: string;\r\n}\r\n\r\ninterface FolderNode {\r\n    name: string;\r\n    fullPath: string;\r\n    children: Map<string, FolderNode>;\r\n    items: SymbolItem[];\r\n}\r\n\r\ninterface BrokerInfo {\r\n    id: string;\r\n    name: string;\r\n    shorthand: string;\r\n}\r\n\r\ninterface DatafeedSelectionModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSelect: (symbol: SymbolItem) => void;\r\n    availableSymbols: SymbolItem[];\r\n    brokers: BrokerInfo[];\r\n}\r\n\r\nfunction buildBotTree(symbols: SymbolItem[], prefixPath: string): Map<string, FolderNode> {\r\n    const root: FolderNode = { name: \"Root\", fullPath: prefixPath, children: new Map(), items: [] };\r\n\r\n    symbols.forEach(sym => {\r\n        const rawPath = sym.path || 'Uncategorized';\r\n        const parts = rawPath.split('\\\\').filter(p => p);\r\n        if (parts.length > 0 && parts[parts.length - 1] === sym.name) parts.pop();\r\n\r\n        let current = root;\r\n        let pathAccumulator = prefixPath;\r\n\r\n        parts.forEach(part => {\r\n            pathAccumulator = `${pathAccumulator}\\\\${part}`;\r\n            if (!current.children.has(part)) {\r\n                current.children.set(part, {\r\n                    name: part,\r\n                    fullPath: pathAccumulator,\r\n                    children: new Map(),\r\n                    items: []\r\n                });\r\n            }\r\n            current = current.children.get(part)!;\r\n        });\r\n        current.items.push(sym);\r\n    });\r\n    return root.children;\r\n}\r\n\r\nexport function DatafeedSelectionModal({ isOpen, onClose, onSelect, availableSymbols, brokers }: DatafeedSelectionModalProps) {\r\n    const [filter, setFilter] = useState('');\r\n    const [expandedFolders, setExpandedFolders] = useState<Set<string>>(new Set());\r\n\r\n    const getBrokerName = (botId: string) => {\r\n        const broker = brokers.find(b => botId.startsWith(b.shorthand));\r\n        return broker ? broker.name : botId.replace('_DATAFEED', '');\r\n    };\r\n\r\n    const tree = useMemo(() => {\r\n        const botGroups = new Map<string, SymbolItem[]>();\r\n        availableSymbols.forEach(s => {\r\n            const id = s.botId || 'Default';\r\n            if (!botGroups.has(id)) botGroups.set(id, []);\r\n            botGroups.get(id)!.push(s);\r\n        });\r\n\r\n        const root: FolderNode = { name: \"Root\", fullPath: \"ROOT\", children: new Map(), items: [] };\r\n        Array.from(botGroups.entries()).forEach(([botId, syms]) => {\r\n            const brokerNode: FolderNode = { name: getBrokerName(botId), fullPath: `ROOT_${botId}`, children: new Map(), items: [] };\r\n            brokerNode.children = buildBotTree(syms, `ROOT_${botId}`);\r\n            root.children.set(botId, brokerNode);\r\n        });\r\n        return root;\r\n    }, [availableSymbols, brokers]);\r\n\r\n    // Auto-expand broker nodes on load\r\n    useMemo(() => {\r\n        if (!isOpen) return;\r\n        const bots = new Set(availableSymbols.map(s => s.botId || 'Default'));\r\n        setExpandedFolders(prev => {\r\n            const next = new Set(prev);\r\n            bots.forEach(b => next.add(`ROOT_${b}`));\r\n            return next;\r\n        });\r\n    }, [isOpen, availableSymbols]);\r\n\r\n    const renderFolder = (node: FolderNode, level: number = 0): React.ReactNode => {\r\n        const isExpanded = expandedFolders.has(node.fullPath);\r\n        if (level === 0) return null;\r\n\r\n        return (\r\n            <div key={node.fullPath} className=\"mb-1\">\r\n                <div\r\n                    onClick={() => {\r\n                        const next = new Set(expandedFolders);\r\n                        if (next.has(node.fullPath)) next.delete(node.fullPath);\r\n                        else next.add(node.fullPath);\r\n                        setExpandedFolders(next);\r\n                    }}\r\n                    className={`flex items-center gap-2 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded cursor-pointer select-none text-slate-600 dark:text-slate-300 transition-colors ${level === 1 ? 'bg-slate-50 dark:bg-slate-800 mb-2 mt-2 border border-slate-200 dark:border-slate-700' : ''}`}\r\n                    style={{ paddingLeft: `${Math.max(0, (level - 1)) * 12 + 8}px` }}\r\n                >\r\n                    {isExpanded ? <ChevronDown size={14} /> : <ChevronRight size={14} />}\r\n                    {level === 1 ? <Server size={16} className=\"text-emerald-500 dark:text-emerald-400\" /> : <Folder size={14} className=\"text-indigo-500 dark:text-indigo-400\" />}\r\n                    <span className={`font-bold ${level === 1 ? 'text-sm text-slate-900 dark:text-white' : 'text-xs'}`}>{node.name}</span>\r\n                </div>\r\n                {isExpanded && (\r\n                    <div className={level === 1 ? \"mb-2\" : \"ml-2 border-l border-slate-700/50\"}>\r\n                        {Array.from(node.children.values()).sort((a, b) => a.name.localeCompare(b.name)).map(child => renderFolder(child, level + 1))}\r\n                        {node.items.length > 0 && (\r\n                            <div className=\"pl-4 pr-2 py-1 space-y-1\">\r\n                                {node.items.map(s => {\r\n                                    const key = `${s.botId || 'Default'}:${s.name}`;\r\n                                    return (\r\n                                        <div key={key} onClick={() => onSelect(s)} className=\"cursor-pointer px-2 py-1 rounded border border-transparent hover:border-slate-200 dark:hover:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-between transition-all select-none text-xs text-slate-600 dark:text-slate-400\">\r\n                                            <span className=\"font-mono truncate\">{s.name}</span>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 dark:bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-6 animate-in fade-in duration-200\">\r\n            <div className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl w-full max-w-2xl h-[80vh] flex flex-col shadow-2xl\">\r\n                <div className=\"p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center\">\r\n                    <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">Select Source Symbol</h3>\r\n                    <button onClick={onClose} className=\"p-1 hover:bg-slate-100 dark:hover:bg-slate-800 rounded text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors\">\r\n                        <X size={20} />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-3 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50\">\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 dark:text-slate-500\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search available symbols...\"\r\n                            value={filter}\r\n                            onChange={e => setFilter(e.target.value)}\r\n                            className=\"w-full bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg py-2 pl-9 pr-4 text-sm text-slate-900 dark:text-slate-200 focus:outline-none focus:border-emerald-500 placeholder:text-slate-400 dark:placeholder:text-slate-600\"\r\n                            autoFocus\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-4 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-slate-700 scrollbar-track-transparent\">\r\n                    {filter\r\n                        ? <div className=\"grid grid-cols-1 gap-1\">\r\n                            {availableSymbols.filter(s => s.name.toLowerCase().includes(filter.toLowerCase())).map(s => (\r\n                                <div key={`${s.botId}:${s.name}`} onClick={() => onSelect(s)} className=\"cursor-pointer px-3 py-2 rounded border border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800 flex justify-between items-center transition-colors\">\r\n                                    <div>\r\n                                        <span className=\"text-sm font-mono text-slate-700 dark:text-slate-300\">{s.name}</span>\r\n                                        <span className=\"ml-2 text-xs text-slate-500\">({getBrokerName(s.botId || '')})</span>\r\n                                    </div>\r\n                                    <CheckCircle2 size={14} className=\"text-emerald-500 dark:text-slate-600 opacity-0 hover:opacity-100\" />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        : Array.from(tree.children.values()).sort((a, b) => a.name.localeCompare(b.name)).map(brokerNode => renderFolder(brokerNode, 1))\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3029, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/dashboard/DatafeedView.tsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react';\r\nimport { Database, RefreshCw, Save, CheckCircle2, AlertCircle, Trash2, AlertTriangle, Play, Square, RotateCw, Download, Plus, Clock, Edit2, Link, Link2, Search, Power } from 'lucide-react';\r\nimport { socketService } from '../../services/socket';\r\nimport { AddAccountModal } from './AddAccountModal';\r\nimport { DatafeedSelectionModal } from './DatafeedSelectionModal';\r\nimport { fetchDirect, fetchSystem, API_URLS } from '../../lib/client-api';\r\n\r\nimport { TradingAccount } from '@/lib/mt-manager/types';\r\n\r\ninterface StatusData {\r\n    lastSeen: number;\r\n    timezone?: string;\r\n    account?: {\r\n        connected: boolean;\r\n        balance: number;\r\n    }\r\n}\r\n\r\ninterface SymbolItem {\r\n    name: string;\r\n    path: string;\r\n    desc: string;\r\n    botId?: string;\r\n}\r\n\r\ninterface BrokerInfo {\r\n    id: string;\r\n    name: string;\r\n    shorthand: string;\r\n}\r\n\r\ninterface RowItem {\r\n    id: string;\r\n    originalName: string;\r\n    source: {\r\n        botId: string;\r\n        symbol: string;\r\n    } | null;\r\n}\r\n\r\nexport function DatafeedView() {\r\n    const [availableSymbols, setAvailableSymbols] = useState<SymbolItem[]>([]);\r\n    const [brokers, setBrokers] = useState<BrokerInfo[]>([]);\r\n    const [rows, setRows] = useState<RowItem[]>([]);\r\n    const [filter, setFilter] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n    const [statusMsg, setStatusMsg] = useState<{ type: 'success' | 'error', text: string } | null>(null);\r\n    const [mappingCache, setMappingCache] = useState<Map<string, string>>(new Map());\r\n    const [mappingsLoaded, setMappingsLoaded] = useState(false);\r\n\r\n    // Modal State\r\n    const [isSelectionOpen, setIsSelectionOpen] = useState(false);\r\n    const [activeRowId, setActiveRowId] = useState<string | null>(null);\r\n\r\n    const [hasChanges, setHasChanges] = useState(false);\r\n\r\n    // Account Management\r\n    const [accounts, setAccounts] = useState<TradingAccount[]>([]);\r\n    const [statuses, setStatuses] = useState<Record<string, StatusData>>({});\r\n    const [serverTime, setServerTime] = useState<number>(Date.now());\r\n    const [loadingAction, setLoadingAction] = useState<string | null>(null);\r\n    const [updateAvailable, setUpdateAvailable] = useState<{ hasUpdate: boolean, lastDeployed: number, available: number, updatedFiles: string[] } | null>(null);\r\n    const [isUpdating, setIsUpdating] = useState(false);\r\n    const [isAddOpen, setIsAddOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchDirect('/brokers')\r\n            .then(res => res.json())\r\n            .then(data => setBrokers(data))\r\n            .catch(e => console.error(\"Failed to load brokers\", e));\r\n\r\n        fetchDirect('/mappings')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                const cache = new Map<string, string>();\r\n                if (Array.isArray(data)) {\r\n                    data.forEach((m: any) => cache.set(m.datafeedSymbol, m.originalSymbol));\r\n                }\r\n                setMappingCache(cache);\r\n            })\r\n            .catch(e => console.error(\"Failed to load mappings\", e))\r\n            .finally(() => setMappingsLoaded(true));\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const socket = socketService.getSocket();\r\n        const onSymbols = (list: any[]) => {\r\n            const normalized: SymbolItem[] = list.map(item => {\r\n                if (typeof item === 'string') return { name: item, path: 'Legacy', desc: '', botId: 'Default' };\r\n                return item;\r\n            }).filter(s => {\r\n                const id = s.botId || 'Default';\r\n                return id === 'Default' || id.endsWith('_DATAFEED');\r\n            });\r\n\r\n            setAvailableSymbols(normalized);\r\n            setLoading(false);\r\n        };\r\n\r\n        const onConfigAck = (data: any) => {\r\n            setSaving(false);\r\n            setHasChanges(false);\r\n            setStatusMsg({ type: 'success', text: `Configuration saved! Synced ${data.count} symbols.` });\r\n            setTimeout(() => setStatusMsg(null), 3000);\r\n        };\r\n\r\n        socket.on('all_symbols_list', onSymbols);\r\n        socket.on('config_ack', onConfigAck);\r\n        setLoading(true);\r\n        socket.emit('get_all_symbols'); // Cache First (Instant)\r\n\r\n        loadData();\r\n        checkUpdates();\r\n\r\n        const statusInterval = setInterval(fetchStatus, 2000);\r\n        const updateInterval = setInterval(checkUpdates, 30000);\r\n\r\n        return () => {\r\n            socket.off('all_symbols_list', onSymbols);\r\n            socket.off('config_ack', onConfigAck);\r\n            clearInterval(statusInterval);\r\n            clearInterval(updateInterval);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            try {\r\n                const res = await fetch(`${API_URLS.DIRECT_BASE}/symbols`);\r\n                const data = await res.json();\r\n                if (data.symbols && Array.isArray(data.symbols)) {\r\n                    const newRows: RowItem[] = [];\r\n                    data.symbols.forEach((s: any) => {\r\n                        // FIX: Use datafeedSymbol (Broker) if available, otherwise fallback to symbol (Internal)\r\n                        let symbol = (typeof s !== 'string' && s.datafeedSymbol) ? s.datafeedSymbol : (typeof s === 'string' ? s : s.symbol);\r\n\r\n                        // FIX: Strip BotID prefix (BotID:Symbol) to ensure we display/save only the clean Broker Symbol\r\n                        if (symbol && typeof symbol === 'string' && symbol.includes(':')) {\r\n                            symbol = symbol.split(':').pop() || symbol;\r\n                        }\r\n                        const botId = (typeof s !== 'string' && s.botId) ? s.botId : 'Default';\r\n\r\n                        // Original Name is always the Internal Symbol\r\n                        const internalName = (typeof s !== 'string' && s.originalName) ? s.originalName : (typeof s === 'string' ? s : s.symbol);\r\n                        const key = `${botId}:${symbol}`;\r\n\r\n                        // Fallback to cache or internal name\r\n                        const original = mappingCache.get(key) || internalName;\r\n\r\n                        newRows.push({\r\n                            id: crypto.randomUUID(),\r\n                            originalName: original,\r\n                            source: { botId, symbol }\r\n                        });\r\n                    });\r\n\r\n                    if (newRows.length > 0) {\r\n                        setRows(newRows.sort((a, b) => a.originalName.localeCompare(b.originalName)));\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Init Selection Error\", e);\r\n            }\r\n        };\r\n\r\n        // Only run init once mappings are loaded (or failed) and we haven't loaded rows yet\r\n        if (mappingsLoaded && rows.length === 0) {\r\n            init();\r\n        }\r\n    }, [mappingsLoaded, rows.length, mappingCache]);\r\n\r\n    const fetchStatus = async () => {\r\n        try {\r\n            const res = await fetch(`${API_URLS.DIRECT_BASE}/status/heartbeat`);\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                setStatuses(data.services);\r\n                if (data.serverTime) setServerTime(data.serverTime);\r\n            }\r\n        } catch (e) { }\r\n    };\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const accRes = await fetchDirect('/accounts');\r\n            const accData = await accRes.json();\r\n            // Support both Array and Object wrapper (API V2)\r\n            const list = Array.isArray(accData) ? accData : (accData.accounts || []);\r\n            setAccounts(list);\r\n        } catch (e) {\r\n            console.error(\"Failed to load accounts\", e);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const checkUpdates = async () => {\r\n        try {\r\n            const res = await fetchSystem('/system/check-updates');\r\n            const data = await res.json();\r\n            setUpdateAvailable(data);\r\n        } catch (e) { }\r\n    };\r\n\r\n    const handleAction = async (id: string, action: 'START' | 'STOP' | 'RESTART' | 'DELETE') => {\r\n        if (action === 'DELETE' && !confirm('Are you sure you want to delete this account?')) return;\r\n        setLoadingAction(id);\r\n        try {\r\n            const res = await fetchSystem(`/accounts/${id}/action`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ action })\r\n            });\r\n            if (res.ok) await loadData();\r\n            else {\r\n                const data = await res.json();\r\n                setStatusMsg({ type: 'error', text: `Action Failed: ${data.error || 'Unknown Error'}` });\r\n                setTimeout(() => setStatusMsg(null), 5000);\r\n            }\r\n        } catch (e) {\r\n            setStatusMsg({ type: 'error', text: \"Network Error\" });\r\n            setTimeout(() => setStatusMsg(null), 5000);\r\n        } finally {\r\n            setLoadingAction(null);\r\n        }\r\n    };\r\n\r\n    const handleRedeploy = async () => {\r\n        if (!confirm(\"Redeploy DatafeedExpert to all datafeed instances?\")) return;\r\n        setIsUpdating(true);\r\n        try {\r\n            const res = await fetchSystem('/system/update-bots', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ scope: 'DATAFEED' })\r\n            });\r\n            const data = await res.json();\r\n            setStatusMsg({ type: 'success', text: `Redeployed ${data.results?.length || 0} instances.` });\r\n            setTimeout(() => setStatusMsg(null), 5000);\r\n            await checkUpdates();\r\n            await loadData();\r\n        } catch (e: any) {\r\n            setStatusMsg({ type: 'error', text: \"Deployment Failed\" });\r\n        } finally {\r\n            setIsUpdating(false);\r\n        }\r\n    };\r\n\r\n    const handleSave = () => {\r\n        const invalid = rows.find(r => !r.originalName.trim());\r\n        if (invalid) {\r\n            setStatusMsg({ type: 'error', text: \"All rows must have an Original Symbol name.\" });\r\n            return;\r\n        }\r\n\r\n        setSaving(true);\r\n        // Filter out rows with no source\r\n        const validRows = rows.filter(r => r.source !== null);\r\n\r\n        const list = validRows.map(item => ({\r\n            symbol: item.source!.symbol,\r\n            botId: item.source!.botId,\r\n            enabled: true,\r\n            originalName: item.originalName.trim()\r\n        }));\r\n\r\n        socketService.getSocket().emit('config_update', list);\r\n    };\r\n\r\n    const getBrokerName = (botId: string) => {\r\n        const broker = brokers.find(b => botId.startsWith(b.shorthand));\r\n        return broker ? broker.name : botId.replace('_DATAFEED', '');\r\n    };\r\n\r\n    const getBotId = (acc: TradingAccount) => {\r\n        const broker = brokers.find(b => b.id === acc.brokerId);\r\n        const short = (broker?.shorthand || 'UNK').replace(/\\s+/g, '');\r\n        let id = `${short}_${acc.login}`;\r\n        if (acc.accountType === 'DATAFEED' || acc.isDatafeed) id += '_DATAFEED';\r\n        return id;\r\n    };\r\n\r\n    // Row Operations\r\n    const addRow = () => {\r\n        const newRow: RowItem = {\r\n            id: crypto.randomUUID(),\r\n            originalName: '',\r\n            source: null\r\n        };\r\n        setRows([newRow, ...rows]);\r\n        setHasChanges(true);\r\n    };\r\n\r\n    const updateRowName = (id: string, name: string) => {\r\n        setRows(rows.map(r => r.id === id ? { ...r, originalName: name } : r));\r\n        setHasChanges(true);\r\n    };\r\n\r\n    const removeRow = (id: string) => {\r\n        setRows(rows.filter(r => r.id !== id));\r\n        setHasChanges(true);\r\n    };\r\n\r\n    const openSelection = (rowId: string) => {\r\n        setActiveRowId(rowId);\r\n        setIsSelectionOpen(true);\r\n    };\r\n\r\n    const handleSelection = (symbol: SymbolItem) => {\r\n        if (activeRowId) {\r\n            setRows(rows.map(r => r.id === activeRowId ? {\r\n                ...r,\r\n                source: {\r\n                    botId: symbol.botId || 'Default',\r\n                    symbol: symbol.name\r\n                },\r\n                // If original name is empty, auto-fill it with the symbol name\r\n                originalName: r.originalName.trim() ? r.originalName : symbol.name\r\n            } : r));\r\n            setHasChanges(true);\r\n        }\r\n        setIsSelectionOpen(false);\r\n        setActiveRowId(null);\r\n    };\r\n\r\n    const filteredRows = useMemo(() => {\r\n        if (!filter) return rows;\r\n        const lower = filter.toLowerCase();\r\n        return rows.filter(r =>\r\n            r.originalName.toLowerCase().includes(lower) ||\r\n            (r.source && r.source.symbol.toLowerCase().includes(lower))\r\n        );\r\n    }, [rows, filter]);\r\n\r\n    const handleRefreshAll = async () => {\r\n        await loadData();\r\n        // Refresh brokers to ensure any newly initialized broker connections are reflected\r\n        try {\r\n            const res = await fetchDirect('/brokers');\r\n            if (res.ok) setBrokers(await res.json());\r\n        } catch (e) { console.error(\"Failed to refresh brokers\", e); }\r\n\r\n        // Trigger symbol refresh from backend\r\n        setLoading(true);\r\n        socketService.getSocket().emit('refresh_symbols');\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col p-6 animate-in fade-in zoom-in-95 duration-300\">\r\n            <header className=\"mb-6 flex justify-between items-end border-b border-slate-300 dark:border-slate-800 pb-4 shrink-0\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2\">\r\n                        <Database className=\"text-emerald-500 dark:text-emerald-400\" /> Datafeeds & Symbols\r\n                    </h2>\r\n                    <p className=\"text-slate-500 dark:text-slate-500 mt-1 text-sm\">Manage your trading symbols and their datafeed sources.</p>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    {updateAvailable?.hasUpdate && (updateAvailable.updatedFiles?.includes('DatafeedExpert.ex5') || updateAvailable.updatedFiles?.includes('TickSpy.ex5') || updateAvailable.updatedFiles?.includes('HistoryWorker.ex5')) && (\r\n                        <button onClick={handleRedeploy} disabled={isUpdating} className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg shadow-lg transition-all text-sm\">\r\n                            {isUpdating ? <RefreshCw className=\"animate-spin\" size={16} /> : <Download size={16} />}\r\n                            Redeploy DatafeedExpert\r\n                        </button>\r\n                    )}\r\n                    <button onClick={() => socketService.getSocket().emit('refresh_symbols')} className=\"p-2 text-slate-500 hover:text-slate-900 bg-slate-100 hover:bg-slate-200 dark:text-slate-400 dark:hover:text-white dark:bg-slate-800 dark:hover:bg-slate-700 rounded-lg transition-colors\" title=\"Refresh from Broker\">\r\n                        <RefreshCw size={18} className={loading ? \"animate-spin\" : \"\"} />\r\n                    </button>\r\n                    <button onClick={() => setIsAddOpen(true)} className=\"flex items-center gap-2 px-4 py-2 bg-emerald-600/10 hover:bg-emerald-600/20 text-emerald-400 font-bold rounded-lg border border-emerald-500/20 transition-all active:scale-95 text-sm\">\r\n                        <Plus size={16} /> Add New Datafeed\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSave}\r\n                        disabled={saving}\r\n                        className={`flex items-center gap-2 px-6 py-2 font-bold rounded-lg shadow-lg transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${hasChanges ? 'bg-amber-600 hover:bg-amber-500 text-white animate-pulse' : 'bg-emerald-600 hover:bg-emerald-500 text-white'}`}\r\n                    >\r\n                        {saving ? <RefreshCw className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                        {hasChanges ? 'Save Changes' : 'Saved'}\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"mb-8\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2\">\r\n                        <Power size={14} className=\"text-emerald-500\" /> Active Datafeed Sources\r\n                    </h3>\r\n                </div>\r\n                <div className=\"flex flex-wrap gap-4\">\r\n                    {accounts.filter(a => a.accountType === 'DATAFEED' || a.isDatafeed).map(acc => (\r\n                        <CompactAccountCard\r\n                            key={acc.id}\r\n                            acc={acc}\r\n                            status={statuses[getBotId(acc)]}\r\n                            serverTime={serverTime}\r\n                            loading={loadingAction === acc.id || isUpdating}\r\n                            onAction={handleAction}\r\n                            brokerName={brokers.find(b => b.id === acc.brokerId)?.name || 'Unknown'}\r\n                        />\r\n                    ))}\r\n                    {accounts.filter(a => a.accountType === 'DATAFEED' || a.isDatafeed).length === 0 && (\r\n                        <div className=\"text-sm text-slate-500 italic py-2\">No datafeed sources connected.</div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {statusMsg && (\r\n                <div className={`mb-4 p-3 rounded-lg flex items-center gap-2 ${statusMsg?.type === 'success' ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20' : 'bg-red-500/10 text-red-400 border border-red-500/20'}`}>\r\n                    {statusMsg?.type === 'success' ? <CheckCircle2 size={18} /> : <AlertCircle size={18} />}\r\n                    {statusMsg?.text}\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"flex-1 flex flex-col bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700/50 rounded-xl overflow-hidden shadow-sm dark:shadow-inner\">\r\n                <div className=\"p-3 border-b border-slate-300 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 flex justify-between items-center\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"relative w-64\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-500\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Filter symbols...\"\r\n                                value={filter}\r\n                                onChange={e => setFilter(e.target.value)}\r\n                                className=\"w-full bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg py-1.5 pl-9 pr-4 text-sm text-slate-900 dark:text-slate-200 focus:outline-none focus:border-emerald-500 placeholder:text-slate-400\"\r\n                            />\r\n                        </div>\r\n                        <span className=\"text-xs text-slate-500\">{rows.length} symbols defined</span>\r\n                    </div>\r\n                    <button onClick={addRow} className=\"flex items-center gap-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded border border-indigo-400/20 transition-all text-xs\">\r\n                        <Plus size={14} /> Add Symbol\r\n                    </button>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"flex-1 flex items-center justify-center\">\r\n                        <div className=\"flex flex-col items-center gap-4\">\r\n                            <div className=\"w-8 h-8 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin\" />\r\n                            <p className=\"text-slate-400 text-sm\">Loading Symbols...</p>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex-1 overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent\">\r\n                        <table className=\"w-auto text-left border-collapse\">\r\n                            <thead>\r\n                                <tr className=\"text-xs text-slate-500 uppercase border-b border-slate-300 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50\">\r\n                                    <th className=\"px-3 py-1.5 w-[160px] font-medium\">Symbol Name</th>\r\n                                    <th className=\"px-3 py-1.5 min-w-[200px] font-medium\">Source</th>\r\n                                    <th className=\"px-3 py-1.5 w-[40px] text-right\"></th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800/50\">\r\n                                {filteredRows.length === 0 && (\r\n                                    <tr>\r\n                                        <td colSpan={3} className=\"p-8 text-center text-slate-600 italic\">\r\n                                            No symbols defined. Click \"Add Symbol\" to start.\r\n                                        </td>\r\n                                    </tr>\r\n                                )}\r\n                                {filteredRows.map(row => (\r\n                                    <tr key={row.id} className=\"hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors group\">\r\n                                        <td className=\"p-2\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={row.originalName}\r\n                                                onChange={e => updateRowName(row.id, e.target.value)}\r\n                                                placeholder=\"e.g. BTCUSD\"\r\n                                                className=\"w-full bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded px-3 py-2 text-sm font-bold text-slate-900 dark:text-white focus:outline-none focus:border-emerald-500 font-mono transition-colors\"\r\n                                            />\r\n                                        </td>\r\n                                        <td className=\"p-2\">\r\n                                            {row.source ? (\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <div\r\n                                                        onClick={() => openSelection(row.id)}\r\n                                                        className=\"flex-1 flex items-center justify-between px-3 py-2 bg-slate-50 hover:bg-white dark:bg-slate-800 dark:hover:bg-slate-700/80 border border-slate-200 dark:border-slate-700 rounded hover:border-slate-300 dark:hover:border-slate-500 cursor-pointer group/source transition-all\"\r\n                                                    >\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <span className=\"text-xs text-emerald-600 dark:text-emerald-400 font-mono\">{getBrokerName(row.source.botId)}</span>\r\n                                                            <span className=\"text-slate-400 dark:text-slate-600 text-xs\">/</span>\r\n                                                            <span className=\"text-sm font-bold text-slate-700 dark:text-slate-200 font-mono\">{row.source.symbol}</span>\r\n                                                        </div>\r\n                                                        <Edit2 size={14} className=\"text-slate-500 opacity-0 group-hover/source:opacity-100 transition-opacity\" />\r\n                                                    </div>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <button\r\n                                                    onClick={() => openSelection(row.id)}\r\n                                                    className=\"w-full flex items-center justify-center gap-2 px-3 py-2 border border-dashed border-slate-300 dark:border-slate-700 rounded text-slate-400 dark:text-slate-500 hover:text-indigo-500 dark:hover:text-white hover:border-indigo-400 dark:hover:border-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-all text-sm\"\r\n                                                >\r\n                                                    <Link2 size={16} /> Assign Source\r\n                                                </button>\r\n                                            )}\r\n                                        </td>\r\n                                        <td className=\"p-2 text-right\">\r\n                                            <button\r\n                                                onClick={() => removeRow(row.id)}\r\n                                                className=\"p-2 text-slate-400 dark:text-slate-600 hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-500/10 rounded transition-colors\"\r\n                                                title=\"Remove Symbol\"\r\n                                            >\r\n                                                <Trash2 size={16} />\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {isAddOpen && (\r\n                <AddAccountModal\r\n                    onClose={() => setIsAddOpen(false)}\r\n                    onSuccess={handleRefreshAll}\r\n                    title=\"New Datafeed\"\r\n                    initialType=\"DATAFEED\"\r\n                    existingAccounts={accounts}\r\n                />\r\n            )}\r\n\r\n            <DatafeedSelectionModal\r\n                isOpen={isSelectionOpen}\r\n                onClose={() => { setIsSelectionOpen(false); setActiveRowId(null); }}\r\n                onSelect={handleSelection}\r\n                availableSymbols={availableSymbols}\r\n                brokers={brokers}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction CompactAccountCard({ acc, status, serverTime, loading, onAction, brokerName }: {\r\n    acc: TradingAccount;\r\n    status: StatusData;\r\n    serverTime: number;\r\n    loading: boolean;\r\n    onAction: (id: string, action: 'START' | 'STOP' | 'RESTART' | 'DELETE') => void;\r\n    brokerName: string;\r\n}) {\r\n    const isRunning = acc.status === 'RUNNING';\r\n    const lastSeen = status?.lastSeen || 0;\r\n    const isAlive = (serverTime - lastSeen) < 30000;\r\n    const accOk = isAlive ? !!status?.account?.connected : (acc.brokerConnectionStatus === 'CONNECTED');\r\n    const tz = status?.timezone || '??';\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-slate-900 border border-slate-300 dark:border-emerald-500/20 rounded-xl p-3 flex items-center gap-4 min-w-[280px] shadow-sm dark:shadow-lg relative group transition-colors\">\r\n            <div className={`w-2 h-8 rounded-full ${isRunning ? (isAlive ? 'bg-emerald-500' : 'bg-amber-500') : 'bg-slate-300 dark:bg-slate-800'}`} />\r\n            <div className=\"flex-1 min-w-0\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <span className=\"font-bold text-slate-900 dark:text-white text-sm truncate\">{brokerName}</span>\r\n                    <span className=\"text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 px-1.5 py-0.5 rounded font-mono\">{acc.login}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center mt-1\">\r\n                    <div className=\"flex gap-1.5\">\r\n                        <div className={`w-1.5 h-1.5 rounded-full ${isRunning ? 'bg-emerald-500' : 'bg-slate-300 dark:bg-slate-700'}`} title=\"MT5 Status\" />\r\n                        <div className={`w-1.5 h-1.5 rounded-full ${isAlive ? 'bg-emerald-500' : 'bg-slate-300 dark:bg-slate-700'}`} title=\"EA Status\" />\r\n                        <div className={`w-1.5 h-1.5 rounded-full ${accOk ? 'bg-emerald-500' : 'bg-red-500'}`} title=\"Broker Connection\" />\r\n                    </div>\r\n                    <span className=\"text-[10px] text-slate-500 font-mono bg-slate-50 dark:bg-slate-950 px-1 rounded flex items-center gap-1\" title=\"Broker Timezone\">\r\n                        <Clock size={10} /> {tz.split('/')[1] || tz}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-1 border-l border-slate-200 dark:border-slate-800 pl-3\">\r\n                {!isRunning ? (\r\n                    <button onClick={() => onAction(acc.id, 'START')} className=\"p-1.5 hover:bg-emerald-50 dark:hover:bg-emerald-500/20 text-emerald-500 dark:text-emerald-400 rounded transition-colors\" title=\"Start\"><Play size={14} /></button>\r\n                ) : (\r\n                    <button onClick={() => onAction(acc.id, 'STOP')} className=\"p-1.5 hover:bg-red-50 dark:hover:bg-red-500/20 text-red-500 dark:text-red-400 rounded transition-colors\" title=\"Stop\"><Square size={14} /></button>\r\n                )}\r\n                <button onClick={() => onAction(acc.id, 'RESTART')} className=\"p-1.5 hover:bg-amber-50 dark:hover:bg-amber-500/20 text-amber-500 dark:text-amber-400 rounded transition-colors\" title=\"Restart\"><RotateCw size={14} /></button>\r\n                <button onClick={() => onAction(acc.id, 'DELETE')} className=\"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/40 text-slate-400 dark:text-slate-600 hover:text-red-500 rounded transition-colors\" title=\"Delete\"><Trash2 size={14} /></button>\r\n            </div>\r\n            {loading && (\r\n                <div className=\"absolute inset-0 bg-white/60 dark:bg-black/40 backdrop-blur-[1px] flex items-center justify-center rounded-xl z-10\">\r\n                    <RefreshCw className=\"animate-spin text-indigo-600 dark:text-white\" size={20} />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4219, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/dashboard/DistributionView.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\r\nimport { Share2, Save, RefreshCw, Layers, Activity, CheckCircle2, ChevronDown, ChevronRight, X, Download } from 'lucide-react';\r\nimport { fetchDirect, fetchSystem } from '../../lib/client-api';\r\n\r\ninterface DistributionConfig {\r\n    brokers: {\r\n        [brokerId: string]: {\r\n            loop_size: number;\r\n            matrix: { [step: string]: string[]; }\r\n        }\r\n    };\r\n    test_brokers?: {\r\n        [brokerId: string]: {\r\n            loop_size: number;\r\n            matrix: { [step: string]: string[]; }\r\n        }\r\n    };\r\n}\r\n\r\nexport function DistributionView() {\r\n    const [config, setConfig] = useState<DistributionConfig>({ brokers: {} });\r\n    const [accounts, setAccounts] = useState<any[]>([]);\r\n    const [brokers, setBrokers] = useState<any[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [expandedBrokerId, setExpandedBrokerId] = useState<string | null>(null);\r\n    const [statusMsg, setStatusMsg] = useState<{ type: 'success' | 'error', text: string } | null>(null);\r\n    const [isTestMode, setIsTestMode] = useState(false); // New Toggle\r\n    const [updateAvailable, setUpdateAvailable] = useState<{ hasUpdate: boolean, lastDeployed: number, available: number, updatedFiles: string[] } | null>(null);\r\n    const [isUpdating, setIsUpdating] = useState(false);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n        checkUpdates();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const [confRes, accRes, brokerRes] = await Promise.all([\r\n                fetchDirect('/distribution/config'),\r\n                fetchDirect('/accounts'),\r\n                fetchDirect('/brokers')\r\n            ]);\r\n\r\n            if (confRes.ok) setConfig(await confRes.json());\r\n            if (accRes.ok) {\r\n                const accData = await accRes.json();\r\n                setAccounts(Array.isArray(accData) ? accData : (accData?.accounts || []));\r\n            }\r\n            if (brokerRes.ok) setBrokers(await brokerRes.json());\r\n\r\n        } catch (e) {\r\n            console.error(\"Failed to load distribution data\", e);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const getGroupConfig = (cfg: DistributionConfig, test: boolean) => {\r\n        return test ? (cfg.test_brokers || {}) : cfg.brokers;\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        // Clean up stale account IDs\r\n        const validAccountIds = new Set(accounts.map(a => a.id));\r\n        const cleanedConfig = { ...config };\r\n\r\n        // Ensure roots exist\r\n        if (!cleanedConfig.brokers) cleanedConfig.brokers = {};\r\n        if (!cleanedConfig.test_brokers) cleanedConfig.test_brokers = {};\r\n\r\n        // Determine target map based on current mode (we auto-generate for the CURRENT mode)\r\n        const targetMap = isTestMode ? cleanedConfig.test_brokers : cleanedConfig.brokers;\r\n\r\n        // 1. Auto-Generate Defaults if missing\r\n        activeBrokers.forEach(broker => {\r\n            if (!targetMap[broker.id]) {\r\n                // Filter accounts for this broker AND mode\r\n                const brokerAccounts = accounts.filter(a =>\r\n                    a.brokerId === broker.id &&\r\n                    (a.accountType === 'TRADING' || !a.isDatafeed) &&\r\n                    (isTestMode ? a.isTest : !a.isTest)\r\n                );\r\n\r\n                const N = brokerAccounts.length;\r\n\r\n                if (N > 0) {\r\n                    const defaultMatrix: Record<string, string[]> = {};\r\n                    brokerAccounts.forEach((acc, idx) => {\r\n                        defaultMatrix[String(idx + 1)] = [acc.id];\r\n                    });\r\n\r\n                    targetMap[broker.id] = {\r\n                        loop_size: N,\r\n                        matrix: defaultMatrix\r\n                    };\r\n                    console.log(`[DistributionView] Auto-generated default matrix for ${broker.name} (${isTestMode ? 'TEST' : 'LIVE'})`);\r\n                }\r\n            }\r\n        });\r\n\r\n        // 2. Clean existing matrices (Both Live and Test)\r\n        [cleanedConfig.brokers, cleanedConfig.test_brokers].forEach(map => {\r\n            if (!map) return;\r\n            Object.keys(map).forEach(brokerId => {\r\n                const matrix = map[brokerId].matrix;\r\n                Object.keys(matrix).forEach(step => {\r\n                    matrix[step] = matrix[step].filter(id => validAccountIds.has(id));\r\n                });\r\n            });\r\n        });\r\n\r\n        try {\r\n            const res = await fetchDirect('/distribution/config', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(cleanedConfig)\r\n            });\r\n            if (res.ok) {\r\n                setConfig(cleanedConfig);\r\n                setStatusMsg({ type: 'success', text: \"Matrix saved and cleaned successfully!\" });\r\n                setTimeout(() => setStatusMsg(null), 3000);\r\n            }\r\n        } catch (e) {\r\n            setStatusMsg({ type: 'error', text: \"Failed to save matrix.\" });\r\n        }\r\n    };\r\n\r\n    const checkUpdates = async () => {\r\n        try {\r\n            const res = await fetchSystem('/system/check-updates');\r\n            const data = await res.json();\r\n            setUpdateAvailable(data);\r\n        } catch (e) { }\r\n    };\r\n\r\n    const handleRedeploy = async () => {\r\n        if (!confirm(\"Redeploy TradingExpert to all trading instances? (MT5 will restart)\")) return;\r\n        setIsUpdating(true);\r\n        try {\r\n            const res = await fetchSystem('/system/update-bots', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ scope: 'TRADING' })\r\n            });\r\n            const data = await res.json();\r\n            setStatusMsg({ type: 'success', text: `Redeployed ${data.results?.length || 0} instances.` });\r\n            setTimeout(() => setStatusMsg(null), 5000);\r\n            await checkUpdates();\r\n        } catch (e: any) {\r\n            setStatusMsg({ type: 'error', text: \"Deployment Failed\" });\r\n        } finally {\r\n            setIsUpdating(false);\r\n        }\r\n    };\r\n\r\n    const toggleBroker = (brokerId: string) => {\r\n        setExpandedBrokerId(expandedBrokerId === brokerId ? null : brokerId);\r\n    };\r\n\r\n    const updateMatrix = (brokerId: string, step: string, accountId: string) => {\r\n        setConfig(prev => {\r\n            const isTest = isTestMode;\r\n            const targetRoot = isTest ? 'test_brokers' : 'brokers';\r\n\r\n            // Get current section safely\r\n            const currentMap = { ...(isTest ? (prev.test_brokers || {}) : prev.brokers) };\r\n            const currentBroker = currentMap[brokerId] || { loop_size: 1, matrix: {} };\r\n            const currentStepAccs = currentBroker.matrix[step] || [];\r\n\r\n            const nextStepAccs = currentStepAccs.includes(accountId)\r\n                ? currentStepAccs.filter(id => id !== accountId)\r\n                : [...currentStepAccs, accountId];\r\n\r\n            const updatedMap = {\r\n                ...currentMap,\r\n                [brokerId]: {\r\n                    ...currentBroker,\r\n                    matrix: {\r\n                        ...currentBroker.matrix,\r\n                        [step]: nextStepAccs\r\n                    }\r\n                }\r\n            };\r\n\r\n            return {\r\n                ...prev,\r\n                [targetRoot]: updatedMap\r\n            };\r\n        });\r\n    };\r\n\r\n    // Filter brokers that have at least one valid account for current mode\r\n    const activeBrokers = useMemo(() => {\r\n        if (!Array.isArray(accounts)) return [];\r\n        return brokers.filter(broker =>\r\n            accounts.some(acc =>\r\n                acc.brokerId === broker.id &&\r\n                (acc.accountType === 'TRADING' || !acc.isDatafeed) &&\r\n                (isTestMode ? acc.isTest : !acc.isTest)\r\n            )\r\n        );\r\n    }, [brokers, accounts, isTestMode]);\r\n\r\n    const renderMatrix = (brokerId: string) => {\r\n        // Filter Accounts for this Broker AND Mode\r\n        const brokerAccounts = accounts.filter(a =>\r\n            a.brokerId === brokerId &&\r\n            (a.accountType === 'TRADING' || !a.isDatafeed) &&\r\n            (isTestMode ? a.isTest : !a.isTest)\r\n        );\r\n\r\n        // Get Config Logic\r\n        const brokerConfig = (isTestMode ? config.test_brokers : config.brokers)?.[brokerId];\r\n\r\n        const N = brokerAccounts.length;\r\n        const matrix = brokerConfig?.matrix || {};\r\n\r\n        if (N === 0) {\r\n            return <div className=\"p-4 text-slate-500 italic text-center\">No {isTestMode ? 'Test' : 'Live'} Accounts for this broker.</div>\r\n        }\r\n\r\n        return (\r\n            <div className=\"mt-4 border border-slate-300 dark:border-slate-700 rounded-xl overflow-hidden bg-slate-50 dark:bg-slate-950/40 animate-in slide-in-from-top-2 duration-200 shadow-sm\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full border-collapse\">\r\n                        <thead>\r\n                            <tr className=\"bg-slate-100 dark:bg-slate-800/50\">\r\n                                <th className=\"p-3 text-left text-[10px] font-bold text-slate-500 uppercase tracking-wider border-r border-slate-300 dark:border-slate-700 sticky left-0 z-10 bg-slate-100 dark:bg-slate-800/80 backdrop-blur-sm min-w-[200px]\">Trading Account</th>\r\n                                {Array.from({ length: N }).map((_, i) => (\r\n                                    <th key={i} className=\"p-3 text-center text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-wider min-w-[80px] border-r border-slate-300 dark:border-slate-700\">\r\n                                        Trade {i + 1}\r\n                                    </th>\r\n                                ))}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {brokerAccounts.map((acc, rowIndex) => (\r\n                                <tr key={acc.id} className=\"border-b border-slate-200 dark:border-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800/20 transition-colors\">\r\n                                    <td className=\"p-3 border-r border-slate-200 dark:border-slate-700 sticky left-0 z-10 bg-white/90 dark:bg-slate-900/90 backdrop-blur-sm\">\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-xs font-bold text-slate-900 dark:text-slate-200 truncate flex items-center gap-2\">\r\n                                                {acc.accountName || 'Login ' + acc.login}\r\n                                                {acc.isTest && <span className=\"text-[9px] bg-amber-500/20 text-amber-600 dark:text-amber-500 px-1 rounded\">TEST</span>}\r\n                                            </span>\r\n                                            <span className=\"text-[9px] font-mono text-slate-500\">{acc.login}</span>\r\n                                        </div>\r\n                                    </td>\r\n                                    {Array.from({ length: N }).map((_, colIndex) => {\r\n                                        const step = String(colIndex + 1);\r\n                                        const isChecked = brokerConfig\r\n                                            ? (matrix[step]?.includes(acc.id) || false)\r\n                                            : rowIndex === colIndex;\r\n\r\n                                        return (\r\n                                            <td key={colIndex} className=\"p-1 border-r border-slate-200 dark:border-slate-700 text-center\">\r\n                                                <button\r\n                                                    onClick={() => {\r\n                                                        if (!brokerConfig) {\r\n                                                            // Initialize Logic (unchanged concept, just updated path)\r\n                                                            const initMatrix: any = {};\r\n                                                            brokerAccounts.forEach((fa, idx) => {\r\n                                                                initMatrix[String(idx + 1)] = [fa.id];\r\n                                                            });\r\n\r\n                                                            const currentAccsInStep = initMatrix[step] || [];\r\n                                                            const nextStepAccs = currentAccsInStep.includes(acc.id)\r\n                                                                ? currentAccsInStep.filter((id: string) => id !== acc.id)\r\n                                                                : [...currentAccsInStep, acc.id];\r\n\r\n                                                            // Create initial broker entry in correct map\r\n                                                            setConfig(prev => {\r\n                                                                const isTest = isTestMode;\r\n                                                                const targetRoot = isTest ? 'test_brokers' : 'brokers';\r\n                                                                const currentMap = isTest ? (prev.test_brokers || {}) : prev.brokers;\r\n\r\n                                                                return {\r\n                                                                    ...prev,\r\n                                                                    [targetRoot]: {\r\n                                                                        ...currentMap,\r\n                                                                        [brokerId]: {\r\n                                                                            loop_size: N,\r\n                                                                            matrix: { ...initMatrix, [step]: nextStepAccs }\r\n                                                                        }\r\n                                                                    }\r\n                                                                };\r\n                                                            });\r\n                                                        } else {\r\n                                                            updateMatrix(brokerId, step, acc.id);\r\n                                                            // Auto-grow loop size if needed\r\n                                                            if (brokerConfig.loop_size < N) {\r\n                                                                setConfig(prev => {\r\n                                                                    const isTest = isTestMode;\r\n                                                                    const targetRoot = isTest ? 'test_brokers' : 'brokers';\r\n                                                                    const currentMap = isTest ? (prev.test_brokers || {}) : prev.brokers;\r\n\r\n                                                                    return {\r\n                                                                        ...prev,\r\n                                                                        [targetRoot]: {\r\n                                                                            ...currentMap,\r\n                                                                            [brokerId]: { ...currentMap[brokerId], loop_size: N }\r\n                                                                        }\r\n                                                                    };\r\n                                                                });\r\n                                                            }\r\n                                                        }\r\n                                                    }}\r\n                                                    className={cn(\r\n                                                        \"w-full h-8 rounded flex items-center justify-center transition-all font-bold text-sm\",\r\n                                                        isChecked\r\n                                                            ? (isTestMode\r\n                                                                ? \"bg-amber-600 text-white shadow-[0_0_10px_rgba(245,158,11,0.3)]\"\r\n                                                                : \"bg-indigo-600 text-white shadow-[0_0_10px_rgba(79,70,229,0.3)]\"\r\n                                                            )\r\n                                                            : \"bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-transparent text-slate-400 dark:text-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-600 dark:hover:text-slate-500\"\r\n                                                    )}\r\n                                                >\r\n                                                    {isChecked ? 'X' : ''}\r\n                                                </button>\r\n                                            </td>\r\n                                        );\r\n                                    })}\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n                <div className=\"p-3 bg-slate-50 dark:bg-slate-900/50 flex justify-between items-center text-[10px] border-t border-slate-200 dark:border-slate-800\">\r\n                    <div className=\"flex items-center gap-2 text-slate-500 italic\">\r\n                        <Activity size={12} className={isTestMode ? \"text-amber-500\" : \"text-emerald-500\"} />\r\n                        Sequence through Trade 1 to {N}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"h-full flex items-center justify-center\">\r\n                <RefreshCw className=\"animate-spin text-indigo-500\" size={32} />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col p-8 animate-in fade-in zoom-in-95 duration-300\">\r\n            <header className=\"mb-8 flex justify-between items-center border-b border-slate-300 dark:border-slate-800 pb-6 shrink-0\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3\">\r\n                        <Share2 className={isTestMode ? \"text-amber-500\" : \"text-indigo-600 dark:text-indigo-400\"} />\r\n                        Trade Distribution\r\n                        {isTestMode && <span className=\"text-sm bg-amber-500 text-black px-2 py-0.5 rounded font-bold uppercase\">Test Mode</span>}\r\n                    </h2>\r\n                    <p className=\"text-slate-500 dark:text-slate-400 mt-1\">Configure {isTestMode ? 'TEST' : 'LIVE'} execution matrix per broker</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    {/* REDEPLOY BUTTON */}\r\n                    {updateAvailable?.hasUpdate && (updateAvailable.updatedFiles?.includes('TradingExpert.ex5') || updateAvailable.updatedFiles?.includes('TradeInfo.ex5')) && (\r\n                        <button\r\n                            onClick={handleRedeploy}\r\n                            disabled={isUpdating}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg shadow-lg transition-all text-sm disabled:opacity-50\"\r\n                        >\r\n                            {isUpdating ? <RefreshCw className=\"animate-spin\" size={16} /> : <Download size={16} />}\r\n                            Redeploy TradingExpert\r\n                        </button>\r\n                    )}\r\n\r\n                    {/* MODE TOGGLE */}\r\n                    <div className=\"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg border border-slate-200 dark:border-slate-800\">\r\n                        <button\r\n                            onClick={() => setIsTestMode(false)}\r\n                            className={cn(\r\n                                \"px-4 py-1.5 rounded-md text-sm font-bold transition-all\",\r\n                                !isTestMode ? \"bg-indigo-600 text-white shadow\" : \"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            LIVE\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setIsTestMode(true)}\r\n                            className={cn(\r\n                                \"px-4 py-1.5 rounded-md text-sm font-bold transition-all\",\r\n                                isTestMode ? \"bg-amber-500 text-black shadow\" : \"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            TEST\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"w-px h-8 bg-slate-200 dark:bg-slate-800 mx-2\"></div>\r\n\r\n                    {statusMsg && (\r\n                        <div className={cn(\r\n                            \"px-4 py-2 rounded-lg text-sm font-medium animate-in fade-in slide-in-from-right-4\",\r\n                            statusMsg.type === 'success' ? \"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border border-emerald-500/20\" : \"bg-red-500/10 text-red-600 dark:text-red-400 border border-red-500/20\"\r\n                        )}>\r\n                            {statusMsg.text}\r\n                        </div>\r\n                    )}\r\n                    <button\r\n                        onClick={handleSave}\r\n                        className={cn(\r\n                            \"text-white px-6 py-2 rounded-lg flex items-center gap-2 transition-all font-bold shadow-lg active:scale-95\",\r\n                            isTestMode\r\n                                ? \"bg-amber-600 hover:bg-amber-500 shadow-amber-500/20\"\r\n                                : \"bg-indigo-600 hover:bg-indigo-500 shadow-indigo-500/20\"\r\n                        )}\r\n                    >\r\n                        <Save size={18} /> Save All ({isTestMode ? 'Test' : 'Live'})\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"flex-1 overflow-y-auto pr-2 space-y-4 scrollbar-thin scrollbar-thumb-slate-800 scrollbar-track-transparent\">\r\n                {activeBrokers.length > 0 ? activeBrokers.map(broker => {\r\n                    const isExpanded = expandedBrokerId === broker.id;\r\n                    const brokerAccCount = accounts.filter(a =>\r\n                        a.brokerId === broker.id &&\r\n                        (a.accountType === 'TRADING' || !a.isDatafeed) &&\r\n                        (isTestMode ? a.isTest : !a.isTest)\r\n                    ).length;\r\n\r\n                    return (\r\n                        <div key={broker.id} className={cn(\r\n                            \"rounded-2xl border transition-all duration-300\",\r\n                            isExpanded\r\n                                ? (isTestMode ? \"bg-white dark:bg-slate-900/50 border-amber-500/50 p-6 shadow-xl\" : \"bg-white dark:bg-slate-900/50 border-indigo-500/50 p-6 shadow-xl\")\r\n                                : \"bg-white dark:bg-slate-900 border-slate-300 dark:border-slate-800 p-4 hover:border-slate-400 dark:hover:border-slate-700 cursor-pointer shadow-sm\"\r\n                        )} onClick={() => !isExpanded && toggleBroker(broker.id)}>\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className={cn(\r\n                                        \"w-12 h-12 rounded-xl flex items-center justify-center font-bold text-sm transition-colors\",\r\n                                        isExpanded\r\n                                            ? (isTestMode ? \"bg-amber-600 text-white\" : \"bg-indigo-600 text-white\")\r\n                                            : \"bg-slate-100 dark:bg-slate-850 text-slate-500 dark:text-slate-500\"\r\n                                    )}>\r\n                                        {broker.shorthand.substring(0, 2)}\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">{broker.name}</h3>\r\n                                            <span className=\"text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-500 px-2 py-0.5 rounded-full uppercase tracking-tighter\">Broker</span>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-4 mt-1\">\r\n                                            <div className=\"flex items-center gap-1.5 text-xs text-slate-500\">\r\n                                                <Layers size={14} className={isTestMode ? \"text-amber-500\" : \"text-indigo-500\"} />\r\n                                                {brokerAccCount} {isTestMode ? 'Test' : 'Live'} Accounts\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    {isExpanded && (\r\n                                        <button onClick={(e) => { e.stopPropagation(); toggleBroker(broker.id); }} className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-500 transition-colors\">\r\n                                            <X size={20} />\r\n                                        </button>\r\n                                    )}\r\n                                    {!isExpanded && <ChevronRight className=\"text-slate-400 dark:text-slate-700\" />}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {isExpanded && renderMatrix(broker.id)}\r\n                        </div>\r\n                    );\r\n                }) : (\r\n                    <div className=\"flex flex-col items-center justify-center py-24 text-slate-600 bg-slate-900/30 border-2 border-dashed border-slate-800 rounded-3xl\">\r\n                        <Layers size={64} className=\"opacity-10 mb-4\" />\r\n                        <p className=\"font-medium text-lg\">No {isTestMode ? 'Test' : 'Live'} Trading Brokers Active</p>\r\n                        <p className=\"text-sm\">Connect a {isTestMode ? 'Test' : 'Live'} trading account from the Accounts view to begin.</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n\r\nfunction cn(...classes: (string | undefined | null | boolean)[]) {\r\n    return classes.filter(Boolean).join(\" \");\r\n}\r\n"],"names":[],"mappings":"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"}}]
}