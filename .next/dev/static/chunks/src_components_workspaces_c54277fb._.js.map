{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/WorkspaceTabs.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useWorkspaceStore } from '../../stores/useWorkspaceStore';\r\nimport { Plus, X, LayoutTemplate } from 'lucide-react';\r\n\r\nexport const WorkspaceTabs: React.FC = () => {\r\n    const { workspaces, activeWorkspaceId, setActiveWorkspace, addWorkspace, removeWorkspace } = useWorkspaceStore();\r\n    const [isEditing, setIsEditing] = useState<string | null>(null);\r\n\r\n    const handleAdd = () => {\r\n        addWorkspace(`Workspace ${workspaces.length + 1}`);\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-1 overflow-x-auto no-scrollbar\">\r\n            {workspaces.map(w => (\r\n                <div\r\n                    key={w.id}\r\n                    onClick={() => setActiveWorkspace(w.id)}\r\n                    className={`\r\n                        group flex items-center gap-2 px-3 py-1.5 rounded-t-lg border-t border-l border-r border-transparent cursor-pointer select-none text-xs font-medium transition-all\r\n                        ${w.id === activeWorkspaceId\r\n                            ? 'bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-800 text-blue-600 dark:text-blue-400'\r\n                            : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-900/50'}\r\n                    `}\r\n                >\r\n                    <span className=\"flex items-center gap-1.5\">\r\n                        <span className=\"font-bold\">{w.panes?.[0]?.symbol || w.name}</span>\r\n                    </span>\r\n\r\n                    {/* Close Button (Visible) */}\r\n                    <button\r\n                        onClick={(e) => { e.stopPropagation(); removeWorkspace(w.id); }}\r\n                        className=\"relative z-20 p-0.5 text-slate-400 hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-500/10 rounded transition-colors ml-2 flex-shrink-0\"\r\n                        title=\"Close Workspace\"\r\n                    >\r\n                        <X size={14} />\r\n                    </button>\r\n                </div>\r\n            ))}\r\n\r\n            <button\r\n                onClick={handleAdd}\r\n                className=\"ml-1 p-1.5 text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded transition-colors\"\r\n                title=\"New Workspace\"\r\n            >\r\n                <Plus size={14} />\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;;;;;;AAEO,MAAM,gBAA0B;;IACnC,MAAM,EAAE,UAAU,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,YAAY,EAAE,eAAe,EAAE,GAAG,IAAA,0JAAiB;IAC9G,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAgB;IAE1D,MAAM,YAAY;QACd,aAAa,CAAC,UAAU,EAAE,WAAW,MAAM,GAAG,GAAG;IACrD;IAEA,qBACI,6LAAC;QAAI,WAAU;;YACV,WAAW,GAAG,CAAC,CAAA,kBACZ,6LAAC;oBAEG,SAAS,IAAM,mBAAmB,EAAE,EAAE;oBACtC,WAAW,CAAC;;wBAER,EAAE,EAAE,EAAE,KAAK,oBACL,0GACA,8GAA8G;oBACxH,CAAC;;sCAED,6LAAC;4BAAK,WAAU;sCACZ,cAAA,6LAAC;gCAAK,WAAU;0CAAa,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,UAAU,EAAE,IAAI;;;;;;;;;;;sCAI/D,6LAAC;4BACG,SAAS,CAAC;gCAAQ,EAAE,eAAe;gCAAI,gBAAgB,EAAE,EAAE;4BAAG;4BAC9D,WAAU;4BACV,OAAM;sCAEN,cAAA,6LAAC,oMAAC;gCAAC,MAAM;;;;;;;;;;;;mBAnBR,EAAE,EAAE;;;;;0BAwBjB,6LAAC;gBACG,SAAS;gBACT,WAAU;gBACV,OAAM;0BAEN,cAAA,6LAAC,6MAAI;oBAAC,MAAM;;;;;;;;;;;;;;;;;AAI5B;GA7Ca;;QACoF,0JAAiB;;;KADrG"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/ChartOverlay.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { ChevronLeft, ChevronRight, Clock, Layers } from 'lucide-react';\r\nimport { SymbolBrowser, SymbolBrowserHandle } from '../live/SymbolBrowser';\r\nimport { indicatorRegistry } from '../charts/indicators/IndicatorRegistry';\r\nimport { ChartStatusIndicator, SyncStatus } from '../charts/ChartStatusIndicator';\r\nimport { useChartTheme } from '../../context/ChartThemeContext';\r\n\r\nexport interface ChartOverlayHandle {\r\n    closePopups: () => void;\r\n}\r\n\r\nexport interface ChartOverlayProps {\r\n    symbol: string;\r\n    timeframe: string;\r\n    timezone: string;\r\n\r\n    onSymbolChange: (s: string) => void;\r\n    onTimeframeChange: (tf: string) => void;\r\n    onTimezoneChange: (tz: string) => void;\r\n    onAddIndicator?: (id: string) => void;\r\n    botId?: string;\r\n    ohlc?: { open: number, high: number, low: number, close: number } | null;\r\n    precision?: number;\r\n    status: SyncStatus; // New Prop\r\n}\r\nexport const ChartOverlay = React.forwardRef<ChartOverlayHandle, ChartOverlayProps>(({\r\n    symbol,\r\n    timeframe,\r\n    timezone,\r\n    onSymbolChange,\r\n    onTimeframeChange,\r\n    onTimezoneChange,\r\n    onAddIndicator,\r\n    botId,\r\n    ohlc,\r\n    precision = 5,\r\n    status = 'OFFLINE'\r\n}, ref) => {\r\n    const { mode } = useChartTheme();\r\n    const isDark = mode === 'dark';\r\n\r\n    const symbolBrowserRef = useRef<SymbolBrowserHandle>(null);\r\n    const toolbarRef = useRef<HTMLDivElement>(null);\r\n    const triggerRef = useRef<HTMLDivElement>(null);\r\n    const [isHovered, setIsHovered] = useState(false);\r\n\r\n    // Indicator Menu State\r\n    const [showIndMenu, setShowIndMenu] = useState(false);\r\n\r\n    React.useImperativeHandle(ref, () => ({\r\n        closePopups: () => {\r\n            setIsHovered(false);\r\n            setShowIndMenu(false);\r\n            if (symbolBrowserRef.current) {\r\n                symbolBrowserRef.current.close();\r\n            }\r\n        }\r\n    }));\r\n\r\n    // Timeframe Scroll Logic\r\n    const tfScrollRef = useRef<HTMLDivElement>(null);\r\n    const [canScrollLeft, setCanScrollLeft] = useState(false);\r\n    const [canScrollRight, setCanScrollRight] = useState(false);\r\n\r\n    const checkTfScroll = () => {\r\n        if (tfScrollRef.current) {\r\n            const { scrollLeft, scrollWidth, clientWidth } = tfScrollRef.current;\r\n            setCanScrollLeft(scrollLeft > 4);\r\n            setCanScrollRight(Math.ceil(scrollWidth) > Math.ceil(clientWidth + scrollLeft) + 4);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (isHovered && tfScrollRef.current) {\r\n            setTimeout(checkTfScroll, 50);\r\n            const el = tfScrollRef.current;\r\n            el.addEventListener('scroll', checkTfScroll);\r\n            const observer = new ResizeObserver(() => checkTfScroll());\r\n            observer.observe(el);\r\n            return () => {\r\n                el.removeEventListener('scroll', checkTfScroll);\r\n                observer.disconnect();\r\n            };\r\n        }\r\n    }, [isHovered]);\r\n\r\n    // Global Mouse Tracking to fix sticky hover\r\n    useEffect(() => {\r\n        if (!isHovered) return;\r\n\r\n        const handleGlobalMove = (e: MouseEvent) => {\r\n            const target = e.target as Element;\r\n            // Check if mouse is inside toolbar OR inside a symbol browser dropdown (portal)\r\n            if (\r\n                toolbarRef.current &&\r\n                !toolbarRef.current.contains(target) &&\r\n                triggerRef.current &&\r\n                !triggerRef.current.contains(target) &&\r\n                !target.closest('.symbol-browser-dropdown')\r\n            ) {\r\n                setIsHovered(false);\r\n            }\r\n        };\r\n\r\n        const handleWindowLeave = () => setIsHovered(false);\r\n\r\n        window.addEventListener('mousemove', handleGlobalMove);\r\n        document.addEventListener('mouseleave', handleWindowLeave);\r\n\r\n        return () => {\r\n            window.removeEventListener('mousemove', handleGlobalMove);\r\n            document.removeEventListener('mouseleave', handleWindowLeave);\r\n        };\r\n    }, [isHovered]);\r\n\r\n    // Explicit Theme Colors based on Chart Mode (for Overlay Text ONLY)\r\n    // User: \"schriftfarben und status styling AUF dem chart ist allerdings weiterhin NUR abhängig vom tradingview style\"\r\n    const textColor = isDark ? 'text-white' : 'text-slate-900';\r\n\r\n    const scrollTf = (direction: 'left' | 'right') => {\r\n        if (tfScrollRef.current) {\r\n            const amount = direction === 'left' ? -150 : 150;\r\n            tfScrollRef.current.scrollBy({ left: amount, behavior: 'smooth' });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {/* 1. TRIGGER ZONE (Top Edge 14px centered) */}\r\n            <div\r\n                ref={triggerRef}\r\n                className=\"absolute top-0 left-0 right-0 h-[14px] z-[60] cursor-pointer transition-colors duration-200 hover:bg-slate-200/40 dark:hover:bg-slate-800/40\"\r\n                onMouseEnter={() => setIsHovered(true)}\r\n            />\r\n\r\n            {/* 2. SIMPLE TEXT DISPLAY (Hidden when Hovered) */}\r\n            {!isHovered && (\r\n                <div className=\"absolute top-4 left-2 z-[40] pointer-events-none select-none\">\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                        {(() => {\r\n                            return (\r\n                                <>\r\n                                    {/* Symbol and Timeframe (Normal Weight, Static Color) */}\r\n                                    <div className={`flex items-center gap-2 ${textColor} tracking-tight`}>\r\n                                        {/* Status Dot Removed (per user request) */}\r\n\r\n                                        <span>{symbol}</span>\r\n                                        <span className=\"text-[4px] align-middle opacity-60\">●</span>\r\n                                        <span>{timeframe}</span>\r\n                                    </div>\r\n\r\n                                    {/* OHLC Display (Static Color) */}\r\n                                    {ohlc && (\r\n                                        <div className={`flex items-center gap-2 text-xs font-mono ${textColor} ml-1`}>\r\n                                            <span className=\"text-[4px] align-middle opacity-60\">●</span>\r\n                                            <span className=\"flex gap-1\"><span className=\"opacity-70\">O</span>{ohlc.open.toFixed(precision)}</span>\r\n                                            <span className=\"flex gap-1\"><span className=\"opacity-70\">H</span>{ohlc.high.toFixed(precision)}</span>\r\n                                            <span className=\"flex gap-1\"><span className=\"opacity-70\">L</span>{ohlc.low.toFixed(precision)}</span>\r\n                                            <span className=\"flex gap-1\"><span className=\"opacity-70\">C</span>{ohlc.close.toFixed(precision)}</span>\r\n                                        </div>\r\n                                    )}\r\n                                </>\r\n                            );\r\n                        })()}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* 3. FULL TOOLBAR (Visible when Hovered) */}\r\n            {/* User: \"Toolbar ist abhängig vom plattform style\" -> Usage of 'dark:' classes */}\r\n            <div\r\n                ref={toolbarRef}\r\n                className={`\r\n                    absolute inset-x-0 top-0 h-[40px] z-[70]\r\n                    flex items-center justify-between px-2 gap-2\r\n                    bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-xl \r\n                    transition-all duration-200 ease-out\r\n                    ${isHovered ? 'translate-y-0 opacity-100' : '-translate-y-full opacity-0 pointer-events-none'}\r\n                `}\r\n                onMouseLeave={() => setIsHovered(false)}\r\n            >\r\n                {/* Left Group: Symbol */}\r\n                <div className=\"flex items-center gap-2 shrink-0\">\r\n\r\n\r\n                    <SymbolBrowser\r\n                        ref={symbolBrowserRef}\r\n                        variant=\"button\"\r\n                        currentSymbol={symbol}\r\n                        onSelectSymbol={(s) => {\r\n                            onSymbolChange(s);\r\n                            setIsHovered(false);\r\n                        }}\r\n                        botId={botId}\r\n                        className=\"text-xs\"\r\n                    />\r\n                    <div className=\"w-px h-4 bg-slate-300 dark:bg-slate-700 mx-1\" />\r\n                </div>\r\n\r\n                {/* Middle Group: Timeframe (Restored Full List) */}\r\n                <div className=\"relative flex-1 min-w-0 flex items-center group/tf overflow-hidden h-full\">\r\n                    {canScrollLeft && (\r\n                        <div className=\"absolute left-0 top-0 bottom-0 z-10 flex items-center\">\r\n                            <div className=\"absolute inset-0 bg-gradient-to-r from-white dark:from-slate-900 to-transparent w-6\" />\r\n                            <button onClick={(e) => { e.stopPropagation(); scrollTf('left'); }} className=\"relative z-20 p-0.5 text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors\"><ChevronLeft size={14} /></button>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div\r\n                        ref={tfScrollRef}\r\n                        className=\"flex items-center gap-0.5 overflow-x-auto no-scrollbar scroll-smooth px-1 w-full h-full\"\r\n                        style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}\r\n                    >\r\n                        <style>{`\r\n                            .no-scrollbar::-webkit-scrollbar { display: none; }\r\n                         `}</style>\r\n                        {['M1', 'M2', 'M3', 'M5', 'M10', 'M15', 'M30', 'H1', 'H2', 'H3', 'H4', 'H6', 'H8', 'H12', 'D1', 'W1', 'MN1'].map((tf) => (\r\n                            <button\r\n                                key={tf}\r\n                                onClick={(e) => { e.stopPropagation(); onTimeframeChange(tf); }}\r\n                                className={`px-2 py-0.5 text-[10px] font-medium rounded transition-colors whitespace-nowrap shrink-0 ${timeframe === tf ? 'bg-blue-600 text-white shadow-sm' : 'text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-700'\r\n                                    }`}\r\n                            >\r\n                                {tf}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {canScrollRight && (\r\n                        <div className=\"absolute right-0 top-0 bottom-0 z-10 flex items-center justify-end\">\r\n                            <div className=\"absolute inset-0 bg-gradient-to-l from-white dark:from-slate-900 to-transparent w-6\" />\r\n                            <button onClick={(e) => { e.stopPropagation(); scrollTf('right'); }} className=\"relative z-20 p-0.5 text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors\"><ChevronRight size={14} /></button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Right Group: Timezone (Fixed Width/Spacing) */}\r\n                <div className=\"flex items-center gap-2 shrink-0 border-l border-slate-200 dark:border-slate-800 pl-2\">\r\n                    {/* Indicators Menu */}\r\n                    <div className=\"relative\">\r\n                        <button\r\n                            onClick={(e) => { e.stopPropagation(); setShowIndMenu(!showIndMenu); }}\r\n                            className={`p-1 transition-colors rounded ${showIndMenu ? 'bg-slate-200 dark:bg-slate-700 text-blue-600 dark:text-blue-400' : 'text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-slate-200 dark:hover:bg-slate-700'}`}\r\n                            title=\"Indicators\"\r\n                        >\r\n                            <Layers size={14} />\r\n                        </button>\r\n\r\n                        {showIndMenu && (\r\n                            <div className=\"absolute top-full right-0 mt-1 w-48 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded shadow-xl z-50 flex flex-col py-1 overflow-hidden\">\r\n                                <div className=\"px-3 py-1.5 text-[10px] font-bold text-slate-500 uppercase tracking-wider border-b border-slate-200 dark:border-slate-800 mb-1\">\r\n                                    Add Indicator\r\n                                </div>\r\n                                {indicatorRegistry.getAll().map(def => (\r\n                                    <button\r\n                                        key={def.id}\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            onAddIndicator?.(def.id);\r\n                                            setShowIndMenu(false);\r\n                                        }}\r\n                                        className=\"text-left px-3 py-2 text-xs text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white transition-colors flex items-center gap-2\"\r\n                                    >\r\n                                        <span>{def.name}</span>\r\n                                    </button>\r\n                                ))}\r\n                                {indicatorRegistry.getAll().length === 0 && (\r\n                                    <div className=\"px-3 py-2 text-xs text-slate-500 italic\">No indicators found</div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-1 text-[10px] bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded px-1.5 py-0.5 group/tz relative hover:border-slate-300 dark:hover:border-slate-600 transition-colors h-6\">\r\n                        <Clock size={10} className=\"text-slate-400 dark:text-slate-500 group-hover/tz:text-indigo-500 dark:group-hover/tz:text-indigo-400 transition-colors\" />\r\n                        <select\r\n                            value={timezone}\r\n                            onChange={(e) => onTimezoneChange(e.target.value)}\r\n                            className=\"bg-transparent text-slate-600 dark:text-slate-300 font-mono outline-none appearance-none cursor-pointer pr-3 hover:text-slate-900 dark:hover:text-white transition-colors pt-0.5 min-w-[40px]\"\r\n                        >\r\n                            {\r\n                                [\r\n                                    { id: 'UTC', label: 'UTC', short: 'UTC' },\r\n                                    { id: 'America/New_York', label: 'New York', short: 'NYC' },\r\n                                    { id: 'Europe/London', label: 'London', short: 'LON' },\r\n                                    { id: 'Europe/Berlin', label: 'Berlin', short: 'BER' },\r\n                                    { id: 'Europe/Athens', label: 'Athen', short: 'ATH' },\r\n                                    { id: 'Asia/Tokyo', label: 'Tokyo', short: 'TOK' },\r\n                                    { id: 'Asia/Singapore', label: 'Singapore', short: 'SIN' },\r\n                                    { id: 'Australia/Sydney', label: 'Sydney', short: 'SYD' },\r\n                                ].map(tz => {\r\n                                    // Dynamic Offset Calculation\r\n                                    let offset = '';\r\n                                    try {\r\n                                        const now = new Date();\r\n                                        const tf = new Intl.DateTimeFormat('en-US', { timeZone: tz.id, timeZoneName: 'shortOffset' });\r\n                                        const parts = tf.formatToParts(now);\r\n                                        const offsetPart = parts.find(p => p.type === 'timeZoneName');\r\n                                        offset = offsetPart ? offsetPart.value : '';\r\n                                        offset = offset.replace('GMT', 'UTC');\r\n                                    } catch (e) { }\r\n\r\n                                    return (\r\n                                        <option key={tz.id} value={tz.id} className=\"bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-300 px-2 py-1\">\r\n                                            &nbsp;{tz.label} ({offset})&nbsp;\r\n                                        </option>\r\n                                    );\r\n                                })\r\n                            }\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            {/* 4. STATUS BADGE (Top Right - Floating next to Price Scale) */}\r\n            <div className=\"absolute top-4 right-20 z-[30] pointer-events-none\">\r\n                <ChartStatusIndicator status={status} className=\"shadow-sm backdrop-blur-sm shadow-slate-900/10\" />\r\n            </div>\r\n        </>\r\n    );\r\n});\r\n\r\nChartOverlay.displayName = 'ChartOverlay';\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAoBO,MAAM,6BAAe,GAAA,wKAAK,CAAC,UAAU,SAAwC,CAAC,EACjF,MAAM,EACN,SAAS,EACT,QAAQ,EACR,cAAc,EACd,iBAAiB,EACjB,gBAAgB,EAChB,cAAc,EACd,KAAK,EACL,IAAI,EACJ,YAAY,CAAC,EACb,SAAS,SAAS,EACrB,EAAE;;IACC,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wJAAa;IAC9B,MAAM,SAAS,SAAS;IAExB,MAAM,mBAAmB,IAAA,uKAAM,EAAsB;IACrD,MAAM,aAAa,IAAA,uKAAM,EAAiB;IAC1C,MAAM,aAAa,IAAA,uKAAM,EAAiB;IAC1C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,uBAAuB;IACvB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAE/C,wKAAK,CAAC,mBAAmB,CAAC;4CAAK,IAAM,CAAC;gBAClC,WAAW;wDAAE;wBACT,aAAa;wBACb,eAAe;wBACf,IAAI,iBAAiB,OAAO,EAAE;4BAC1B,iBAAiB,OAAO,CAAC,KAAK;wBAClC;oBACJ;;YACJ,CAAC;;IAED,yBAAyB;IACzB,MAAM,cAAc,IAAA,uKAAM,EAAiB;IAC3C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IAErD,MAAM,gBAAgB;QAClB,IAAI,YAAY,OAAO,EAAE;YACrB,MAAM,EAAE,UAAU,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG,YAAY,OAAO;YACpE,iBAAiB,aAAa;YAC9B,kBAAkB,KAAK,IAAI,CAAC,eAAe,KAAK,IAAI,CAAC,cAAc,cAAc;QACrF;IACJ;IAEA,IAAA,0KAAS;kCAAC;YACN,IAAI,aAAa,YAAY,OAAO,EAAE;gBAClC,WAAW,eAAe;gBAC1B,MAAM,KAAK,YAAY,OAAO;gBAC9B,GAAG,gBAAgB,CAAC,UAAU;gBAC9B,MAAM,WAAW,IAAI;8CAAe,IAAM;;gBAC1C,SAAS,OAAO,CAAC;gBACjB;8CAAO;wBACH,GAAG,mBAAmB,CAAC,UAAU;wBACjC,SAAS,UAAU;oBACvB;;YACJ;QACJ;iCAAG;QAAC;KAAU;IAEd,4CAA4C;IAC5C,IAAA,0KAAS;kCAAC;YACN,IAAI,CAAC,WAAW;YAEhB,MAAM;2DAAmB,CAAC;oBACtB,MAAM,SAAS,EAAE,MAAM;oBACvB,gFAAgF;oBAChF,IACI,WAAW,OAAO,IAClB,CAAC,WAAW,OAAO,CAAC,QAAQ,CAAC,WAC7B,WAAW,OAAO,IAClB,CAAC,WAAW,OAAO,CAAC,QAAQ,CAAC,WAC7B,CAAC,OAAO,OAAO,CAAC,6BAClB;wBACE,aAAa;oBACjB;gBACJ;;YAEA,MAAM;4DAAoB,IAAM,aAAa;;YAE7C,OAAO,gBAAgB,CAAC,aAAa;YACrC,SAAS,gBAAgB,CAAC,cAAc;YAExC;0CAAO;oBACH,OAAO,mBAAmB,CAAC,aAAa;oBACxC,SAAS,mBAAmB,CAAC,cAAc;gBAC/C;;QACJ;iCAAG;QAAC;KAAU;IAEd,oEAAoE;IACpE,qHAAqH;IACrH,MAAM,YAAY,SAAS,eAAe;IAE1C,MAAM,WAAW,CAAC;QACd,IAAI,YAAY,OAAO,EAAE;YACrB,MAAM,SAAS,cAAc,SAAS,CAAC,MAAM;YAC7C,YAAY,OAAO,CAAC,QAAQ,CAAC;gBAAE,MAAM;gBAAQ,UAAU;YAAS;QACpE;IACJ;IAEA,qBACI;;0BAEI,6LAAC;gBACG,KAAK;gBACL,WAAU;gBACV,cAAc,IAAM,aAAa;;;;;;YAIpC,CAAC,2BACE,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;8BACV,CAAC;wBACE,qBACI;;8CAEI,6LAAC;oCAAI,WAAW,CAAC,wBAAwB,EAAE,UAAU,eAAe,CAAC;;sDAGjE,6LAAC;sDAAM;;;;;;sDACP,6LAAC;4CAAK,WAAU;sDAAqC;;;;;;sDACrD,6LAAC;sDAAM;;;;;;;;;;;;gCAIV,sBACG,6LAAC;oCAAI,WAAW,CAAC,0CAA0C,EAAE,UAAU,KAAK,CAAC;;sDACzE,6LAAC;4CAAK,WAAU;sDAAqC;;;;;;sDACrD,6LAAC;4CAAK,WAAU;;8DAAa,6LAAC;oDAAK,WAAU;8DAAa;;;;;;gDAAS,KAAK,IAAI,CAAC,OAAO,CAAC;;;;;;;sDACrF,6LAAC;4CAAK,WAAU;;8DAAa,6LAAC;oDAAK,WAAU;8DAAa;;;;;;gDAAS,KAAK,IAAI,CAAC,OAAO,CAAC;;;;;;;sDACrF,6LAAC;4CAAK,WAAU;;8DAAa,6LAAC;oDAAK,WAAU;8DAAa;;;;;;gDAAS,KAAK,GAAG,CAAC,OAAO,CAAC;;;;;;;sDACpF,6LAAC;4CAAK,WAAU;;8DAAa,6LAAC;oDAAK,WAAU;8DAAa;;;;;;gDAAS,KAAK,KAAK,CAAC,OAAO,CAAC;;;;;;;;;;;;;;;oBAK1G,CAAC;;;;;;;;;;;0BAOb,6LAAC;gBACG,KAAK;gBACL,WAAW,CAAC;;;;;oBAKR,EAAE,YAAY,8BAA8B,kDAAkD;gBAClG,CAAC;gBACD,cAAc,IAAM,aAAa;;kCAGjC,6LAAC;wBAAI,WAAU;;0CAGX,6LAAC,+JAAa;gCACV,KAAK;gCACL,SAAQ;gCACR,eAAe;gCACf,gBAAgB,CAAC;oCACb,eAAe;oCACf,aAAa;gCACjB;gCACA,OAAO;gCACP,WAAU;;;;;;0CAEd,6LAAC;gCAAI,WAAU;;;;;;;;;;;;kCAInB,6LAAC;wBAAI,WAAU;;4BACV,+BACG,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAI,WAAU;;;;;;kDACf,6LAAC;wCAAO,SAAS,CAAC;4CAAQ,EAAE,eAAe;4CAAI,SAAS;wCAAS;wCAAG,WAAU;kDAAkG,cAAA,6LAAC,sOAAW;4CAAC,MAAM;;;;;;;;;;;;;;;;;0CAI3M,6LAAC;gCACG,KAAK;gCACL,WAAU;gCACV,OAAO;oCAAE,gBAAgB;oCAAQ,iBAAiB;gCAAO;;kDAEzD,6LAAC;kDAAO,CAAC;;yBAER,CAAC;;;;;;oCACD;wCAAC;wCAAM;wCAAM;wCAAM;wCAAM;wCAAO;wCAAO;wCAAO;wCAAM;wCAAM;wCAAM;wCAAM;wCAAM;wCAAM;wCAAO;wCAAM;wCAAM;qCAAM,CAAC,GAAG,CAAC,CAAC,mBAC9G,6LAAC;4CAEG,SAAS,CAAC;gDAAQ,EAAE,eAAe;gDAAI,kBAAkB;4CAAK;4CAC9D,WAAW,CAAC,yFAAyF,EAAE,cAAc,KAAK,qCAAqC,gIACzJ;sDAEL;2CALI;;;;;;;;;;;4BAUhB,gCACG,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAI,WAAU;;;;;;kDACf,6LAAC;wCAAO,SAAS,CAAC;4CAAQ,EAAE,eAAe;4CAAI,SAAS;wCAAU;wCAAG,WAAU;kDAAkG,cAAA,6LAAC,yOAAY;4CAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;kCAMjN,6LAAC;wBAAI,WAAU;;0CAEX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCACG,SAAS,CAAC;4CAAQ,EAAE,eAAe;4CAAI,eAAe,CAAC;wCAAc;wCACrE,WAAW,CAAC,8BAA8B,EAAE,cAAc,oEAAoE,8HAA8H;wCAC5P,OAAM;kDAEN,cAAA,6LAAC,mNAAM;4CAAC,MAAM;;;;;;;;;;;oCAGjB,6BACG,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDAAI,WAAU;0DAAiI;;;;;;4CAG/I,sLAAiB,CAAC,MAAM,GAAG,GAAG,CAAC,CAAA,oBAC5B,6LAAC;oDAEG,SAAS,CAAC;wDACN,EAAE,eAAe;wDACjB,iBAAiB,IAAI,EAAE;wDACvB,eAAe;oDACnB;oDACA,WAAU;8DAEV,cAAA,6LAAC;kEAAM,IAAI,IAAI;;;;;;mDARV,IAAI,EAAE;;;;;4CAWlB,sLAAiB,CAAC,MAAM,GAAG,MAAM,KAAK,mBACnC,6LAAC;gDAAI,WAAU;0DAA0C;;;;;;;;;;;;;;;;;;0CAMzE,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,gNAAK;wCAAC,MAAM;wCAAI,WAAU;;;;;;kDAC3B,6LAAC;wCACG,OAAO;wCACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;wCAChD,WAAU;kDAGN;4CACI;gDAAE,IAAI;gDAAO,OAAO;gDAAO,OAAO;4CAAM;4CACxC;gDAAE,IAAI;gDAAoB,OAAO;gDAAY,OAAO;4CAAM;4CAC1D;gDAAE,IAAI;gDAAiB,OAAO;gDAAU,OAAO;4CAAM;4CACrD;gDAAE,IAAI;gDAAiB,OAAO;gDAAU,OAAO;4CAAM;4CACrD;gDAAE,IAAI;gDAAiB,OAAO;gDAAS,OAAO;4CAAM;4CACpD;gDAAE,IAAI;gDAAc,OAAO;gDAAS,OAAO;4CAAM;4CACjD;gDAAE,IAAI;gDAAkB,OAAO;gDAAa,OAAO;4CAAM;4CACzD;gDAAE,IAAI;gDAAoB,OAAO;gDAAU,OAAO;4CAAM;yCAC3D,CAAC,GAAG,CAAC,CAAA;4CACF,6BAA6B;4CAC7B,IAAI,SAAS;4CACb,IAAI;gDACA,MAAM,MAAM,IAAI;gDAChB,MAAM,KAAK,IAAI,KAAK,cAAc,CAAC,SAAS;oDAAE,UAAU,GAAG,EAAE;oDAAE,cAAc;gDAAc;gDAC3F,MAAM,QAAQ,GAAG,aAAa,CAAC;gDAC/B,MAAM,aAAa,MAAM,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK;gDAC9C,SAAS,aAAa,WAAW,KAAK,GAAG;gDACzC,SAAS,OAAO,OAAO,CAAC,OAAO;4CACnC,EAAE,OAAO,GAAG,CAAE;4CAEd,qBACI,6LAAC;gDAAmB,OAAO,GAAG,EAAE;gDAAE,WAAU;;oDAA0E;oDAC3G,GAAG,KAAK;oDAAC;oDAAG;oDAAO;;+CADjB,GAAG,EAAE;;;;;wCAI1B;;;;;;;;;;;;;;;;;;;;;;;;0BAOpB,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC,+KAAoB;oBAAC,QAAQ;oBAAQ,WAAU;;;;;;;;;;;;;AAIhE;;QAzRqB,wJAAa;;;;QAAb,wJAAa;;;;AA2RlC,aAAa,WAAW,GAAG"}},
    {"offset": {"line": 775, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/ChartPane.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useRef, useCallback, useEffect, useState } from 'react';\r\n\r\nimport { Settings, X, Eye, EyeOff } from 'lucide-react';\r\nimport { useWorkspaceStore, PaneConfig } from '../../stores/useWorkspaceStore';\r\nimport { ChartContainer, ChartContainerHandle } from '../charts/ChartContainer';\r\nimport { useChartData } from '../../hooks/useChartData';\r\nimport { useChartRegistryStore } from '../../stores/useChartRegistryStore';\r\nimport { ChartOverlay, ChartOverlayHandle } from './ChartOverlay';\r\nimport { useSymbolStore } from '../../stores/useSymbolStore';\r\nimport { LogicalRange } from 'lightweight-charts';\r\nimport { indicatorRegistry } from '../charts/indicators/IndicatorRegistry';\r\nimport { registerIndicators } from '../charts/indicators';\r\nimport { IndicatorSettingsDialog } from '../charts/settings/IndicatorSettingsDialog';\r\nimport { useChartTheme } from '../../context/ChartThemeContext';\r\n\r\ninterface ChartPaneProps {\r\n    workspaceId: string;\r\n    pane: PaneConfig;\r\n    botId?: string;\r\n    accounts: any[];\r\n}\r\n\r\nexport const ChartPane: React.FC<ChartPaneProps> = ({ workspaceId, pane, botId = 'MT5_Bot', accounts }) => {\r\n    const { setActivePane, updatePane, toggleMaximizePane, workspaces } = useWorkspaceStore();\r\n    const activeWorkspace = workspaces.find(w => w.id === workspaceId);\r\n    const isMaximized = activeWorkspace?.maximizedPaneId === pane.id;\r\n    const maximizeId = activeWorkspace?.maximizedPaneId;\r\n\r\n    useEffect(() => {\r\n        // If the maximization state changes (any pane maximized or restored), close local popups\r\n        if (chartRef.current) {\r\n            chartRef.current.closePopups();\r\n        }\r\n        if (overlayRef.current) {\r\n            overlayRef.current.closePopups();\r\n        }\r\n    }, [maximizeId]);\r\n\r\n    // Cleanup Selection on Deactivation\r\n    useEffect(() => {\r\n        if (!pane.isActive && chartRef.current) {\r\n            chartRef.current.deselectAll();\r\n        }\r\n    }, [pane.isActive, pane.id]);\r\n\r\n    // --- STATE PERSISTENCE ---\r\n    const lastLogicalRangeRef = useRef<LogicalRange | null>(null);\r\n\r\n    // --- INDICATOR STATE ---\r\n    const [activeIndicators, setActiveIndicators] = useState<any[]>(pane.indicators || []);\r\n    const [editingIndicatorId, setEditingIndicatorId] = useState<string | null>(null);\r\n\r\n    // Init Registry (Once)\r\n    useEffect(() => {\r\n        registerIndicators();\r\n    }, []);\r\n\r\n    const { registerChart, unregisterChart } = useChartRegistryStore();\r\n    const chartRef = useRef<ChartContainerHandle>(null);\r\n    const overlayRef = useRef<ChartOverlayHandle>(null);\r\n    const { getSymbolInfo } = useSymbolStore();\r\n    const [layoutManager] = useState(() => import('../../stores/LayoutStateManager').then(m => m.LayoutStateManager.getInstance()));\r\n\r\n    // Keep track of latest timeframe to avoid stale closures in sync callbacks\r\n    const timeframeRef = useRef(pane.timeframe);\r\n    useEffect(() => {\r\n        timeframeRef.current = pane.timeframe;\r\n    }, [pane.timeframe]);\r\n\r\n\r\n    // --- INTEGRATION: LayoutStateManager ---\r\n    useEffect(() => {\r\n        let manager: any = null;\r\n\r\n        const initManager = async () => {\r\n            const { LayoutStateManager } = await import('../../stores/LayoutStateManager');\r\n            manager = LayoutStateManager.getInstance();\r\n\r\n            manager.register({\r\n                id: pane.id,\r\n                setTimeframe: (tf: string) => {\r\n                    updatePane(workspaceId, pane.id, { timeframe: tf });\r\n                },\r\n                getTimeframe: () => {\r\n                    return timeframeRef.current;\r\n                },\r\n                setVisibleRange: (range: { from: number; to: number }) => {\r\n                    if (chartRef.current) {\r\n                        chartRef.current.setVisibleRange(range);\r\n                    }\r\n                },\r\n                setLogicalRange: (range: { from: number; to: number, anchorTime?: number }) => {\r\n                    if (chartRef.current) {\r\n                        chartRef.current.setLogicalRange(range);\r\n                    }\r\n                },\r\n                setCrosshair: (time: number, price?: number) => {\r\n                    if (chartRef.current) {\r\n                        chartRef.current.setCrosshair(time, price);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        initManager();\r\n\r\n        return () => {\r\n            if (manager) {\r\n                manager.unregister(pane.id);\r\n            }\r\n        };\r\n    }, [pane.id, workspaceId, updatePane]);\r\n\r\n    // Register Chart to Registry & Manage Persistence\r\n    useEffect(() => {\r\n        // console.log(`[ChartPane:${pane.id}] Mount/Register Effect`);\r\n        if (chartRef.current) {\r\n            registerChart(pane.id, chartRef.current);\r\n\r\n            // --- DRAWING PERSISTENCE ---\r\n            const widget = chartRef.current.getWidget();\r\n            if (widget) {\r\n                // 1. Hydrate\r\n                if (pane.drawings) {\r\n                    try {\r\n                        console.log(`[ChartPane:${pane.id}] Hydrating drawings...`);\r\n                        widget.hydrateDrawings(pane.drawings);\r\n                    } catch (e) {\r\n                        console.warn(`[ChartPane:${pane.id}] Failed to hydrate drawings:`, e);\r\n                    }\r\n                }\r\n\r\n                // 2. Setup Persistence\r\n                const saveDrawings = () => {\r\n                    if (!widget) return;\r\n                    try {\r\n                        const serialized = widget.serializeDrawings();\r\n                        // Only save if meaningful content or actual changes\r\n                        // We always save on unmount to capture final state\r\n                        updatePane(workspaceId, pane.id, { drawings: serialized });\r\n                    } catch (e) {\r\n                        console.warn(`[ChartPane:${pane.id}] Failed to save drawings:`, e);\r\n                    }\r\n                };\r\n\r\n                // Save on structure changes (add/remove)\r\n                widget.subscribe('drawing', saveDrawings);\r\n\r\n                // Save on execution (trade) just to be safe? \r\n                // widget.subscribe('execute', saveDrawings);\r\n\r\n                return () => {\r\n                    console.log(`[ChartPane:${pane.id}] Unmounting/Unregistering. Saving drawings...`);\r\n                    saveDrawings();\r\n                    widget.unsubscribe('drawing', saveDrawings);\r\n                    unregisterChart(pane.id);\r\n                };\r\n            }\r\n        }\r\n        return () => {\r\n            console.log(`[ChartPane:${pane.id}] Cleanup/Unregister (No Widget Path)`);\r\n            unregisterChart(pane.id);\r\n        }\r\n    }, [pane.id, registerChart, unregisterChart, workspaceId, updatePane]); // Important: Exclude pane.drawings to prevent re-hydration loops\r\n\r\n    // Optimized Tick Handler\r\n    const handleTick = useCallback((candle: any) => {\r\n        if (chartRef.current) {\r\n            chartRef.current.updateCandle(candle);\r\n        }\r\n    }, []);\r\n\r\n    // Data Hook\r\n    const { data, horizonData, isLoading, isChartReady, syncError, syncStatus } = useChartData({\r\n        symbol: pane.symbol,\r\n        timeframe: pane.timeframe,\r\n        botId: botId,\r\n        isActivePane: pane.isActive,\r\n        onTick: handleTick\r\n    });\r\n\r\n    const handleFocus = () => {\r\n        setActivePane(workspaceId, pane.id);\r\n        import('../../stores/LayoutStateManager').then(({ LayoutStateManager }) => {\r\n            LayoutStateManager.getInstance().setLastActive(pane.id);\r\n        });\r\n    };\r\n\r\n    // --- INTERACTION: Keyboard Shortcut (Alt + Enter) ---\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (pane.isActive && e.altKey && e.key === 'Enter') {\r\n                e.preventDefault();\r\n                toggleMaximizePane(workspaceId, pane.id);\r\n            }\r\n        };\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [pane.isActive, toggleMaximizePane, workspaceId, pane.id]);\r\n\r\n    const symbolInfo = getSymbolInfo(pane.symbol);\r\n    const precision = symbolInfo?.digits || 5;\r\n\r\n    // --- TIMEFRAME SCROLL LOGIC (Local) ---\r\n    const tfScrollRef = useRef<HTMLDivElement>(null);\r\n    const [canScrollLeft, setCanScrollLeft] = useState(false);\r\n    const [canScrollRight, setCanScrollRight] = useState(false);\r\n\r\n    const checkTfScroll = () => {\r\n        if (tfScrollRef.current) {\r\n            const { scrollLeft, scrollWidth, clientWidth } = tfScrollRef.current;\r\n            setCanScrollLeft(scrollLeft > 4);\r\n            setCanScrollRight(Math.ceil(scrollWidth) > Math.ceil(clientWidth + scrollLeft) + 4);\r\n        }\r\n    };\r\n\r\n    // Timezone State (Local for now, could be in PaneConfig)\r\n    const [timezone, setTimezone] = useState<string>(() => {\r\n        try { return Intl.DateTimeFormat().resolvedOptions().timeZone; } catch (e) { return 'UTC'; }\r\n    });\r\n\r\n    useEffect(() => {\r\n        const el = tfScrollRef.current;\r\n        if (el) {\r\n            checkTfScroll();\r\n            el.addEventListener('scroll', checkTfScroll);\r\n            const observer = new ResizeObserver(() => checkTfScroll());\r\n            observer.observe(el);\r\n            return () => {\r\n                el.removeEventListener('scroll', checkTfScroll);\r\n                observer.disconnect();\r\n            };\r\n        }\r\n    }, []);\r\n\r\n    const [ohlc, setOhlc] = useState<{ open: number, high: number, low: number, close: number } | null>(null);\r\n\r\n    // --- MANAGE OUTGOING EVENTS (Source) ---\r\n    const handleCallbackTimeframeChange = (tf: string) => {\r\n        updatePane(workspaceId, pane.id, { timeframe: tf });\r\n        // Broadcast sync\r\n        import('../../stores/LayoutStateManager').then(({ LayoutStateManager }) => {\r\n            LayoutStateManager.getInstance().syncTimeframe(pane.id, tf);\r\n        });\r\n    };\r\n\r\n    const handleCallbackCrosshairMove = (time: any, priceA: number | undefined, priceB: number | undefined) => {\r\n        if (time) {\r\n            import('../../stores/LayoutStateManager').then(({ LayoutStateManager }) => {\r\n                LayoutStateManager.getInstance().syncCrosshair(pane.id, time as number, priceA || 0);\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleCallbackVisibleRangeChange = (range: { from: number, to: number }) => {\r\n        import('../../stores/LayoutStateManager').then(({ LayoutStateManager }) => {\r\n            LayoutStateManager.getInstance().syncScroll(pane.id, range);\r\n        });\r\n    };\r\n\r\n    const handleCallbackLogicalRangeChange = (logicalRange: LogicalRange & { anchorTime?: number, whitespaceOffset?: number }) => {\r\n        const currentRange = { from: 0, to: 0 }; // We only need logical range for primary sync\r\n        if (logicalRange) {\r\n            lastLogicalRangeRef.current = logicalRange;\r\n        }\r\n        import('../../stores/LayoutStateManager').then(({ LayoutStateManager }) => {\r\n            LayoutStateManager.getInstance().syncScroll(pane.id, currentRange, {\r\n                from: logicalRange.from as number,\r\n                to: logicalRange.to as number,\r\n                anchorTime: logicalRange.anchorTime,\r\n                whitespaceOffset: logicalRange.whitespaceOffset\r\n            });\r\n        });\r\n    };\r\n\r\n    // --- INDICATOR HANDLERS ---\r\n    const handleAddIndicator = (defId: string) => {\r\n        const def = indicatorRegistry.get(defId);\r\n        if (!def) return;\r\n\r\n        // Create new instance (generic add, unique instance IDs)\r\n        const newItem = {\r\n            instanceId: `${defId}_${Date.now()}`,\r\n            defId: defId,\r\n            settings: { ...def.defaultSettings },\r\n            visible: true\r\n        };\r\n\r\n        const newIndicators = [...activeIndicators, newItem];\r\n        setActiveIndicators(newIndicators);\r\n\r\n        // Save to Persistent Store\r\n        updatePane(workspaceId, pane.id, { indicators: newIndicators });\r\n\r\n        // Open Settings\r\n        setEditingIndicatorId(newItem.instanceId);\r\n    };\r\n\r\n    const handleSaveSettings = (newSettings: any) => {\r\n        if (!editingIndicatorId) return;\r\n\r\n        const newIndicators = activeIndicators.map(ind => {\r\n            if (ind.instanceId === editingIndicatorId) {\r\n                return { ...ind, settings: newSettings };\r\n            }\r\n            return ind;\r\n        });\r\n        setActiveIndicators(newIndicators);\r\n        setEditingIndicatorId(null);\r\n\r\n        // Save to Persistent Store\r\n        updatePane(workspaceId, pane.id, { indicators: newIndicators });\r\n    };\r\n\r\n    const handleRemoveIndicator = (id: string) => {\r\n        const newIndicators = activeIndicators.filter(i => i.instanceId !== id);\r\n        setActiveIndicators(newIndicators);\r\n        if (editingIndicatorId === id) setEditingIndicatorId(null);\r\n\r\n        // Save to Persistent Store\r\n        updatePane(workspaceId, pane.id, { indicators: newIndicators });\r\n    };\r\n\r\n    // Get Definition for editing\r\n    const handleToggleVisibility = (id: string) => {\r\n        const newIndicators = activeIndicators.map(ind => {\r\n            if (ind.instanceId === id) {\r\n                return { ...ind, visible: ind.visible === undefined ? false : !ind.visible };\r\n            }\r\n            return ind;\r\n        });\r\n        setActiveIndicators(newIndicators);\r\n        // Save to Persistent Store\r\n        updatePane(workspaceId, pane.id, { indicators: newIndicators });\r\n    };\r\n\r\n    const editingInd = activeIndicators.find(i => i.instanceId === editingIndicatorId);\r\n    const editingDef = editingInd ? indicatorRegistry.get(editingInd.defId) : null;\r\n\r\n    // --- THEME CONTEXT ---\r\n    const { mode } = useChartTheme();\r\n    const isDark = mode === 'dark';\r\n    const textColor = isDark ? 'text-white' : 'text-slate-900';\r\n    const mutedColor = isDark ? 'text-slate-500' : 'text-slate-400';\r\n    const iconColor = isDark ? 'text-slate-400 hover:text-white' : 'text-slate-500 hover:text-slate-900';\r\n    const borderColor = isDark ? 'hover:border-slate-700' : 'hover:border-slate-300';\r\n\r\n    // RESTORE RANGE ON MAXIMIZE/MINIMIZE\r\n    // When isMaximized changes, the component effectively moves in the DOM.\r\n    // LWC might reset. We force re-apply the last known logical range after a brief delay to allow resize to settle.\r\n    React.useLayoutEffect(() => {\r\n        if (lastLogicalRangeRef.current && chartRef.current) {\r\n            const saved = lastLogicalRangeRef.current;\r\n            // Small timeout to allow the resize observer in ChartContainer to fire first\r\n            const t = setTimeout(() => {\r\n                if (chartRef.current) {\r\n                    chartRef.current.setLogicalRange({ from: saved.from as number, to: saved.to as number });\r\n                }\r\n            }, 50);\r\n            return () => clearTimeout(t);\r\n        }\r\n    }, [isMaximized]);\r\n\r\n    return (\r\n        <div\r\n            className={`\r\n                flex flex-col w-full h-full overflow-hidden bg-white dark:bg-slate-950 transition-all duration-200 group\r\n                ${isMaximized\r\n                    ? 'fixed inset-0 z-[9999] border-0'\r\n                    : `relative ${pane.isActive ? 'border-2 border-blue-500 z-10' : 'border border-slate-200 dark:border-slate-800'}`\r\n                }\r\n            `}\r\n            // Remove 100vw/100vh inline styles as fixed inset-0 handles it better without causing scrollbars\r\n            onClick={(e) => {\r\n                // Alt + Click to Toggle Maximize\r\n                if (e.altKey && !e.shiftKey && !e.ctrlKey) {\r\n                    e.stopPropagation();\r\n                    toggleMaximizePane(workspaceId, pane.id);\r\n                    return;\r\n                }\r\n                handleFocus();\r\n            }}\r\n        >\r\n            {/* --- IN-CHART HUD OVERLAY --- */}\r\n            <ChartOverlay\r\n                ref={overlayRef}\r\n                symbol={pane.symbol}\r\n                timeframe={pane.timeframe}\r\n                timezone={timezone}\r\n                onSymbolChange={(s) => updatePane(workspaceId, pane.id, { symbol: s })}\r\n                onTimeframeChange={handleCallbackTimeframeChange}\r\n                onTimezoneChange={(tz) => setTimezone(tz)}\r\n                onAddIndicator={handleAddIndicator}\r\n                botId={botId}\r\n                ohlc={ohlc}\r\n                precision={precision}\r\n                status={syncStatus as any}\r\n            />\r\n\r\n            {/* Chart Wrapper */}\r\n            <div className=\"flex-1 min-h-0 relative\">\r\n                <ChartContainer\r\n                    ref={chartRef}\r\n                    symbol={pane.symbol}\r\n                    symbolB=\"\"\r\n                    dataA={data}\r\n                    dataB={[]}\r\n                    timeframe={pane.timeframe}\r\n                    height=\"100%\"\r\n                    isLoading={isLoading && data.length === 0}\r\n                    precision={precision}\r\n                    horizonData={horizonData}\r\n                    accounts={accounts}\r\n                    botId={botId}\r\n                    isActive={pane.isActive}\r\n                    timezone={timezone}\r\n                    onOHLCChange={setOhlc}\r\n                    onCrosshairMove={handleCallbackCrosshairMove}\r\n                    // onVisibleRangeChange={handleCallbackVisibleRangeChange} // Disabled to prevent Time-Sync Jitter. We rely on LogicalRange.\r\n                    onVisibleLogicalRangeChange={handleCallbackLogicalRangeChange}\r\n                    activeIndicators={activeIndicators}\r\n                    paneId={pane.id}\r\n                    onChartClick={handleFocus}\r\n                    scrollToTimeRequest={pane.scrollToTimeRequest}\r\n                    isChartReady={isChartReady && data.length > 0} // Logical AND: Data must exist too\r\n                    syncError={syncError}\r\n                />\r\n\r\n                {/* ACTIVE INDICATORS OVERLAY LABEL */}\r\n                <div className=\"absolute top-[50px] left-1 flex flex-col items-start gap-0.5 z-20 pointer-events-auto select-none\">\r\n                    {activeIndicators.map(ind => {\r\n                        const def = indicatorRegistry.get(ind.defId);\r\n                        // Adapted Text Colors based on Chart Theme\r\n                        return (\r\n                            <div key={ind.instanceId}\r\n                                className={`flex items-center gap-1 group/legend px-1 py-0.5 border border-transparent rounded ${borderColor} transition-all`}\r\n                            >\r\n                                <span className={`text-sm cursor-default ${ind.visible === false ? `${mutedColor} line-through decoration-slate-500` : textColor}`}>\r\n                                    {def?.name || ind.defId}\r\n                                </span>\r\n                                <div className=\"flex items-center gap-0 opacity-0 group-hover/legend:opacity-100 transition-opacity duration-200 ml-1\">\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleToggleVisibility(ind.instanceId); }}\r\n                                        className={`${iconColor} p-0.5 transition-colors`}\r\n                                        title={ind.visible === false ? \"Show\" : \"Hide\"}\r\n                                    >\r\n                                        {ind.visible === false ? <EyeOff size={14} /> : <Eye size={14} />}\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); setEditingIndicatorId(ind.instanceId); }}\r\n                                        className={`${iconColor} p-0.5 transition-colors`}\r\n                                        title=\"Settings\"\r\n                                    >\r\n                                        <Settings size={14} />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleRemoveIndicator(ind.instanceId); }}\r\n                                        className={`${iconColor} p-0.5 transition-colors`}\r\n                                        title=\"Close\"\r\n                                    >\r\n                                        {/* Smaller and Thicker X */}\r\n                                        <X size={12} strokeWidth={3} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* SETTINGS DIALOG */}\r\n                {editingInd && editingDef && (\r\n                    <IndicatorSettingsDialog\r\n                        isOpen={true}\r\n                        onClose={() => setEditingIndicatorId(null)}\r\n                        onSave={handleSaveSettings}\r\n                        definition={{ name: editingDef.name, settingsSchema: editingDef.settingsSchema }}\r\n                        currentSettings={editingInd.settings}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div >\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1437, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/LayoutGrid.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useMemo, useCallback, useState } from 'react';\r\nimport { useWorkspaceStore } from '../../stores/useWorkspaceStore';\r\nimport { ChartPane } from './ChartPane';\r\nimport { Group as PanelGroup, Panel, Separator as PanelResizeHandle, Layout } from 'react-resizable-panels';\r\n\r\ninterface LayoutGridProps {\r\n    botId?: string;\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    accounts: any[];\r\n}\r\n\r\nconst DraggableGutter = ({ direction = \"horizontal\", onDoubleClick }: { direction?: \"horizontal\" | \"vertical\", onDoubleClick?: () => void }) => (\r\n    <PanelResizeHandle\r\n        className={`\r\n        relative flex items-center justify-center\r\n        ${direction === 'horizontal' ? 'w-1 cursor-col-resize hover:bg-blue-500/20' : 'h-1 cursor-row-resize hover:bg-blue-500/20'}\r\n        group outline-none transition-colors duration-200\r\n    `}\r\n        onDoubleClick={onDoubleClick}\r\n    >\r\n        <div className={`\r\n            absolute bg-slate-200 dark:bg-slate-800 transition-colors duration-200\r\n            group-hover:bg-blue-500 group-active:bg-blue-600\r\n            ${direction === 'horizontal' ? 'w-1 h-full' : 'h-1 w-full'}\r\n            z-10\r\n        `} />\r\n    </PanelResizeHandle>\r\n);\r\n\r\nexport const LayoutGrid: React.FC<LayoutGridProps> = ({ botId, accounts }) => {\r\n    const { workspaces, activeWorkspaceId, updateLayoutSizes } = useWorkspaceStore();\r\n\r\n    // State to force remount of PanelGroups by changing their key\r\n    const [groupVersions, setGroupVersions] = useState<Record<string, number>>({});\r\n\r\n    const activeWorkspace = useMemo(() =>\r\n        workspaces.find(w => w.id === activeWorkspaceId),\r\n        [workspaces, activeWorkspaceId]);\r\n\r\n    const { layoutType, panes, layoutSizes = [] } = activeWorkspace || {};\r\n\r\n    const getPaneId = useCallback((index: number) => {\r\n        if (!panes) return `pane-fallback-${index}`;\r\n        return panes[index]?.id || `pane-fallback-${index}`;\r\n    }, [panes]);\r\n\r\n    // Helper to merge new sizes into the flat layoutSizes array\r\n    const handleLayoutChange = useCallback((indices: number[], ids: string[], layoutMap: Layout) => {\r\n        if (!activeWorkspace) return;\r\n\r\n        const currentSizes = [...(activeWorkspace.layoutSizes || [])];\r\n        // Ensure array is large enough\r\n        while (currentSizes.length < 6) currentSizes.push(50);\r\n\r\n        // Map the IDs back to the indices provided\r\n        indices.forEach((globalIndex, i) => {\r\n            const id = ids[i];\r\n            if (layoutMap[id] !== undefined) {\r\n                currentSizes[globalIndex] = layoutMap[id];\r\n            }\r\n        });\r\n\r\n        updateLayoutSizes(activeWorkspace.id, currentSizes);\r\n    }, [activeWorkspace, updateLayoutSizes]);\r\n\r\n    const handleResetLayout = useCallback((groupId: string, indices: number[], targetValue: number = 50) => {\r\n        if (!activeWorkspace) return;\r\n\r\n        const currentSizes = [...(activeWorkspace.layoutSizes || [])];\r\n        // Ensure array is large enough\r\n        while (currentSizes.length < 6) currentSizes.push(50);\r\n\r\n        indices.forEach(index => {\r\n            currentSizes[index] = targetValue;\r\n        });\r\n\r\n        // 1. Update persisted store\r\n        updateLayoutSizes(activeWorkspace.id, currentSizes);\r\n\r\n        // 2. Force remount of the specific group\r\n        setGroupVersions(prev => ({\r\n            ...prev,\r\n            [groupId]: (prev[groupId] || 0) + 1\r\n        }));\r\n    }, [activeWorkspace, updateLayoutSizes]);\r\n\r\n    const getSize = useCallback((index: number, defaultVal: number = 50) => {\r\n        return (layoutSizes && layoutSizes[index]) ?? defaultVal;\r\n    }, [layoutSizes]);\r\n\r\n    const renderPane = (index: number) => {\r\n        if (!panes || !activeWorkspace) return null;\r\n        const pane = panes[index];\r\n        if (!pane) return <div className=\"bg-slate-50 dark:bg-slate-900 w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-600\">Empty Pane</div>;\r\n        return (\r\n            <div className=\"w-full h-full bg-white dark:bg-slate-900 overflow-hidden\">\r\n                <ChartPane\r\n                    key={pane.id}\r\n                    workspaceId={activeWorkspace.id}\r\n                    pane={pane}\r\n                    botId={botId}\r\n                    accounts={accounts}\r\n                />\r\n            </div>\r\n        );\r\n    };\r\n\r\n    if (!activeWorkspace) {\r\n        return <div className=\"p-10 text-center text-slate-500\">No active workspace</div>;\r\n    }\r\n\r\n    // --- RENDERERS ---\r\n\r\n    const layoutContent = () => {\r\n        if (layoutType === 'single') {\r\n            return (\r\n                <div className=\"w-full h-full bg-white dark:bg-slate-950\">\r\n                    {renderPane(0)}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (layoutType === 'split-vertical') {\r\n            const ids = [getPaneId(0), getPaneId(1)];\r\n            const groupId = 'main-group';\r\n            return (\r\n                <div className=\"w-full h-full bg-slate-950\">\r\n                    <PanelGroup\r\n                        key={`${groupId}-${groupVersions[groupId] || 0}`}\r\n                        orientation=\"horizontal\"\r\n                        onLayoutChanged={(l) => handleLayoutChange([0, 1], ids, l)}\r\n                    >\r\n                        <Panel id={ids[0]} defaultSize={getSize(0)} minSize={10} className=\"\">\r\n                            {renderPane(0)}\r\n                        </Panel>\r\n                        <DraggableGutter\r\n                            direction=\"horizontal\"\r\n                            onDoubleClick={() => handleResetLayout(groupId, [0, 1], 50)}\r\n                        />\r\n                        <Panel id={ids[1]} defaultSize={getSize(1)} minSize={10} className=\"\">\r\n                            {renderPane(1)}\r\n                        </Panel>\r\n                    </PanelGroup>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (layoutType === 'split-horizontal') {\r\n            const ids = [getPaneId(0), getPaneId(1)];\r\n            const groupId = 'main-group';\r\n            return (\r\n                <div className=\"w-full h-full bg-slate-950\">\r\n                    <PanelGroup\r\n                        key={`${groupId}-${groupVersions[groupId] || 0}`}\r\n                        orientation=\"vertical\"\r\n                        onLayoutChanged={(l) => handleLayoutChange([0, 1], ids, l)}\r\n                    >\r\n                        <Panel id={ids[0]} defaultSize={getSize(0)} minSize={10} className=\"\">\r\n                            {renderPane(0)}\r\n                        </Panel>\r\n                        <DraggableGutter\r\n                            direction=\"vertical\"\r\n                            onDoubleClick={() => handleResetLayout(groupId, [0, 1], 50)}\r\n                        />\r\n                        <Panel id={ids[1]} defaultSize={getSize(1)} minSize={10} className=\"\">\r\n                            {renderPane(1)}\r\n                        </Panel>\r\n                    </PanelGroup>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (layoutType === 'grid-2x2') {\r\n            // IDs for columns and cells\r\n            const colIds = ['col-0', 'col-1'];\r\n            const leftIds = [getPaneId(0), getPaneId(2)];\r\n            const rightIds = [getPaneId(1), getPaneId(3)];\r\n\r\n            const mainGroupId = 'main-group';\r\n            const leftGroupId = 'left-col-group';\r\n            const rightGroupId = 'right-col-group';\r\n\r\n            return (\r\n                <div className=\"w-full h-full bg-white dark:bg-slate-950\">\r\n                    <PanelGroup\r\n                        key={`${mainGroupId}-${groupVersions[mainGroupId] || 0}`}\r\n                        orientation=\"horizontal\"\r\n                        onLayoutChanged={(l) => handleLayoutChange([0, 1], colIds, l)}\r\n                    >\r\n                        {/* Left Column */}\r\n                        <Panel id={colIds[0]} defaultSize={getSize(0)} minSize={10} className=\"flex flex-col\">\r\n                            <PanelGroup\r\n                                key={`${leftGroupId}-${groupVersions[leftGroupId] || 0}`}\r\n                                orientation=\"vertical\"\r\n                                onLayoutChanged={(l) => handleLayoutChange([2, 3], leftIds, l)}\r\n                            >\r\n                                <Panel id={leftIds[0]} defaultSize={getSize(2)} minSize={10} className=\"\">\r\n                                    {renderPane(0)}\r\n                                </Panel>\r\n                                <DraggableGutter\r\n                                    direction=\"vertical\"\r\n                                    onDoubleClick={() => handleResetLayout(leftGroupId, [2, 3], 50)}\r\n                                />\r\n                                <Panel id={leftIds[1]} defaultSize={getSize(3)} minSize={10} className=\"\">\r\n                                    {renderPane(2)}\r\n                                </Panel>\r\n                            </PanelGroup>\r\n                        </Panel>\r\n\r\n                        <DraggableGutter\r\n                            direction=\"horizontal\"\r\n                            onDoubleClick={() => handleResetLayout(mainGroupId, [0, 1], 50)} // Reset columns to 50/50\r\n                        />\r\n\r\n                        {/* Right Column */}\r\n                        <Panel id={colIds[1]} defaultSize={getSize(1)} minSize={10} className=\"flex flex-col\">\r\n                            <PanelGroup\r\n                                key={`${rightGroupId}-${groupVersions[rightGroupId] || 0}`}\r\n                                orientation=\"vertical\"\r\n                                onLayoutChanged={(l) => handleLayoutChange([4, 5], rightIds, l)}\r\n                            >\r\n                                <Panel id={rightIds[0]} defaultSize={getSize(4)} minSize={10} className=\"\">\r\n                                    {renderPane(1)}\r\n                                </Panel>\r\n                                <DraggableGutter\r\n                                    direction=\"vertical\"\r\n                                    onDoubleClick={() => handleResetLayout(rightGroupId, [4, 5], 50)}\r\n                                />\r\n                                <Panel id={rightIds[1]} defaultSize={getSize(5)} minSize={10} className=\"\">\r\n                                    {renderPane(3)}\r\n                                </Panel>\r\n                            </PanelGroup>\r\n                        </Panel>\r\n                    </PanelGroup>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (layoutType === 'grid-1-2') {\r\n            const colIds = ['col-main', 'col-split'];\r\n            const subIds = [getPaneId(1), getPaneId(2)];\r\n\r\n            const mainGroupId = 'main-group';\r\n            const subGroupId = 'sub-split-group';\r\n\r\n            return (\r\n                <div className=\"w-full h-full bg-white dark:bg-slate-950\">\r\n                    <PanelGroup\r\n                        key={`${mainGroupId}-${groupVersions[mainGroupId] || 0}`}\r\n                        orientation=\"horizontal\"\r\n                        onLayoutChanged={(l) => handleLayoutChange([0, 1], colIds, l)}\r\n                    >\r\n                        {/* Left Main */}\r\n                        <Panel id={colIds[0]} defaultSize={getSize(0, 66)} minSize={20} className=\"\">\r\n                            {renderPane(0)}\r\n                        </Panel>\r\n\r\n                        <DraggableGutter\r\n                            direction=\"horizontal\"\r\n                            onDoubleClick={() => handleResetLayout(mainGroupId, [0, 1], 50)}\r\n                        />\r\n\r\n                        {/* Right Split */}\r\n                        <Panel id={colIds[1]} defaultSize={getSize(1, 34)} minSize={20} className=\"flex flex-col\">\r\n                            <PanelGroup\r\n                                key={`${subGroupId}-${groupVersions[subGroupId] || 0}`}\r\n                                orientation=\"vertical\"\r\n                                onLayoutChanged={(l) => handleLayoutChange([2, 3], subIds, l)}\r\n                            >\r\n                                <Panel id={subIds[0]} defaultSize={getSize(2)} minSize={10} className=\"\">\r\n                                    {renderPane(1)}\r\n                                </Panel>\r\n                                <DraggableGutter\r\n                                    direction=\"vertical\"\r\n                                    onDoubleClick={() => handleResetLayout(subGroupId, [2, 3], 50)}\r\n                                />\r\n                                <Panel id={subIds[1]} defaultSize={getSize(3)} minSize={10} className=\"\">\r\n                                    {renderPane(2)}\r\n                                </Panel>\r\n                            </PanelGroup>\r\n                        </Panel>\r\n                    </PanelGroup>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return <div>Unknown Layout</div>;\r\n    };\r\n\r\n    return (\r\n        <div id=\"workspace-grid-root\" className=\"relative w-full h-full\">\r\n            {layoutContent()}\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2034, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/DrawingSidebar.tsx"],"sourcesContent":["import React from 'react';\r\nimport { useWorkspaceStore } from '../../stores/useWorkspaceStore';\r\nimport { useChartRegistryStore } from '../../stores/useChartRegistryStore';\r\nimport { MagnetControl } from '../charts/MagnetControl';\r\nimport {\r\n    MousePointer2,\r\n    Minus,\r\n    ArrowRight\r\n} from 'lucide-react';\r\n\r\n/**\r\n * TV Style Icons (Projection Style)\r\n */\r\nconst LongPosIcon = () => (\r\n    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" className=\"pointer-events-none\">\r\n        <path d=\"M7 5h13\" strokeLinecap=\"round\" />\r\n        <path d=\"M7 12h13\" strokeLinecap=\"round\" />\r\n        <path d=\"M7 19h13\" strokeLinecap=\"round\" />\r\n        <circle cx=\"4\" cy=\"5\" r=\"2\" />\r\n        <circle cx=\"4\" cy=\"12\" r=\"2\" />\r\n        <circle cx=\"4\" cy=\"19\" r=\"2\" />\r\n        <path d=\"M4 19L20 5\" strokeDasharray=\"3 3\" />\r\n    </svg>\r\n);\r\n\r\nconst ShortPosIcon = () => (\r\n    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" className=\"pointer-events-none\">\r\n        <path d=\"M7 5h13\" strokeLinecap=\"round\" />\r\n        <path d=\"M7 12h13\" strokeLinecap=\"round\" />\r\n        <path d=\"M7 19h13\" strokeLinecap=\"round\" />\r\n        <circle cx=\"4\" cy=\"5\" r=\"2\" />\r\n        <circle cx=\"4\" cy=\"12\" r=\"2\" />\r\n        <circle cx=\"4\" cy=\"19\" r=\"2\" />\r\n        <path d=\"M4 5L20 19\" strokeDasharray=\"3 3\" />\r\n    </svg>\r\n);\r\n\r\nexport const DrawingSidebar: React.FC = () => {\r\n    const { activeWorkspaceId, workspaces } = useWorkspaceStore();\r\n    const { getChart } = useChartRegistryStore();\r\n\r\n    // Helper to execute command on active pane\r\n    const executeOnActiveChart = (callback: (widget: any, pane: any) => void) => {\r\n        const workspace = workspaces.find(w => w.id === activeWorkspaceId);\r\n        if (!workspace) return;\r\n\r\n        // Diagnostic: Check for multiple active panes\r\n        const activePanes = workspace.panes.filter(p => p.isActive);\r\n        if (activePanes.length > 1) {\r\n            console.warn(`[DrawingSidebar] CRITICAL: Multiple panes are active! IDs: ${activePanes.map(p => p.id).join(', ')}`);\r\n        }\r\n\r\n        const activePane = activePanes[0];\r\n        if (!activePane) {\r\n            alert(\"No active chart selected.\");\r\n            return;\r\n        }\r\n\r\n        console.log(`[DrawingSidebar] Targeting Active Pane: ${activePane.id}`);\r\n\r\n        const chartHandle = getChart(activePane.id);\r\n        if (!chartHandle) {\r\n            console.error(`[DrawingSidebar] No handle found for pane ${activePane.id}`);\r\n            return;\r\n        }\r\n\r\n        const widget = chartHandle.getWidget();\r\n        if (widget) {\r\n            // Optional: Check if widget ID matches pane ID (requires updating ChartWidget)\r\n            if ((widget as any).id && (widget as any).id !== activePane.id) {\r\n                console.error(`[DrawingSidebar] ID MISMATCH! Pane: ${activePane.id}, Widget: ${(widget as any).id}`);\r\n            }\r\n            callback(widget, activePane);\r\n        } else {\r\n            console.error(`[DrawingSidebar] Handle found but getWidget() returned null for pane ${activePane.id}`);\r\n        }\r\n    };\r\n\r\n    const handleToolClick = (toolName: string) => {\r\n        executeOnActiveChart((widget, pane) => {\r\n            const data = (widget as any)._data;\r\n            if (!data || data.length === 0) {\r\n                alert(\"No data available to place object.\");\r\n                return;\r\n            }\r\n\r\n            const latest = data[data.length - 1];\r\n            if (!latest) return;\r\n\r\n            const time = latest.time as number;\r\n            const price = latest.close as number;\r\n\r\n            // Mapping\r\n            let shapeType = '';\r\n            let overrides = {};\r\n\r\n            if (toolName === 'HorizontalLine') shapeType = 'HorizontalLine';\r\n            if (toolName === 'HorizontalRay') shapeType = 'HorizontalRay';\r\n            if (toolName === 'VerticalLine') shapeType = 'VerticalLine';\r\n            if (toolName === 'Long') shapeType = 'Riskrewardlong';\r\n            if (toolName === 'Short') shapeType = 'Riskrewardshort';\r\n\r\n            if (shapeType) {\r\n                widget.createShape(\r\n                    { time, price },\r\n                    { shape: shapeType, overrides, disableSelection: false }\r\n                );\r\n                console.log(`[DrawingSidebar] Created ${shapeType} at ${time}, ${price}`);\r\n            }\r\n        });\r\n    };\r\n\r\n    const btnClass = \"p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-slate-100 transition-colors text-slate-500 dark:text-slate-400\";\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center gap-4 py-4 w-16 border-r border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 relative z-[100] pointer-events-auto\">\r\n            {/* 1. Crosshair/Cursor */}\r\n            <button\r\n                onClick={() => handleToolClick('Cursor')}\r\n                className={btnClass}\r\n                title=\"Crosshair\"\r\n            >\r\n                <MousePointer2 size={20} strokeWidth={1.5} className=\"pointer-events-none\" />\r\n            </button>\r\n\r\n            <div className=\"w-6 h-px bg-slate-200 dark:bg-slate-800\" />\r\n\r\n            {/* 2. Line Tools */}\r\n            <div className=\"flex flex-col gap-2\">\r\n                <button\r\n                    onClick={() => handleToolClick('HorizontalLine')}\r\n                    className={btnClass}\r\n                    title=\"Horizontal Line\"\r\n                >\r\n                    <Minus size={20} strokeWidth={1.5} className=\"pointer-events-none\" />\r\n                </button>\r\n                <button\r\n                    onClick={() => handleToolClick('VerticalLine')}\r\n                    className={btnClass}\r\n                    title=\"Vertical Line\"\r\n                >\r\n                    <Minus size={20} strokeWidth={1.5} className=\"pointer-events-none rotate-90\" />\r\n                </button>\r\n                <button\r\n                    onClick={() => handleToolClick('HorizontalRay')}\r\n                    className={btnClass}\r\n                    title=\"Horizontal Ray\"\r\n                >\r\n                    <ArrowRight size={20} strokeWidth={1.5} className=\"pointer-events-none\" />\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"w-6 h-px bg-slate-200 dark:bg-slate-800\" />\r\n\r\n            {/* 3. Prediction Tools */}\r\n            <div className=\"flex flex-col gap-2\">\r\n                <button\r\n                    onClick={() => handleToolClick('Long')}\r\n                    className={btnClass}\r\n                    title=\"Long Position\"\r\n                >\r\n                    <LongPosIcon />\r\n                </button>\r\n                <button\r\n                    onClick={() => handleToolClick('Short')}\r\n                    className={btnClass}\r\n                    title=\"Short Position\"\r\n                >\r\n                    <ShortPosIcon />\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"w-6 h-px bg-slate-200 dark:bg-slate-800\" />\r\n\r\n            {/* 4. Magnet */}\r\n            <div className=\"scale-75 origin-center\">\r\n                <MagnetControl side=\"right\" />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2452, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/LayoutSwitcher.tsx"],"sourcesContent":["\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { useWorkspaceStore, LayoutType } from '../../stores/useWorkspaceStore';\r\nimport { Square, Columns, Rows, Grid2x2, LayoutTemplate, ChevronDown } from 'lucide-react';\r\n\r\nexport const LayoutSwitcher: React.FC = () => {\r\n    const { activeWorkspaceId, updateWorkspaceLayout, workspaces } = useWorkspaceStore();\r\n    const activeWorkspace = workspaces.find(w => w.id === activeWorkspaceId);\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Close on click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    if (!activeWorkspace) return null;\r\n\r\n    const currentLayout = activeWorkspace.layoutType;\r\n\r\n    const setLayout = (layout: LayoutType) => {\r\n        updateWorkspaceLayout(activeWorkspaceId, layout);\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const options: { id: LayoutType; icon: React.ReactNode; label: string }[] = [\r\n        { id: 'single', icon: <Square size={14} />, label: 'Single Config' },\r\n        { id: 'split-vertical', icon: <Columns size={14} />, label: 'Split Vertical' },\r\n        { id: 'split-horizontal', icon: <Rows size={14} />, label: 'Split Horizontal' },\r\n        { id: 'grid-2x2', icon: <Grid2x2 size={14} />, label: 'Grid 2x2' },\r\n        { id: 'grid-1-2', icon: <LayoutTemplate size={14} />, label: 'Grid 1+2' },\r\n    ];\r\n\r\n    const activeOption = options.find(o => o.id === currentLayout) || options[0];\r\n\r\n    return (\r\n        <div className=\"relative\" ref={containerRef}>\r\n            <button\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className=\"flex items-center gap-2 h-8 px-2 bg-transparent rounded-md hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors text-slate-600 dark:text-slate-300\"\r\n                title=\"Change Layout\"\r\n            >\r\n                {activeOption.icon}\r\n                <ChevronDown size={12} className={`transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />\r\n            </button>\r\n\r\n            {isOpen && (\r\n                <div className=\"absolute top-full left-0 mt-1 w-48 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg shadow-xl z-50 overflow-hidden flex flex-col py-1\">\r\n                    {options.map((opt) => (\r\n                        <button\r\n                            key={opt.id}\r\n                            onClick={() => setLayout(opt.id)}\r\n                            className={`\r\n                                flex items-center gap-3 px-3 py-2 w-full text-left transition-colors\r\n                                ${currentLayout === opt.id\r\n                                    ? 'bg-blue-600/10 text-blue-600 dark:text-blue-400'\r\n                                    : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-slate-200'}\r\n                            `}\r\n                        >\r\n                            <span className={currentLayout === opt.id ? 'text-blue-600 dark:text-blue-400' : 'text-slate-500'}>\r\n                                {opt.icon}\r\n                            </span>\r\n                            <span className=\"text-xs font-medium\">{opt.label}</span>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;AAEO,MAAM,iBAA2B;;IACpC,MAAM,EAAE,iBAAiB,EAAE,qBAAqB,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAiB;IAClF,MAAM,kBAAkB,WAAW,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACtD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,eAAe,IAAA,uKAAM,EAAiB;IAE5C,yBAAyB;IACzB,IAAA,0KAAS;oCAAC;YACN,MAAM;+DAAqB,CAAC;oBACxB,IAAI,aAAa,OAAO,IAAI,CAAC,aAAa,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;wBAC9E,UAAU;oBACd;gBACJ;;YACA,SAAS,gBAAgB,CAAC,aAAa;YACvC;4CAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;;QAC3D;mCAAG,EAAE;IAEL,IAAI,CAAC,iBAAiB,OAAO;IAE7B,MAAM,gBAAgB,gBAAgB,UAAU;IAEhD,MAAM,YAAY,CAAC;QACf,sBAAsB,mBAAmB;QACzC,UAAU;IACd;IAEA,MAAM,UAAsE;QACxE;YAAE,IAAI;YAAU,oBAAM,6LAAC,mNAAM;gBAAC,MAAM;;;;;;YAAQ,OAAO;QAAgB;QACnE;YAAE,IAAI;YAAkB,oBAAM,6LAAC,2NAAO;gBAAC,MAAM;;;;;;YAAQ,OAAO;QAAiB;QAC7E;YAAE,IAAI;YAAoB,oBAAM,6LAAC,kNAAI;gBAAC,MAAM;;;;;;YAAQ,OAAO;QAAmB;QAC9E;YAAE,IAAI;YAAY,oBAAM,6LAAC,0NAAO;gBAAC,MAAM;;;;;;YAAQ,OAAO;QAAW;QACjE;YAAE,IAAI;YAAY,oBAAM,6LAAC,+OAAc;gBAAC,MAAM;;;;;;YAAQ,OAAO;QAAW;KAC3E;IAED,MAAM,eAAe,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,kBAAkB,OAAO,CAAC,EAAE;IAE5E,qBACI,6LAAC;QAAI,WAAU;QAAW,KAAK;;0BAC3B,6LAAC;gBACG,SAAS,IAAM,UAAU,CAAC;gBAC1B,WAAU;gBACV,OAAM;;oBAEL,aAAa,IAAI;kCAClB,6LAAC,sOAAW;wBAAC,MAAM;wBAAI,WAAW,CAAC,kCAAkC,EAAE,SAAS,eAAe,IAAI;;;;;;;;;;;;YAGtG,wBACG,6LAAC;gBAAI,WAAU;0BACV,QAAQ,GAAG,CAAC,CAAC,oBACV,6LAAC;wBAEG,SAAS,IAAM,UAAU,IAAI,EAAE;wBAC/B,WAAW,CAAC;;gCAER,EAAE,kBAAkB,IAAI,EAAE,GACpB,oDACA,+HAA+H;4BACzI,CAAC;;0CAED,6LAAC;gCAAK,WAAW,kBAAkB,IAAI,EAAE,GAAG,qCAAqC;0CAC5E,IAAI,IAAI;;;;;;0CAEb,6LAAC;gCAAK,WAAU;0CAAuB,IAAI,KAAK;;;;;;;uBAZ3C,IAAI,EAAE;;;;;;;;;;;;;;;;AAmBvC;GAtEa;;QACwD,0JAAiB;;;KADzE"}},
    {"offset": {"line": 2638, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/FinancialToolbar.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Plus, BarChart2, Layers, Cpu, Zap, Briefcase, Shield } from 'lucide-react';\r\nimport { useWorkspaceStore } from '../../stores/useWorkspaceStore';\r\n\r\ninterface FinancialToolbarProps {\r\n    botId?: string;\r\n    isOnline?: boolean;\r\n    onToggleTrades?: () => void;\r\n    onToggleHistory?: () => void;\r\n    isTradesOpen?: boolean;\r\n    isHistoryOpen?: boolean;\r\n}\r\n\r\nexport const FinancialToolbar: React.FC<FinancialToolbarProps> = ({\r\n    botId,\r\n    isOnline,\r\n    onToggleTrades,\r\n    onToggleHistory,\r\n    isTradesOpen,\r\n    isHistoryOpen\r\n}) => {\r\n    const { activeWorkspaceId, workspaces } = useWorkspaceStore();\r\n\r\n    return (\r\n        <div className=\"h-9 bg-white dark:bg-slate-950 border-t border-slate-200 dark:border-slate-800 flex items-center justify-between px-3 shrink-0 z-20\">\r\n            {/* Left Tools */}\r\n            <div className=\"flex items-center gap-2\">\r\n                <button\r\n                    onClick={onToggleTrades}\r\n                    className={`flex items-center gap-1.5 text-xs px-2 py-1 rounded transition-colors ${isTradesOpen ? \"text-blue-600 dark:text-blue-400 bg-slate-100 dark:bg-slate-900\" : \"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-900\"}`}\r\n                    title=\"Active Trades\"\r\n                >\r\n                    <Briefcase size={14} />\r\n                    <span>Trades</span>\r\n                </button>\r\n                <button\r\n                    onClick={onToggleHistory}\r\n                    className={`flex items-center gap-1.5 text-xs px-2 py-1 rounded transition-colors ${isHistoryOpen ? \"text-blue-600 dark:text-blue-400 bg-slate-100 dark:bg-slate-900\" : \"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-900\"}`}\r\n                    title=\"Trade History\"\r\n                >\r\n                    <Shield size={14} />\r\n                    <span>History</span>\r\n                </button>\r\n\r\n                <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-800 mx-1\" />\r\n\r\n                <button className=\"flex items-center gap-1.5 text-xs text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-900 px-2 py-1 rounded transition-colors\" title=\"Strategy Lab\">\r\n                    <Cpu size={14} />\r\n                    <span>Strategies</span>\r\n                </button>\r\n                <button className=\"flex items-center gap-1.5 text-xs text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-900 px-2 py-1 rounded transition-colors\" title=\"Performance\">\r\n                    <BarChart2 size={14} />\r\n                    <span>Stats</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* Right Status */}\r\n            <div className=\"flex items-center gap-4 text-[10px] text-slate-500 font-mono\">\r\n                <div className=\"flex items-center gap-1.5\">\r\n                    <Layers size={10} />\r\n                    <span>Workplace v2.1</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;AAWO,MAAM,mBAAoD,CAAC,EAC9D,KAAK,EACL,QAAQ,EACR,cAAc,EACd,eAAe,EACf,YAAY,EACZ,aAAa,EAChB;;IACG,MAAM,EAAE,iBAAiB,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAiB;IAE3D,qBACI,6LAAC;QAAI,WAAU;;0BAEX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBACG,SAAS;wBACT,WAAW,CAAC,sEAAsE,EAAE,eAAe,oEAAoE,gIAAgI;wBACvS,OAAM;;0CAEN,6LAAC,4NAAS;gCAAC,MAAM;;;;;;0CACjB,6LAAC;0CAAK;;;;;;;;;;;;kCAEV,6LAAC;wBACG,SAAS;wBACT,WAAW,CAAC,sEAAsE,EAAE,gBAAgB,oEAAoE,gIAAgI;wBACxS,OAAM;;0CAEN,6LAAC,mNAAM;gCAAC,MAAM;;;;;;0CACd,6LAAC;0CAAK;;;;;;;;;;;;kCAGV,6LAAC;wBAAI,WAAU;;;;;;kCAEf,6LAAC;wBAAO,WAAU;wBAAqM,OAAM;;0CACzN,6LAAC,0MAAG;gCAAC,MAAM;;;;;;0CACX,6LAAC;0CAAK;;;;;;;;;;;;kCAEV,6LAAC;wBAAO,WAAU;wBAAqM,OAAM;;0CACzN,6LAAC,gPAAS;gCAAC,MAAM;;;;;;0CACjB,6LAAC;0CAAK;;;;;;;;;;;;;;;;;;0BAKd,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;;sCACX,6LAAC,mNAAM;4BAAC,MAAM;;;;;;sCACd,6LAAC;sCAAK;;;;;;;;;;;;;;;;;;;;;;;AAK1B;GApDa;;QAQiC,0JAAiB;;;KARlD"}},
    {"offset": {"line": 2825, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/SyncCenter.tsx"],"sourcesContent":["\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport { LayoutStateManager, SyncOptions } from '../../stores/LayoutStateManager';\r\nimport { Link, Link2, ScanLine, Info, ChevronDown } from 'lucide-react';\r\n\r\nexport const SyncCenter: React.FC = () => {\r\n    const [options, setOptions] = useState<SyncOptions>({ isTimeframeSync: false, isPositionSync: false });\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const dropdownRef = useRef<HTMLDivElement>(null);\r\n    const manager = LayoutStateManager.getInstance();\r\n\r\n    useEffect(() => {\r\n        setOptions(manager.getOptions());\r\n        // Simple polling to keep UI in sync if changed elsewhere\r\n        const interval = setInterval(() => {\r\n            const current = manager.getOptions();\r\n            setOptions(prev => {\r\n                if (prev.isTimeframeSync !== current.isTimeframeSync || prev.isPositionSync !== current.isPositionSync) {\r\n                    return current;\r\n                }\r\n                return prev;\r\n            });\r\n        }, 1000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    // Close on click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const toggleTimeframe = () => {\r\n        const newVal = !options.isTimeframeSync;\r\n        const newOpts = { ...options, isTimeframeSync: newVal };\r\n        setOptions(newOpts);\r\n        manager.setOptions({ isTimeframeSync: newVal });\r\n    };\r\n\r\n    const togglePosition = () => {\r\n        const newVal = !options.isPositionSync;\r\n        const newOpts = { ...options, isPositionSync: newVal };\r\n        setOptions(newOpts);\r\n        manager.setOptions({ isPositionSync: newVal });\r\n    };\r\n\r\n    const toggleTotalSync = () => {\r\n        // If anything is off, turn all on. If all on, turn all off.\r\n        const allOn = options.isTimeframeSync && options.isPositionSync;\r\n        const newState = !allOn;\r\n        const newOpts = { isTimeframeSync: newState, isPositionSync: newState };\r\n        setOptions(newOpts);\r\n        manager.setOptions(newOpts);\r\n    };\r\n\r\n    const isAnyActive = options.isTimeframeSync || options.isPositionSync;\r\n\r\n    return (\r\n        <div className=\"relative\" ref={dropdownRef}>\r\n            {/* Main Split Button */}\r\n            <div className={`flex items-center h-8 rounded-md transition-all ${isAnyActive ? 'bg-blue-500/20 text-blue-400' : 'bg-transparent text-slate-400'}`}>\r\n\r\n                {/* Main Toggle Action */}\r\n                <button\r\n                    onClick={toggleTotalSync}\r\n                    className={`flex items-center justify-center pl-2 pr-1 h-full transition-colors rounded-l-md ${isAnyActive ? 'hover:bg-blue-500/30' : 'hover:bg-slate-800'}`}\r\n                    title={isAnyActive ? \"Disable All Sync\" : \"Enable All Sync\"}\r\n                >\r\n                    {isAnyActive ? <Link size={14} /> : <Link2 size={14} />}\r\n                </button>\r\n\r\n                {/* Dropdown Trigger */}\r\n                <button\r\n                    onClick={() => setIsOpen(!isOpen)}\r\n                    className={`flex items-center justify-center px-1 h-full transition-colors rounded-r-md ${isAnyActive ? 'hover:bg-blue-500/30' : 'hover:bg-slate-800'}`}\r\n                >\r\n                    <ChevronDown size={12} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Dropdown Menu */}\r\n            {isOpen && (\r\n                <div className=\"absolute top-full right-0 mt-1 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl z-50 overflow-hidden flex flex-col py-1\">\r\n\r\n                    {/* Timeframe Item */}\r\n                    <div\r\n                        className=\"flex items-center justify-between px-3 py-2 hover:bg-slate-800 cursor-pointer group\"\r\n                        onClick={toggleTimeframe}\r\n                    >\r\n                        <div className=\"flex items-center gap-2 text-slate-300 group-hover:text-slate-100\">\r\n                            <ScanLine size={14} />\r\n                            <span className=\"text-xs font-medium\">Timeframe</span>\r\n                        </div>\r\n\r\n                        {/* Custom Switch Toggle */}\r\n                        <div className={`w-8 h-4 rounded-full relative transition-colors ${options.isTimeframeSync ? 'bg-blue-600' : 'bg-slate-600'}`}>\r\n                            <div className={`absolute top-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-all ${options.isTimeframeSync ? 'left-4.5' : 'left-0.5'}`} style={{ left: options.isTimeframeSync ? 'calc(100% - 14px)' : '2px' }} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Crosshair Item */}\r\n                    <div\r\n                        className=\"flex items-center justify-between px-3 py-2 hover:bg-slate-800 cursor-pointer group\"\r\n                        onClick={togglePosition}\r\n                    >\r\n                        <div className=\"flex items-center gap-2 text-slate-300 group-hover:text-slate-100\">\r\n                            <Link size={14} />\r\n                            <span className=\"text-xs font-medium\">Cross/Scroll</span>\r\n                        </div>\r\n\r\n                        {/* Custom Switch Toggle */}\r\n                        <div className={`w-8 h-4 rounded-full relative transition-colors ${options.isPositionSync ? 'bg-blue-600' : 'bg-slate-600'}`}>\r\n                            <div className={`absolute top-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-all`} style={{ left: options.isPositionSync ? 'calc(100% - 14px)' : '2px' }} />\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3101, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/workspaces/WorkspaceShell.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { WorkspaceTabs } from './WorkspaceTabs';\r\nimport { LayoutGrid } from './LayoutGrid';\r\nimport { DrawingSidebar } from './DrawingSidebar';\r\nimport { LayoutSwitcher } from './LayoutSwitcher';\r\nimport { FinancialToolbar } from './FinancialToolbar';\r\nimport { SyncCenter } from './SyncCenter';\r\nimport { Settings, Maximize, Minimize, Calendar, FlaskConical, X } from 'lucide-react';\r\nimport { ChartSettingsDialog } from '../live/ChartSettingsDialog';\r\nimport { GoToDateModal } from '../charts/modals/GoToDateModal';\r\nimport { useWorkspaceStore } from '../../stores/useWorkspaceStore';\r\n// ... imports ...\r\nimport { TradesPanel } from '../trades/TradesPanel';\r\nimport { HistoryPanel } from '../trades/HistoryPanel';\r\n\r\ninterface WorkspaceShellProps {\r\n    onNavigate?: (view: any) => void;\r\n    accounts: any[];\r\n    datafeedBotId: string;\r\n    isDatafeedOnline: boolean;\r\n    datafeedConfigError: boolean;\r\n}\r\n\r\nexport const WorkspaceShell: React.FC<WorkspaceShellProps> = ({\r\n    onNavigate,\r\n    accounts,\r\n    datafeedBotId,\r\n    isDatafeedOnline,\r\n    datafeedConfigError\r\n}) => {\r\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\r\n    const [isGoToDateOpen, setIsGoToDateOpen] = useState(false);\r\n\r\n    // Panel States\r\n    const [showTrades, setShowTrades] = useState(false);\r\n    const [showHistory, setShowHistory] = useState(false);\r\n\r\n    // Browser Title Logic: Use the symbol of the currently ACTIVE chart pane\r\n    const activeSymbol = useWorkspaceStore(state => {\r\n        const activeW = state.workspaces.find(w => w.id === state.activeWorkspaceId);\r\n        if (!activeW) return null;\r\n        // Find the active pane, or fallback to the first one\r\n        const activePane = activeW.panes.find(p => p.isActive);\r\n        return activePane?.symbol || activeW.panes?.[0]?.symbol;\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (activeSymbol) {\r\n            document.title = `${activeSymbol} | Awesome Cockpit`;\r\n        } else {\r\n            // Fallback handled by layout or page unmount, but good to reset\r\n            document.title = 'Awesome Cockpit';\r\n        }\r\n    }, [activeSymbol]);\r\n\r\n    const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const handleFullscreenChange = () => {\r\n            setIsFullscreen(!!document.fullscreenElement);\r\n        };\r\n        document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n        return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n    }, []);\r\n\r\n    const toggleFullscreen = () => {\r\n        if (!document.fullscreenElement) {\r\n            document.documentElement.requestFullscreen();\r\n        } else {\r\n            document.exitFullscreen();\r\n        }\r\n    };\r\n\r\n    const handleGoToDate = (timestamp: number) => {\r\n        const state = useWorkspaceStore.getState();\r\n        const activeWorkspace = state.workspaces.find(w => w.id === state.activeWorkspaceId);\r\n\r\n        if (activeWorkspace) {\r\n            // Find active pane or default to first\r\n            const activePane = activeWorkspace.panes.find(p => p.isActive) || activeWorkspace.panes[0];\r\n\r\n            if (activePane) {\r\n                state.requestScrollToTime(activePane.id, timestamp);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex-1 flex flex-col h-full bg-slate-50 dark:bg-slate-950 relative\">\r\n            {/* Header Row 1: Workspace Tabs + Global Settings + Layout + Sync */}\r\n            <header className=\"h-10 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex items-center px-4 justify-between flex-shrink-0 z-20 gap-4\">\r\n                {/* Workspace Tabs (Left) */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                    <WorkspaceTabs />\r\n                </div>\r\n\r\n                {/* Global Controls (Right) */}\r\n                <div className=\"flex items-center gap-3 shrink-0\">\r\n\r\n                    {/* Segmented Mode Toggle */}\r\n                    <div className=\"flex bg-slate-100 dark:bg-slate-800 p-0.5 rounded-md border border-slate-200 dark:border-slate-700 mr-2\">\r\n                        <button\r\n                            onClick={() => useWorkspaceStore.getState().setIsTestMode(false)}\r\n                            className={`\r\n                            px-3 py-1 rounded-sm text-[10px] font-bold transition-all\r\n                            ${!useWorkspaceStore(state => state.isTestMode)\r\n                                    ? \"bg-indigo-600 text-white shadow\"\r\n                                    : \"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300\"}\r\n                            `}\r\n                        >\r\n                            LIVE\r\n                        </button>\r\n                        <button\r\n                            onClick={() => useWorkspaceStore.getState().setIsTestMode(true)}\r\n                            className={`\r\n                            px-3 py-1 rounded-sm text-[10px] font-bold transition-all\r\n                            ${useWorkspaceStore(state => state.isTestMode)\r\n                                    ? \"bg-amber-500 text-black shadow\"\r\n                                    : \"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300\"}\r\n                            `}\r\n                        >\r\n                            TEST\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-700\" />\r\n\r\n                    {/* Go To Date */}\r\n                    <button\r\n                        onClick={() => setIsGoToDateOpen(true)}\r\n                        className=\"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-md text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors\"\r\n                        title=\"Go to Date...\"\r\n                    >\r\n                        <Calendar size={18} />\r\n                    </button>\r\n\r\n                    {/* Layout Switcher */}\r\n                    <div className=\"h-6 flex items-center\">\r\n                        <LayoutSwitcher />\r\n                    </div>\r\n\r\n                    {/* Divider */}\r\n                    <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-700\" />\r\n\r\n                    {/* Sync Controls */}\r\n                    <SyncCenter />\r\n\r\n                    {/* Divider */}\r\n                    <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-700\" />\r\n\r\n\r\n                    <button\r\n                        onClick={toggleFullscreen}\r\n                        className=\"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-md text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors\"\r\n                        title={isFullscreen ? \"Exit Fullscreen\" : \"Enter Fullscreen\"}\r\n                    >\r\n                        {isFullscreen ? <Minimize size={18} /> : <Maximize size={18} />}\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => setIsSettingsOpen(true)}\r\n                        className=\"p-1.5 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-md text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors\"\r\n                        title=\"Global Chart Settings\"\r\n                    >\r\n                        <Settings size={18} />\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Main Content Area: Sidebar + Grid + Bottom Panel Overlay */}\r\n            <div className=\"flex-1 relative flex flex-row min-h-0\">\r\n                {/* Left Sidebar: Drawing Tools */}\r\n                <DrawingSidebar />\r\n\r\n                {/* Center: Grid + Panels */}\r\n                <div className=\"flex-1 flex flex-col h-full overflow-hidden relative bg-slate-50 dark:bg-slate-950\">\r\n\r\n\r\n                    <div className=\"flex-1 relative overflow-hidden\">\r\n                        <LayoutGrid botId={datafeedBotId} accounts={accounts} />\r\n                    </div>\r\n\r\n                    {/* Bottom Panels */}\r\n                    {showTrades && <TradesPanel onClose={() => setShowTrades(false)} />}\r\n                    {showHistory && <HistoryPanel onClose={() => setShowHistory(false)} />}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Footer: Global Financial Toolbar */}\r\n            < FinancialToolbar\r\n                botId={datafeedBotId}\r\n                isOnline={isDatafeedOnline}\r\n                onToggleTrades={() => { setShowTrades(!showTrades); setShowHistory(false); }}\r\n                onToggleHistory={() => { setShowHistory(!showHistory); setShowTrades(false); }}\r\n                isTradesOpen={showTrades}\r\n                isHistoryOpen={showHistory}\r\n            />\r\n\r\n            <ChartSettingsDialog\r\n                isOpen={isSettingsOpen}\r\n                onClose={() => setIsSettingsOpen(false)}\r\n            />\r\n\r\n            <GoToDateModal\r\n                isOpen={isGoToDateOpen}\r\n                onClose={() => setIsGoToDateOpen(false)}\r\n                onGoTo={handleGoToDate}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}}]
}