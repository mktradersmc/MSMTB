{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/live/SymbolBrowser.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useLayoutEffect } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { Search, RefreshCw, ChevronDown } from 'lucide-react';\r\nimport { useSymbolStore } from '../../stores/useSymbolStore';\r\n\r\ninterface SymbolBrowserProps {\r\n    onSelectSymbol: (symbol: string, info?: any) => void;\r\n    currentSymbol?: string;\r\n    className?: string;\r\n    botId?: string;\r\n    variant?: 'input' | 'button'; // Defaults to 'input'\r\n}\r\n\r\nexport interface SymbolBrowserHandle {\r\n    close: () => void;\r\n}\r\n\r\nexport const SymbolBrowser = React.forwardRef<SymbolBrowserHandle, SymbolBrowserProps>(({ onSelectSymbol, currentSymbol, className, botId, variant = 'input' }, ref) => {\r\n    // Global Store\r\n    const { symbols, symbolMap, isLoading, error, fetchSymbols } = useSymbolStore();\r\n\r\n    const [filter, setFilter] = useState('');\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const wrapperRef = useRef<HTMLDivElement>(null);\r\n    const dropdownRef = useRef<HTMLDivElement>(null);\r\n    const [dropdownSearch, setDropdownSearch] = useState('');\r\n\r\n    // Expose close method\r\n    React.useImperativeHandle(ref, () => ({\r\n        close: () => setIsOpen(false)\r\n    }));\r\n\r\n    // Portal Positioning State\r\n    const [coords, setCoords] = useState<{ top: number; left: number; width: number; maxHeight: number } | null>(null);\r\n\r\n    // Initial Load & Refetch on Bot Change\r\n    useEffect(() => {\r\n        fetchSymbols(botId);\r\n    }, [botId, fetchSymbols]);\r\n\r\n    // Outside Click Handler (Updated for Portal)\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            const target = event.target as Node;\r\n            const clickedWrapper = wrapperRef.current && wrapperRef.current.contains(target);\r\n            const clickedDropdown = dropdownRef.current && dropdownRef.current.contains(target);\r\n\r\n            if (!clickedWrapper && !clickedDropdown) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    // Reset dropdown search when opening\r\n    useEffect(() => {\r\n        if (isOpen && variant === 'button') {\r\n            setDropdownSearch('');\r\n        }\r\n    }, [isOpen, variant]);\r\n\r\n    // Calculate Position on Open\r\n    useLayoutEffect(() => {\r\n        if (isOpen && wrapperRef.current) {\r\n            const rect = wrapperRef.current.getBoundingClientRect();\r\n            const viewportHeight = window.innerHeight;\r\n            const spaceBelow = viewportHeight - rect.bottom - 10; // 10px buffer\r\n\r\n            // Constrain height if space is limited, but ensure at least 150px usability if possible\r\n            const maxHeight = Math.max(150, Math.min(400, spaceBelow));\r\n\r\n            setCoords({\r\n                top: rect.bottom + 4, // 4px gap\r\n                left: rect.left,\r\n                width: 288, // w-72 = 18rem = 288px\r\n                maxHeight: maxHeight\r\n            });\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const handleRefresh = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        fetchSymbols(botId);\r\n    };\r\n\r\n    const handleSelect = (sym: string) => {\r\n        const info = symbolMap.get(sym);\r\n        onSelectSymbol(sym, info);\r\n        setFilter('');\r\n        setDropdownSearch('');\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const activeFilter = variant === 'button' ? dropdownSearch : filter;\r\n\r\n    const filteredSymbols = symbols.filter(s =>\r\n        s && typeof s === 'string' && s.toLowerCase().includes(activeFilter.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div ref={wrapperRef} className={`relative ${className || ''}`}>\r\n            {/* Input Trigger (Default) */}\r\n            {variant !== 'button' && (\r\n                <div className=\"relative group\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-500 group-focus-within:text-blue-400 transition-colors\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder={currentSymbol || \"Search Symbol...\"}\r\n                        className=\"w-64 bg-slate-100 dark:bg-slate-900 border border-slate-300 dark:border-slate-700/50 rounded-lg py-2 pl-9 pr-10 text-sm text-slate-900 dark:text-slate-200 placeholder:text-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 transition-all font-medium\"\r\n                        value={filter}\r\n                        onChange={(e) => setFilter(e.target.value)}\r\n                        onFocus={() => setIsOpen(true)}\r\n                    />\r\n                    <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                        <button\r\n                            onClick={handleRefresh}\r\n                            className=\"p-1 hover:bg-slate-800 rounded-md text-slate-500 hover:text-white transition-colors\"\r\n                            title=\"Refresh Symbols\"\r\n                        >\r\n                            <RefreshCw size={12} className={isLoading ? \"animate-spin\" : \"\"} />\r\n                        </button>\r\n                        <ChevronDown size={14} className={`text-slate-600 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Button Trigger (New) */}\r\n            {variant === 'button' && (\r\n                <button\r\n                    onClick={() => setIsOpen(!isOpen)}\r\n                    className=\"flex items-center gap-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded px-2 py-1 transition-colors group\"\r\n                >\r\n                    <div className=\"flex flex-col items-start\">\r\n                        <span className={`text-sm font-bold ${currentSymbol ? 'text-slate-700 dark:text-slate-100' : 'text-slate-500 dark:text-slate-400'}`}>\r\n                            {currentSymbol || \"Select Symbol\"}\r\n                        </span>\r\n                    </div>\r\n                    <ChevronDown size={12} className={`text-slate-500 group-hover:text-blue-400 transition-transform ${isOpen ? 'rotate-180' : ''}`} />\r\n                </button>\r\n            )}\r\n\r\n            {/* Portal Dropdown */}\r\n            {isOpen && coords && createPortal(\r\n                <div\r\n                    ref={dropdownRef}\r\n                    className=\"symbol-browser-dropdown fixed bg-white dark:bg-slate-900/95 backdrop-blur-xl border border-slate-200 dark:border-slate-700/50 rounded-xl shadow-2xl z-[9999] overflow-hidden animate-in fade-in zoom-in-95 duration-200 flex flex-col\"\r\n                    style={{\r\n                        top: coords.top,\r\n                        left: coords.left,\r\n                        width: coords.width,\r\n                        maxHeight: coords.maxHeight\r\n                    }}\r\n                >\r\n\r\n                    {/* Embedded Search for Button Mode */}\r\n                    {variant === 'button' && (\r\n                        <div className=\"p-2 border-b border-slate-200 dark:border-slate-800/50 shrink-0\">\r\n                            <div className=\"relative\">\r\n                                <Search className=\"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-slate-500\" />\r\n                                <input\r\n                                    autoFocus\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search...\"\r\n                                    className=\"w-full bg-slate-100 dark:bg-slate-950 border border-slate-300 dark:border-slate-800 rounded-md py-1.5 pl-8 pr-2 text-xs text-slate-900 dark:text-white focus:outline-none focus:border-blue-500\"\r\n                                    value={dropdownSearch}\r\n                                    onChange={(e) => setDropdownSearch(e.target.value)}\r\n                                />\r\n                                <button\r\n                                    onClick={handleRefresh}\r\n                                    className=\"absolute right-1 top-1/2 -translate-y-1/2 p-1 text-slate-500 hover:text-blue-400\"\r\n                                >\r\n                                    <RefreshCw size={10} className={isLoading ? \"animate-spin\" : \"\"} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"overflow-y-auto scrollbar-thin scrollbar-thumb-slate-700 hover:scrollbar-thumb-blue-600 scrollbar-track-transparent flex-1\">\r\n                        {/* Status Messages */}\r\n                        {isLoading && symbols.length === 0 && (\r\n                            <div className=\"p-4 text-center text-xs text-slate-500 animate-pulse\">Updating Market Watch...</div>\r\n                        )}\r\n                        {error && (\r\n                            <div className=\"p-4 text-center text-xs text-red-500 font-medium bg-red-500/10 m-2 rounded\">\r\n                                {error}\r\n                            </div>\r\n                        )}\r\n                        {!isLoading && !error && filteredSymbols.length === 0 && (\r\n                            <div className=\"p-4 text-center text-xs text-slate-500\">\r\n                                No matching symbols found.\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* List Items */}\r\n                        <div className=\"p-1.5 space-y-0.5\">\r\n                            {filteredSymbols.map(sym => (\r\n                                <button\r\n                                    key={sym}\r\n                                    onClick={() => handleSelect(sym)}\r\n                                    className={`w-full text-left px-3 py-2.5 rounded-lg text-sm font-medium transition-all group flex items-center justify-between ${currentSymbol === sym\r\n                                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/20'\r\n                                        : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-slate-100'\r\n                                        }`}\r\n                                >\r\n                                    <span>{sym}</span>\r\n                                    {currentSymbol === sym && <span className=\"w-1.5 h-1.5 rounded-full bg-white shadow-[0_0_8px_white]\" />}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                    {/* Header/Footer of Dropdown */}\r\n                    <div className=\"bg-slate-50 dark:bg-slate-950/50 px-3 py-2 border-t border-slate-200 dark:border-slate-800/50 text-[10px] text-slate-500 flex justify-between shrink-0\">\r\n                        <span>{filteredSymbols.length} Symbols</span>\r\n                        <span>MT5 Live Feed</span>\r\n                    </div>\r\n                </div>,\r\n                document.body\r\n            )}\r\n        </div>\r\n    );\r\n});\r\n\r\nSymbolBrowser.displayName = 'SymbolBrowser';\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;AAAA;AACA;;;;;;;AAcO,MAAM,8BAAgB,GAAA,wKAAK,CAAC,UAAU,SAA0C,CAAC,EAAE,cAAc,EAAE,aAAa,EAAE,SAAS,EAAE,KAAK,EAAE,UAAU,OAAO,EAAE,EAAE;;IAC5J,eAAe;IACf,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,SAAS,EAAE,KAAK,EAAE,YAAY,EAAE,GAAG,IAAA,oJAAc;IAE7E,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,aAAa,IAAA,uKAAM,EAAiB;IAC1C,MAAM,cAAc,IAAA,uKAAM,EAAiB;IAC3C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IAErD,sBAAsB;IACtB,wKAAK,CAAC,mBAAmB,CAAC;6CAAK,IAAM,CAAC;gBAClC,KAAK;yDAAE,IAAM,UAAU;;YAC3B,CAAC;;IAED,2BAA2B;IAC3B,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAyE;IAE7G,uCAAuC;IACvC,IAAA,0KAAS;mCAAC;YACN,aAAa;QACjB;kCAAG;QAAC;QAAO;KAAa;IAExB,6CAA6C;IAC7C,IAAA,0KAAS;mCAAC;YACN,MAAM;8DAAqB,CAAC;oBACxB,MAAM,SAAS,MAAM,MAAM;oBAC3B,MAAM,iBAAiB,WAAW,OAAO,IAAI,WAAW,OAAO,CAAC,QAAQ,CAAC;oBACzE,MAAM,kBAAkB,YAAY,OAAO,IAAI,YAAY,OAAO,CAAC,QAAQ,CAAC;oBAE5E,IAAI,CAAC,kBAAkB,CAAC,iBAAiB;wBACrC,UAAU;oBACd;gBACJ;;YACA,SAAS,gBAAgB,CAAC,aAAa;YACvC;2CAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;;QAC3D;kCAAG,EAAE;IAEL,qCAAqC;IACrC,IAAA,0KAAS;mCAAC;YACN,IAAI,UAAU,YAAY,UAAU;gBAChC,kBAAkB;YACtB;QACJ;kCAAG;QAAC;QAAQ;KAAQ;IAEpB,6BAA6B;IAC7B,IAAA,gLAAe;yCAAC;YACZ,IAAI,UAAU,WAAW,OAAO,EAAE;gBAC9B,MAAM,OAAO,WAAW,OAAO,CAAC,qBAAqB;gBACrD,MAAM,iBAAiB,OAAO,WAAW;gBACzC,MAAM,aAAa,iBAAiB,KAAK,MAAM,GAAG,IAAI,cAAc;gBAEpE,wFAAwF;gBACxF,MAAM,YAAY,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK;gBAE9C,UAAU;oBACN,KAAK,KAAK,MAAM,GAAG;oBACnB,MAAM,KAAK,IAAI;oBACf,OAAO;oBACP,WAAW;gBACf;YACJ;QACJ;wCAAG;QAAC;KAAO;IAEX,MAAM,gBAAgB,CAAC;QACnB,EAAE,eAAe;QACjB,aAAa;IACjB;IAEA,MAAM,eAAe,CAAC;QAClB,MAAM,OAAO,UAAU,GAAG,CAAC;QAC3B,eAAe,KAAK;QACpB,UAAU;QACV,kBAAkB;QAClB,UAAU;IACd;IAEA,MAAM,eAAe,YAAY,WAAW,iBAAiB;IAE7D,MAAM,kBAAkB,QAAQ,MAAM,CAAC,CAAA,IACnC,KAAK,OAAO,MAAM,YAAY,EAAE,WAAW,GAAG,QAAQ,CAAC,aAAa,WAAW;IAGnF,qBACI,6LAAC;QAAI,KAAK;QAAY,WAAW,CAAC,SAAS,EAAE,aAAa,IAAI;;YAEzD,YAAY,0BACT,6LAAC;gBAAI,WAAU;;kCACX,6LAAC,mNAAM;wBAAC,WAAU;;;;;;kCAClB,6LAAC;wBACG,MAAK;wBACL,aAAa,iBAAiB;wBAC9B,WAAU;wBACV,OAAO;wBACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;wBACzC,SAAS,IAAM,UAAU;;;;;;kCAE7B,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCACG,SAAS;gCACT,WAAU;gCACV,OAAM;0CAEN,cAAA,6LAAC,gOAAS;oCAAC,MAAM;oCAAI,WAAW,YAAY,iBAAiB;;;;;;;;;;;0CAEjE,6LAAC,sOAAW;gCAAC,MAAM;gCAAI,WAAW,CAAC,iDAAiD,EAAE,SAAS,eAAe,IAAI;;;;;;;;;;;;;;;;;;YAM7H,YAAY,0BACT,6LAAC;gBACG,SAAS,IAAM,UAAU,CAAC;gBAC1B,WAAU;;kCAEV,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC;4BAAK,WAAW,CAAC,kBAAkB,EAAE,gBAAgB,uCAAuC,sCAAsC;sCAC9H,iBAAiB;;;;;;;;;;;kCAG1B,6LAAC,sOAAW;wBAAC,MAAM;wBAAI,WAAW,CAAC,8DAA8D,EAAE,SAAS,eAAe,IAAI;;;;;;;;;;;;YAKtI,UAAU,wBAAU,IAAA,oLAAY,gBAC7B,6LAAC;gBACG,KAAK;gBACL,WAAU;gBACV,OAAO;oBACH,KAAK,OAAO,GAAG;oBACf,MAAM,OAAO,IAAI;oBACjB,OAAO,OAAO,KAAK;oBACnB,WAAW,OAAO,SAAS;gBAC/B;;oBAIC,YAAY,0BACT,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC;4BAAI,WAAU;;8CACX,6LAAC,mNAAM;oCAAC,WAAU;;;;;;8CAClB,6LAAC;oCACG,SAAS;oCACT,MAAK;oCACL,aAAY;oCACZ,WAAU;oCACV,OAAO;oCACP,UAAU,CAAC,IAAM,kBAAkB,EAAE,MAAM,CAAC,KAAK;;;;;;8CAErD,6LAAC;oCACG,SAAS;oCACT,WAAU;8CAEV,cAAA,6LAAC,gOAAS;wCAAC,MAAM;wCAAI,WAAW,YAAY,iBAAiB;;;;;;;;;;;;;;;;;;;;;;kCAM7E,6LAAC;wBAAI,WAAU;;4BAEV,aAAa,QAAQ,MAAM,KAAK,mBAC7B,6LAAC;gCAAI,WAAU;0CAAuD;;;;;;4BAEzE,uBACG,6LAAC;gCAAI,WAAU;0CACV;;;;;;4BAGR,CAAC,aAAa,CAAC,SAAS,gBAAgB,MAAM,KAAK,mBAChD,6LAAC;gCAAI,WAAU;0CAAyC;;;;;;0CAM5D,6LAAC;gCAAI,WAAU;0CACV,gBAAgB,GAAG,CAAC,CAAA,oBACjB,6LAAC;wCAEG,SAAS,IAAM,aAAa;wCAC5B,WAAW,CAAC,mHAAmH,EAAE,kBAAkB,MAC7I,wDACA,gIACA;;0DAEN,6LAAC;0DAAM;;;;;;4CACN,kBAAkB,qBAAO,6LAAC;gDAAK,WAAU;;;;;;;uCARrC;;;;;;;;;;;;;;;;kCAcrB,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;;oCAAM,gBAAgB,MAAM;oCAAC;;;;;;;0CAC9B,6LAAC;0CAAK;;;;;;;;;;;;;;;;;0DAGd,SAAS,IAAI;;;;;;;AAI7B;;QA1MmE,oJAAc;;;;QAAd,oJAAc;;;;AA4MjF,cAAc,WAAW,GAAG"}},
    {"offset": {"line": 395, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/live/ChartSettingsDialog.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { X, RotateCcw, Activity, Monitor, ChevronDown } from 'lucide-react';\r\nimport { useChartTheme } from '../../context/ChartThemeContext';\r\nimport { ColorPalettePicker } from '../ui/ColorPalettePicker';\r\nimport { usePopoverPosition } from '../../hooks/ui/usePopoverPosition';\r\n\r\ninterface ChartSettingsDialogProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const ChartSettingsDialog: React.FC<ChartSettingsDialogProps> = ({ isOpen, onClose }) => {\r\n    const { theme, updateTheme, resetTheme } = useChartTheme();\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleUpdate = (section: keyof typeof theme, key: string, value: any) => {\r\n        updateTheme({\r\n            [section]: {\r\n                ...theme[section],\r\n                [key]: value\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleGridUpdate = (axis: 'vertLines' | 'horzLines', key: string, value: any) => {\r\n        updateTheme({\r\n            grid: {\r\n                ...theme.grid,\r\n                [axis]: {\r\n                    ...theme.grid[axis],\r\n                    [key]: value\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\">\r\n            <div className=\"w-[600px] bg-white dark:bg-slate-900 rounded-xl border border-slate-300 dark:border-slate-700 shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95 duration-200\">\r\n                {/* Header */}\r\n                <div className=\"h-12 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-6 bg-slate-50 dark:bg-slate-800/50\">\r\n                    <h2 className=\"font-semibold text-slate-900 dark:text-slate-200 text-lg\">Chart Settings</h2>\r\n                    <button onClick={onClose} className=\"p-1.5 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full transition-colors text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white\">\r\n                        <X size={18} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Single Content Area - Compact Layout */}\r\n                <div className=\"p-6 space-y-6 overflow-y-auto max-h-[600px]\">\r\n\r\n                    {/* Top Row: Candles & Background */}\r\n                    <div className=\"grid grid-cols-2 gap-8\">\r\n\r\n                        {/* Column 1: Candles */}\r\n                        <div className=\"space-y-3\">\r\n                            <SectionTitle>Symbol</SectionTitle>\r\n                            <div className=\"flex flex-col gap-1\">\r\n                                <div className=\"flex items-center justify-end gap-5 px-1 mb-1\">\r\n                                    <span className=\"text-[10px] uppercase font-bold text-slate-500 w-6 text-center\">Buy</span>\r\n                                    <span className=\"text-[10px] uppercase font-bold text-slate-500 w-6 text-center\">Sell</span>\r\n                                </div>\r\n                                <DualColorRow\r\n                                    label=\"Body\" upColor={theme.candles.upColor} downColor={theme.candles.downColor}\r\n                                    onUpChange={(c: string) => handleUpdate('candles', 'upColor', c)}\r\n                                    onDownChange={(c: string) => handleUpdate('candles', 'downColor', c)}\r\n                                />\r\n                                <DualColorRow\r\n                                    label=\"Borders\" upColor={theme.candles.borderUpColor} downColor={theme.candles.borderDownColor}\r\n                                    onUpChange={(c: string) => handleUpdate('candles', 'borderUpColor', c)}\r\n                                    onDownChange={(c: string) => handleUpdate('candles', 'borderDownColor', c)}\r\n                                />\r\n                                <DualColorRow\r\n                                    label=\"Wicks\" upColor={theme.candles.wickUpColor} downColor={theme.candles.wickDownColor}\r\n                                    onUpChange={(c: string) => handleUpdate('candles', 'wickUpColor', c)}\r\n                                    onDownChange={(c: string) => handleUpdate('candles', 'wickDownColor', c)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Column 2: Background, Crosshair, Text */}\r\n                        <div className=\"space-y-3\">\r\n                            <SectionTitle>Appearance</SectionTitle>\r\n                            <div className=\"flex flex-col gap-4 pt-6\"> {/* Align with rows roughly */}\r\n                                <ColorControl\r\n                                    label=\"Background\"\r\n                                    color={typeof theme.layout.background === 'string' ? theme.layout.background : theme.layout.background.color}\r\n                                    onChange={(c: string) => handleUpdate('layout', 'background', { type: 'solid', color: c })}\r\n                                />\r\n                                <ColorControl\r\n                                    label=\"Text Color\"\r\n                                    color={theme.layout.textColor}\r\n                                    onChange={(c: string) => handleUpdate('layout', 'textColor', c)}\r\n                                />\r\n                                <ColorControl\r\n                                    label=\"Crosshair\"\r\n                                    color={theme.crosshair.color}\r\n                                    onChange={(c: string) => handleUpdate('crosshair', 'color', c)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"h-px bg-slate-200 dark:bg-slate-800 w-full\" />\r\n\r\n                    {/* Middle Row: Grid */}\r\n                    <div className=\"space-y-3\">\r\n                        <SectionTitle>Grid Lines</SectionTitle>\r\n                        <div className=\"grid grid-cols-2 gap-8\">\r\n                            {/* Vert Grid */}\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={theme.grid.vertLines.visible}\r\n                                        onChange={(e) => handleGridUpdate('vertLines', 'visible', e.target.checked)}\r\n                                        className=\"w-3.5 h-3.5 rounded border-slate-400 dark:border-slate-600 bg-white dark:bg-slate-800 text-indigo-500 focus:ring-0 cursor-pointer\"\r\n                                    />\r\n                                    <span className=\"text-sm text-slate-700 dark:text-slate-300\">Vert. Grid</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <ColorControl compact color={theme.grid.vertLines.color} onChange={(c: string) => handleGridUpdate('vertLines', 'color', c)} />\r\n                                    <LineStyleDropdown value={theme.grid.vertLines.style} onChange={(s: number) => handleGridUpdate('vertLines', 'style', s)} />\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Horz Grid */}\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={theme.grid.horzLines.visible}\r\n                                        onChange={(e) => handleGridUpdate('horzLines', 'visible', e.target.checked)}\r\n                                        className=\"w-3.5 h-3.5 rounded border-slate-400 dark:border-slate-600 bg-white dark:bg-slate-800 text-indigo-500 focus:ring-0 cursor-pointer\"\r\n                                    />\r\n                                    <span className=\"text-sm text-slate-700 dark:text-slate-300\">Horz. Grid</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <ColorControl compact color={theme.grid.horzLines.color} onChange={(c: string) => handleGridUpdate('horzLines', 'color', c)} />\r\n                                    <LineStyleDropdown value={theme.grid.horzLines.style} onChange={(s: number) => handleGridUpdate('horzLines', 'style', s)} />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"h-px bg-slate-200 dark:bg-slate-800 w-full\" />\r\n\r\n                    {/* Bottom: Scales */}\r\n                    <div className=\"grid grid-cols-2 gap-8\">\r\n                        <div className=\"space-y-3\">\r\n                            <SectionTitle>Scales</SectionTitle>\r\n                            <div className=\"pt-2\">\r\n                                <ColorControl\r\n                                    label=\"Border Color\"\r\n                                    color={theme.timeScale.borderColor}\r\n                                    onChange={(c: string) => {\r\n                                        handleUpdate('timeScale', 'borderColor', c);\r\n                                        handleUpdate('priceScale', 'borderColor', c);\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"h-14 border-t border-slate-200 dark:border-slate-800 px-6 bg-slate-50 dark:bg-slate-900 flex justify-between items-center shrink-0\">\r\n                    <button\r\n                        onClick={() => { if (confirm('Reset all chart settings?')) resetTheme() }}\r\n                        className=\"flex items-center gap-2 text-slate-500 hover:text-slate-300 transition-colors text-xs font-medium\"\r\n                    >\r\n                        <RotateCcw size={14} /> Reset Defaults\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-1.5 rounded-lg font-medium transition-all shadow-lg shadow-indigo-500/20 active:scale-95 text-sm\"\r\n                    >\r\n                        OK\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n// --- SUB-COMPONENTS ---\r\n\r\nconst SectionTitle = ({ children }: { children: React.ReactNode }) => (\r\n    <h3 className=\"text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-widest\">{children}</h3>\r\n);\r\n\r\n// New Component: portal-based popup wrapper\r\nconst PortalPopup = ({ children, onClose, triggerRef, align = 'left' }: any) => {\r\n    const { top, left, contentRef } = usePopoverPosition({\r\n        triggerRef,\r\n        isOpen: true,\r\n        gap: 6,\r\n        contentHeight: 380 // Estimate, but dynamic will take over\r\n    });\r\n\r\n    if (typeof document === 'undefined') return null;\r\n\r\n    // Adjust for alignment if 'right' (requires width knowledge or CSS transforms)\r\n    // For now, left align is safer default.\r\n    return createPortal(\r\n        <>\r\n            <div className=\"fixed inset-0 z-[100]\" onClick={onClose} />\r\n            <div\r\n                ref={contentRef}\r\n                className=\"fixed z-[101]\"\r\n                style={{ top, left }}\r\n            >\r\n                {children}\r\n            </div>\r\n        </>,\r\n        document.body\r\n    );\r\n};\r\n\r\nconst ColorControl = ({ label, color, onChange, compact }: any) => {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const triggerRef = useRef<HTMLButtonElement>(null);\r\n\r\n    return (\r\n        <div className={`relative flex items-center justify-between group ${compact ? '' : 'w-full gap-4'}`}>\r\n            {!compact && <span className=\"text-sm text-slate-700 dark:text-slate-300 font-medium\">{label}</span>}\r\n\r\n            <button\r\n                ref={triggerRef}\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className=\"w-6 h-6 rounded border border-slate-300 dark:border-slate-600 p-0.5 hover:border-slate-400 dark:hover:border-slate-300 transition-colors relative overflow-hidden shrink-0 shadow-sm\"\r\n                title={label || color}\r\n            >\r\n                <div className=\"absolute inset-0 z-0 opacity-20\" style={{\r\n                    backgroundImage: `url(\"data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M3 0h3v3H3zM0 3h3v3H0z'/%3E%3C/g%3E%3C/svg%3E\")`\r\n                }} />\r\n                <div className=\"w-full h-full rounded-[1px] relative z-10\" style={{ backgroundColor: color }}></div>\r\n            </button>\r\n\r\n            {isOpen && (\r\n                <PortalPopup onClose={() => setIsOpen(false)} triggerRef={triggerRef}>\r\n                    <ColorPalettePicker\r\n                        color={color}\r\n                        onChange={(c: string) => { onChange(c); setIsOpen(false); }}\r\n                    />\r\n                </PortalPopup>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nconst DualColorRow = ({ label, upColor, downColor, onUpChange, onDownChange }: any) => {\r\n    return (\r\n        <div className=\"flex items-center justify-between py-1 px-1 hover:bg-slate-100 dark:hover:bg-slate-800/30 rounded\">\r\n            <span className=\"text-sm text-slate-700 dark:text-slate-300 font-medium\">{label}</span>\r\n            <div className=\"flex gap-2\">\r\n                <ColorControl compact color={upColor} onChange={onUpChange} />\r\n                <ColorControl compact color={downColor} onChange={onDownChange} />\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n// Compact Line Style Dropdown\r\nconst LineStyleDropdown = ({ value, onChange }: any) => {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const triggerRef = useRef<HTMLButtonElement>(null);\r\n\r\n    const styles = [\r\n        { val: 0, label: 'Solid', borderClass: 'border-b-2' },\r\n        { val: 1, label: 'Dotted', borderClass: 'border-b-2 border-dotted' },\r\n        { val: 2, label: 'Dashed', borderClass: 'border-b-2 border-dashed' },\r\n        { val: 3, label: 'L.Dash', borderClass: 'border-b-4 border-dashed' }, // Approximation\r\n    ];\r\n\r\n    const current = styles.find(s => s.val === value) || styles[0];\r\n\r\n    return (\r\n        <div className=\"relative\">\r\n            <button\r\n                ref={triggerRef}\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className=\"flex items-center gap-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded px-2 py-1 hover:border-slate-400 transition-colors h-6 w-20 justify-between\"\r\n            >\r\n                {/* Visual Preview */}\r\n                <div className={`w-8 h-px ${current.borderClass} translate-y-[1px] border-slate-700 dark:border-slate-300`}></div>\r\n                <ChevronDown size={12} className=\"text-slate-500 dark:text-slate-400\" />\r\n            </button>\r\n\r\n            {isOpen && (\r\n                <PortalPopup onClose={() => setIsOpen(false)} triggerRef={triggerRef}>\r\n                    <div className=\"bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded shadow-xl flex flex-col p-1 gap-0.5 w-32 animate-in zoom-in-95 duration-100\">\r\n                        {styles.map(s => (\r\n                            <button\r\n                                key={s.val}\r\n                                onClick={() => { onChange(s.val); setIsOpen(false); }}\r\n                                className={`flex items-center gap-3 px-3 py-2 text-xs rounded hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors\r\n                                    ${value === s.val ? 'text-indigo-600 dark:text-indigo-400 bg-slate-100 dark:bg-slate-700/50' : 'text-slate-700 dark:text-slate-300'}\r\n                                `}\r\n                            >\r\n                                <div className={`w-8 h-px ${s.borderClass} translate-y-[1px] border-slate-700 dark:border-slate-300`}></div>\r\n                                <span>{s.label}</span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </PortalPopup>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1195, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/live/LiveChartPage.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { WorkspaceShell } from '../workspaces/WorkspaceShell';\r\n\r\ntype ViewType = 'LIVE_COCKPIT' | 'LIVE_CHART' | 'ACCOUNTS' | 'SETTINGS' | 'STRATEGY_LAB';\r\n\r\ninterface LiveChartPageProps {\r\n    onNavigate?: (view: ViewType) => void;\r\n}\r\n\r\nexport default function LiveChartPage({ onNavigate }: LiveChartPageProps) {\r\n    const [accounts, setAccounts] = useState<any[]>([]);\r\n    const [datafeedBotId, setDatafeedBotId] = useState<string>('');\r\n    const [datafeedConfigError, setDatafeedConfigError] = useState<boolean>(false);\r\n    const [isDatafeedOnline, setIsDatafeedOnline] = useState(true);\r\n\r\n    // Fetch Configured Datafeed Bot & Accounts (Kept from original)\r\n    useEffect(() => {\r\n        const resolveDatafeedBot = async () => {\r\n            try {\r\n                const [accRes, brokerRes] = await Promise.all([\r\n                    fetch('/api/accounts'),\r\n                    fetch('/api/brokers')\r\n                ]);\r\n\r\n                if (accRes.ok && brokerRes.ok) {\r\n                    const accData = await accRes.json();\r\n                    const accountsList = Array.isArray(accData) ? accData : (accData.accounts || []);\r\n                    const brokers = await brokerRes.json();\r\n                    setAccounts(accountsList);\r\n\r\n                    const feedAccount = accountsList.find((a: any) => a.accountType === 'DATAFEED' || a.isDatafeed);\r\n\r\n                    if (feedAccount) {\r\n                        const broker = brokers.find((b: any) => b.id === feedAccount.brokerId);\r\n                        if (broker) {\r\n                            const shorthand = broker.shorthand.replace(/\\s+/g, '');\r\n                            let botId = `${shorthand}_${feedAccount.login}`;\r\n                            if (feedAccount.accountType === 'DATAFEED' || feedAccount.isDatafeed) {\r\n                                botId += '_DATAFEED';\r\n                            }\r\n                            setDatafeedBotId(botId);\r\n                            setDatafeedConfigError(false);\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n                setDatafeedConfigError(true);\r\n                setDatafeedBotId('');\r\n            } catch (e) {\r\n                console.error(\"Bot Resolution Error\", e);\r\n                setDatafeedConfigError(true);\r\n            }\r\n        };\r\n\r\n        const checkStatus = async () => {\r\n            try {\r\n                const res = await fetch(`http://127.0.0.1:3005/status/heartbeat`);\r\n                const data = await res.json();\r\n                if (data.success) {\r\n                    if (datafeedBotId) {\r\n                        const status = data.services[datafeedBotId];\r\n                        const alive = status?.alive === true;\r\n                        setIsDatafeedOnline(alive);\r\n                    } else {\r\n                        setIsDatafeedOnline(true);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                setIsDatafeedOnline(false);\r\n            }\r\n        };\r\n\r\n        resolveDatafeedBot();\r\n        checkStatus();\r\n\r\n        const timer = setInterval(() => {\r\n            resolveDatafeedBot();\r\n            checkStatus();\r\n        }, 5000);\r\n        return () => clearInterval(timer);\r\n    }, [datafeedBotId]);\r\n\r\n    return (\r\n        <WorkspaceShell\r\n            onNavigate={onNavigate}\r\n            accounts={accounts}\r\n            datafeedBotId={datafeedBotId}\r\n            isDatafeedOnline={isDatafeedOnline}\r\n            datafeedConfigError={datafeedConfigError}\r\n        />\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;AAQe,SAAS,cAAc,EAAE,UAAU,EAAsB;;IACpE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAQ,EAAE;IAClD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAS;IAC3D,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,IAAA,yKAAQ,EAAU;IACxE,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAC;IAEzD,gEAAgE;IAChE,IAAA,0KAAS;mCAAC;YACN,MAAM;8DAAqB;oBACvB,IAAI;wBACA,MAAM,CAAC,QAAQ,UAAU,GAAG,MAAM,QAAQ,GAAG,CAAC;4BAC1C,MAAM;4BACN,MAAM;yBACT;wBAED,IAAI,OAAO,EAAE,IAAI,UAAU,EAAE,EAAE;4BAC3B,MAAM,UAAU,MAAM,OAAO,IAAI;4BACjC,MAAM,eAAe,MAAM,OAAO,CAAC,WAAW,UAAW,QAAQ,QAAQ,IAAI,EAAE;4BAC/E,MAAM,UAAU,MAAM,UAAU,IAAI;4BACpC,YAAY;4BAEZ,MAAM,cAAc,aAAa,IAAI;0FAAC,CAAC,IAAW,EAAE,WAAW,KAAK,cAAc,EAAE,UAAU;;4BAE9F,IAAI,aAAa;gCACb,MAAM,SAAS,QAAQ,IAAI;yFAAC,CAAC,IAAW,EAAE,EAAE,KAAK,YAAY,QAAQ;;gCACrE,IAAI,QAAQ;oCACR,MAAM,YAAY,OAAO,SAAS,CAAC,OAAO,CAAC,QAAQ;oCACnD,IAAI,QAAQ,GAAG,UAAU,CAAC,EAAE,YAAY,KAAK,EAAE;oCAC/C,IAAI,YAAY,WAAW,KAAK,cAAc,YAAY,UAAU,EAAE;wCAClE,SAAS;oCACb;oCACA,iBAAiB;oCACjB,uBAAuB;oCACvB;gCACJ;4BACJ;wBACJ;wBACA,uBAAuB;wBACvB,iBAAiB;oBACrB,EAAE,OAAO,GAAG;wBACR,QAAQ,KAAK,CAAC,wBAAwB;wBACtC,uBAAuB;oBAC3B;gBACJ;;YAEA,MAAM;uDAAc;oBAChB,IAAI;wBACA,MAAM,MAAM,MAAM,MAAM,CAAC,sCAAsC,CAAC;wBAChE,MAAM,OAAO,MAAM,IAAI,IAAI;wBAC3B,IAAI,KAAK,OAAO,EAAE;4BACd,IAAI,eAAe;gCACf,MAAM,SAAS,KAAK,QAAQ,CAAC,cAAc;gCAC3C,MAAM,QAAQ,QAAQ,UAAU;gCAChC,oBAAoB;4BACxB,OAAO;gCACH,oBAAoB;4BACxB;wBACJ;oBACJ,EAAE,OAAO,GAAG;wBACR,oBAAoB;oBACxB;gBACJ;;YAEA;YACA;YAEA,MAAM,QAAQ;iDAAY;oBACtB;oBACA;gBACJ;gDAAG;YACH;2CAAO,IAAM,cAAc;;QAC/B;kCAAG;QAAC;KAAc;IAElB,qBACI,6LAAC,uKAAc;QACX,YAAY;QACZ,UAAU;QACV,eAAe;QACf,kBAAkB;QAClB,qBAAqB;;;;;;AAGjC;GAlFwB;KAAA"}}]
}