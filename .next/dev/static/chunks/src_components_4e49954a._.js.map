{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/MessageCard.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Message } from '../types';\r\nimport { ArrowUpCircle, ArrowDownCircle, Activity, Clock } from 'lucide-react';\r\n\r\n\r\n// Fallback utility if @/lib/utils is missing (common in initialized projects)\r\nfunction classNames(...classes: string[]) {\r\n    return classes.filter(Boolean).join(' ');\r\n}\r\n\r\ninterface MessageCardProps {\r\n    message: Message;\r\n}\r\n\r\nexport const MessageCard: React.FC<MessageCardProps> = ({ message }) => {\r\n    const { type, content, timestamp, symbol } = message;\r\n    const isSetup = type === 'TradingSetup';\r\n\r\n    // Extract details\r\n    const strategy = content.strategy || 'Unknown Strategy';\r\n    const status = content.status || ''; // Long / Short\r\n    const isLong = status.toLowerCase() === 'long' || content.direction === 'BUY' || content.direction === 'Long';\r\n    const isShort = status.toLowerCase() === 'short' || content.direction === 'SELL' || content.direction === 'Short';\r\n    const description = content.description || JSON.stringify(content);\r\n\r\n    // Format Time\r\n    const timeString = new Date(timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });\r\n\r\n    // Status Badge Logic\r\n    const getBadgeColor = () => {\r\n        if (isLong) return 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30';\r\n        if (isShort) return 'bg-rose-500/20 text-rose-400 border-rose-500/30';\r\n        return 'bg-slate-500/20 text-slate-400 border-slate-500/30';\r\n    };\r\n\r\n    const StatusIcon = isLong ? ArrowUpCircle : isShort ? ArrowDownCircle : Activity;\r\n\r\n    return (\r\n        <div className=\"group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700/50 p-4 shadow-lg transition-all hover:shadow-xl hover:border-slate-600 hover:-translate-y-0.5 animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n\r\n            {/* Glossy Effect */}\r\n            <div className=\"absolute inset-0 bg-gradient-to-tr from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\" />\r\n\r\n            <div className=\"relative flex justify-between items-start\">\r\n\r\n                {/* Left: Icon & Symbol */}\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className={classNames(\"p-2 rounded-lg border\", getBadgeColor())}>\r\n                        <StatusIcon size={20} />\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"text-slate-100 font-bold text-lg tracking-tight\">{symbol || 'Unknown'}</h3>\r\n                        <div className=\"flex items-center gap-2 text-xs text-slate-400\">\r\n                            <Clock size={12} />\r\n                            <span className=\"font-mono\">{timeString}</span>\r\n                            <span className=\"w-1 h-1 rounded-full bg-slate-600\" />\r\n                            <span>{message.botId}</span>\r\n                        </div>\r\n                        {/* Environment Badge */}\r\n                        {(message.environment === 'BACKTEST' || message.environment === 'TEST') && (\r\n                            <span className=\"mt-1 inline-block px-1.5 py-0.5 rounded text-[10px] bg-amber-500/10 text-amber-500 border border-amber-500/20\">\r\n                                STRATEGY TESTER\r\n                            </span>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right: Badge */}\r\n                <div className={classNames(\"px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wider border backdrop-blur-md\", getBadgeColor())}>\r\n                    {status || type}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content Body */}\r\n            <div className=\"mt-4 pl-[3.25rem]\">\r\n                <div className=\"text-sm font-medium text-slate-300 mb-1\">{strategy}</div>\r\n                <p className=\"text-xs text-slate-500 leading-relaxed font-mono line-clamp-3\">\r\n                    {isSetup ? description.replace(/,/g, '\\n') : JSON.stringify(content, null, 2)}\r\n                </p>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;;;AAGA,8EAA8E;AAC9E,SAAS,WAAW,GAAG,OAAiB;IACpC,OAAO,QAAQ,MAAM,CAAC,SAAS,IAAI,CAAC;AACxC;AAMO,MAAM,cAA0C,CAAC,EAAE,OAAO,EAAE;IAC/D,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG;IAC7C,MAAM,UAAU,SAAS;IAEzB,kBAAkB;IAClB,MAAM,WAAW,QAAQ,QAAQ,IAAI;IACrC,MAAM,SAAS,QAAQ,MAAM,IAAI,IAAI,eAAe;IACpD,MAAM,SAAS,OAAO,WAAW,OAAO,UAAU,QAAQ,SAAS,KAAK,SAAS,QAAQ,SAAS,KAAK;IACvG,MAAM,UAAU,OAAO,WAAW,OAAO,WAAW,QAAQ,SAAS,KAAK,UAAU,QAAQ,SAAS,KAAK;IAC1G,MAAM,cAAc,QAAQ,WAAW,IAAI,KAAK,SAAS,CAAC;IAE1D,cAAc;IACd,MAAM,aAAa,IAAI,KAAK,WAAW,kBAAkB,CAAC,EAAE,EAAE;QAAE,MAAM;QAAW,QAAQ;QAAW,QAAQ;IAAU;IAEtH,qBAAqB;IACrB,MAAM,gBAAgB;QAClB,IAAI,QAAQ,OAAO;QACnB,IAAI,SAAS,OAAO;QACpB,OAAO;IACX;IAEA,MAAM,aAAa,SAAS,gPAAa,GAAG,UAAU,sPAAe,GAAG,yNAAQ;IAEhF,qBACI,6LAAC;QAAI,WAAU;;0BAGX,6LAAC;gBAAI,WAAU;;;;;;0BAEf,6LAAC;gBAAI,WAAU;;kCAGX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAW,WAAW,yBAAyB;0CAChD,cAAA,6LAAC;oCAAW,MAAM;;;;;;;;;;;0CAEtB,6LAAC;;kDACG,6LAAC;wCAAG,WAAU;kDAAmD,UAAU;;;;;;kDAC3E,6LAAC;wCAAI,WAAU;;0DACX,6LAAC,gNAAK;gDAAC,MAAM;;;;;;0DACb,6LAAC;gDAAK,WAAU;0DAAa;;;;;;0DAC7B,6LAAC;gDAAK,WAAU;;;;;;0DAChB,6LAAC;0DAAM,QAAQ,KAAK;;;;;;;;;;;;oCAGvB,CAAC,QAAQ,WAAW,KAAK,cAAc,QAAQ,WAAW,KAAK,MAAM,mBAClE,6LAAC;wCAAK,WAAU;kDAAgH;;;;;;;;;;;;;;;;;;kCAQ5I,6LAAC;wBAAI,WAAW,WAAW,iGAAiG;kCACvH,UAAU;;;;;;;;;;;;0BAKnB,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;kCAA2C;;;;;;kCAC1D,6LAAC;wBAAE,WAAU;kCACR,UAAU,YAAY,OAAO,CAAC,MAAM,QAAQ,KAAK,SAAS,CAAC,SAAS,MAAM;;;;;;;;;;;;;;;;;;AAM/F;KArEa"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/ui/ColorPalettePicker.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Plus } from 'lucide-react';\r\n\r\ninterface ColorPalettePickerProps {\r\n    color: string; // Hex or RGBA\r\n    onChange: (color: string) => void;\r\n    label?: string;\r\n    opacity?: number;\r\n    onOpacityChange?: (opacity: number) => void;\r\n}\r\n\r\n\r\n// --- CONSTANTS (Exact TradingView Palette) ---\r\n\r\n// 1. Grayscale Row (10 Steps)\r\nconst TRADINGVIEW_GRAYSCALE = [\r\n    '#FFFFFF', '#D9D9D9', '#B7B7B7', '#929292', '#737373', '#525252', '#3F3F3F', '#2B2B2B', '#0D0D0D', '#000000'\r\n];\r\n\r\n// 2. Base Hues Row (Vibrant)\r\nconst TRADINGVIEW_BASE_HUES = [\r\n    '#D44E4D', '#EC9D3B', '#F1E452', '#6EB059', '#56967D', '#68C1D3', '#4E6CF3', '#6B40B7', '#9231AA', '#CD3F63'\r\n];\r\n\r\n// 3. Shade Matrix (6 Rows x 10 Cols)\r\nconst COLOR_GRID = [\r\n    // Row 1\r\n    ['#F1D4D3', '#F9E5C3', '#FBF8C9', '#D5E9CE', '#CFE5DD', '#D3EBF1', '#CFD9FB', '#D5CEE8', '#DEC7E6', '#ECC7D1'],\r\n    // Row 2\r\n    ['#E4AAAB', '#F4D294', '#F8F19E', '#B3D8AA', '#A6D3C3', '#AEE0E9', '#A8BAF8', '#B3A8DA', '#C399D5', '#E099AB'],\r\n    // Row 3\r\n    ['#D98586', '#EEBE6A', '#F4EB71', '#93C686', '#81C0AA', '#88D3E0', '#819BF4', '#9283CE', '#A86AC4', '#D36C89'],\r\n    // Row 4\r\n    ['#C14243', '#E8A232', '#EFDF46', '#67AB54', '#529A82', '#60C3D4', '#4F6AF1', '#6E45B9', '#8E2FA6', '#C63A62'],\r\n    // Row 5\r\n    ['#963131', '#B86F26', '#C2A52F', '#4F833F', '#3D7561', '#43909E', '#394EB1', '#513289', '#6B237C', '#972B49'],\r\n    // Row 6\r\n    ['#682221', '#BF5A2A', '#D78B39', '#3B612C', '#1B3C2D', '#336169', '#2B3D8A', '#29247E', '#4F1F83', '#731F41'],\r\n];\r\n\r\n\r\nexport const ColorPalettePicker: React.FC<ColorPalettePickerProps> = ({\r\n    color,\r\n    onChange,\r\n    label,\r\n    opacity = 100,\r\n    onOpacityChange\r\n}) => {\r\n    const [hex, setHex] = useState(color);\r\n\r\n    useEffect(() => {\r\n        setHex(color);\r\n    }, [color]);\r\n\r\n    const handleColorClick = (c: string) => {\r\n        setHex(c);\r\n        onChange(c);\r\n    };\r\n\r\n    const handleOpacityChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const val = parseInt(e.target.value);\r\n        if (onOpacityChange) onOpacityChange(val);\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-[340px] bg-white dark:bg-[#2A2E39] border border-slate-300 dark:border-[#363A45] rounded-xl shadow-2xl p-4 flex flex-col gap-4 select-none animate-in zoom-in-95 duration-100\">\r\n\r\n            {/* HEADER SECTION: Grayscale + Base Hues */}\r\n            <div className=\"flex flex-col gap-1.5\">\r\n                {/* 1. Grayscale Row (10 cols) */}\r\n                <div className=\"grid grid-cols-10 gap-1.5 place-items-center\">\r\n                    {TRADINGVIEW_GRAYSCALE.map(c => (\r\n                        <Swatch key={c} color={c} active={hex.toLowerCase() === c.toLowerCase()} onClick={handleColorClick} />\r\n                    ))}\r\n                </div>\r\n\r\n                {/* 2. Base Hues Row (10 cols) */}\r\n                <div className=\"grid grid-cols-10 gap-1.5 place-items-center\">\r\n                    {TRADINGVIEW_BASE_HUES.map(c => (\r\n                        <Swatch key={c} color={c} active={hex.toLowerCase() === c.toLowerCase()} onClick={handleColorClick} />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* SEPARATOR GAP */}\r\n            {/* The gap-4 on the parent handles spacing, but let's double check if we need extra visual separation here as requested. \r\n                User said: \"von diesen zwei reihen abgesetzt sind dann 6 reihen\" \r\n                The 'gap-4' is quite large (16px). Let's stick with that, it effectively separates the blocks. \r\n                Wait, previous impl had 'flex flex-col gap-4'. \r\n                I'll keep the gap-4 between the header block and the body block.\r\n            */}\r\n\r\n            {/* BODY SECTION: Shades Matrix (6 rows) */}\r\n            <div className=\"grid grid-cols-10 gap-1.5 place-items-center\">\r\n                {COLOR_GRID.map((row, rIdx) => (\r\n                    <React.Fragment key={rIdx}>\r\n                        {row.map((c, cIdx) => (\r\n                            <Swatch key={`${rIdx}-${cIdx}`} color={c} active={hex.toLowerCase() === c.toLowerCase()} onClick={handleColorClick} />\r\n                        ))}\r\n                    </React.Fragment>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"h-px bg-slate-200 dark:bg-[#363A45] w-full\" />\r\n\r\n            {/* 3. Bottom Controls */}\r\n            <div className=\"flex flex-col gap-3\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button\r\n                        className=\"w-8 h-8 rounded-full bg-slate-100 dark:bg-[#1E222D] border border-slate-300 dark:border-[#363A45] flex items-center justify-center text-slate-500 dark:text-[#B2B5BE] hover:text-black dark:hover:text-white hover:border-slate-400 dark:hover:border-[#5d606b] transition-colors\"\r\n                        title=\"Add Custom Color\"\r\n                    >\r\n                        <Plus size={16} />\r\n                    </button>\r\n\r\n                    <div className=\"flex-1 flex flex-col justify-center gap-1\">\r\n                        <div className=\"flex justify-between items-center text-[10px] uppercase font-bold text-slate-500 dark:text-[#787b86]\">\r\n                            <span>Opacity</span>\r\n                            <span>{opacity}%</span>\r\n                        </div>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"100\"\r\n                            value={opacity}\r\n                            onChange={handleOpacityChange}\r\n                            className=\"w-full h-1.5 rounded-full appearance-none cursor-pointer focus:outline-none\"\r\n                            style={{\r\n                                backgroundImage: `linear-gradient(to right, transparent, ${hex})`,\r\n                                backgroundColor: 'transparent',\r\n                                border: 'none'\r\n                            }}\r\n                        />\r\n                        <style jsx>{`\r\n                            input[type=range]::-webkit-slider-thumb {\r\n                                -webkit-appearance: none;\r\n                                height: 14px;\r\n                                width: 14px;\r\n                                border-radius: 50%;\r\n                                background: #ffffff;\r\n                                border: 2px solid #CBD5E1;\r\n                                cursor: pointer;\r\n                                box-shadow: 0 1px 3px rgba(0,0,0,0.5);\r\n                                margin-top: -5px; \r\n                            }\r\n                            input[type=range]::-moz-range-thumb {\r\n                                height: 14px;\r\n                                width: 14px;\r\n                                border-radius: 50%;\r\n                                background: #ffffff;\r\n                                border: 2px solid #CBD5E1;\r\n                                cursor: pointer;\r\n                                box-shadow: 0 1px 3px rgba(0,0,0,0.5);\r\n                            }\r\n                            input[type=range]::-webkit-slider-runnable-track {\r\n                                width: 100%;\r\n                                height: 4px;\r\n                                cursor: pointer;\r\n                                border-radius: 2px;\r\n                            }\r\n                        `}</style>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst Swatch = ({ color, active, onClick }: { color: string, active: boolean, onClick: (c: string) => void }) => (\r\n    <button\r\n        onClick={() => onClick(color)}\r\n        className={`w-6 h-6 rounded-[4px] cursor-pointer transition-transform hover:scale-110 relative\r\n            ${active ? 'ring-2 ring-blue-500 dark:ring-white z-10' : 'hover:brightness-110'}\r\n        `}\r\n        style={{ backgroundColor: color }}\r\n        title={color}\r\n    />\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 531, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/ui/SymbolAutocomplete.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Check, ChevronsUpDown, AlertTriangle } from \"lucide-react\";\r\nimport { usePopoverPosition } from \"../../hooks/ui/usePopoverPosition\";\r\n\r\nexport interface BrokerSymbol {\r\n    name: string;\r\n    path: string;\r\n    description: string;\r\n}\r\n\r\ninterface SymbolAutocompleteProps {\r\n    brokerId: string;\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n    placeholder?: string;\r\n    disabled?: boolean;\r\n    items?: (string | BrokerSymbol)[];\r\n    className?: string;\r\n}\r\n\r\nexport function SymbolAutocomplete({ brokerId, value, onChange, placeholder, disabled, items, className }: SymbolAutocompleteProps) {\r\n    const [open, setOpen] = useState(false);\r\n    const [query, setQuery] = useState(\"\");\r\n    const [symbols, setSymbols] = useState<BrokerSymbol[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [errorMessage, setErrorMessage] = useState<string>(\"\");\r\n\r\n    // Derived error state\r\n    const error = !!errorMessage;\r\n\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const wrapperRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Portal Positioning\r\n    const { top, left, contentRef } = usePopoverPosition({\r\n        triggerRef: wrapperRef as React.RefObject<HTMLElement>, // Cast for variance safety\r\n        isOpen: open,\r\n        gap: 4,\r\n        contentHeight: 200 // Approx max height\r\n    });\r\n\r\n    // Fetch symbols when brokerId changes, or use provided items\r\n    useEffect(() => {\r\n        if (items) {\r\n            // Use provided items\r\n            const normalized = items.map((s) => typeof s === 'string' ? { name: s, path: '', description: '' } : s);\r\n            setSymbols(normalized);\r\n            setErrorMessage(\"\");\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        if (!brokerId) {\r\n            setSymbols([]);\r\n            return;\r\n        }\r\n\r\n        const fetchSymbols = async () => {\r\n            setLoading(true);\r\n            setErrorMessage(\"\");\r\n            try {\r\n                const url = `/api/broker-symbols/${encodeURIComponent(brokerId)}`; // Fixed URL relative path\r\n                const res = await fetch(url);\r\n                if (!res.ok) throw new Error(`Status ${res.status}`);\r\n                const data = await res.json();\r\n\r\n                // Data might be strings or objects\r\n                const normalized = Array.isArray(data)\r\n                    ? data.map((s: any) => typeof s === 'string' ? { name: s, path: '', description: '' } : s)\r\n                    : [];\r\n\r\n                setSymbols(normalized);\r\n                if (normalized.length === 0) {\r\n                    // Valid but empty\r\n                }\r\n            } catch (e: any) {\r\n                console.error(\"Symbol fetch failed\", e);\r\n                setErrorMessage(e.message || \"Fetch Error\");\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchSymbols();\r\n    }, [brokerId, items]);\r\n\r\n    // Close on click outside (Portal friendly)\r\n    useEffect(() => {\r\n        function handleClickOutside(event: MouseEvent) {\r\n            // Check if click is inside input wrapper OR inside portal content\r\n            const clickedWrapper = wrapperRef.current && wrapperRef.current.contains(event.target as Node);\r\n\r\n            // Note: usePopoverPosition usually doesn't expose the content node directly for this check easily unless we store ref\r\n            // But we pass contentRef to the div, so we need to check if target is inside that div.\r\n            // However, since the div is in portal, we can't easily check 'contentRef.current.contains' because contentRef is a callback.\r\n            // Standard trick: use a separate ref sync or check if click is NOT in wrapper.\r\n            // Ideally usePopoverPosition or a 'useOnClickOutside' handles this better. \r\n            // Simplified: If we click outside the wrapper, we close. BUT clicking the portal list item shouldn't close immediately (handled by onClick).\r\n            // Clicking scrollbar of portal? \r\n\r\n            // Better approach: The portal has an overlay or we detect.\r\n            // For now, let's rely on standard logic:\r\n            if (!clickedWrapper && open) {\r\n                // If it's in the portal, don't close?\r\n                // The portal is attached to body. \r\n                // We'll trust the portal to handle its own events (e.g. item click).\r\n                // But clicking *elsewhere* should close.\r\n\r\n                // Hack: Check if target closest '.symbol-autocomplete-dropdown' exists\r\n                if ((event.target as Element).closest('.symbol-autocomplete-dropdown')) return;\r\n\r\n                setOpen(false);\r\n            }\r\n        }\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, [open]);\r\n\r\n    // Filter logic\r\n    const filteredSymbols = query === \"\"\r\n        ? symbols\r\n        : symbols.filter((s) =>\r\n            s.name.toLowerCase().includes(query.toLowerCase())\r\n        );\r\n\r\n    const isOffline = error || (symbols.length === 0 && !loading && brokerId && !items);\r\n\r\n    const inputWidth = wrapperRef.current?.offsetWidth || 200;\r\n\r\n    return (\r\n        <div className={`relative w-full ${className || ''}`} ref={wrapperRef}>\r\n            <div className=\"relative\">\r\n                <input\r\n                    ref={inputRef}\r\n                    disabled={disabled}\r\n                    className={`w-full bg-white dark:bg-slate-950 border rounded px-3 py-2 text-sm outline-none transition-all font-mono\r\n                        ${disabled ? \"opacity-30 cursor-not-allowed\" : \"cursor-text\"}\r\n                        ${isOffline\r\n                            ? \"border-amber-500/50 dark:border-amber-700/50 text-amber-600 dark:text-amber-200 placeholder:text-amber-400 dark:placeholder:text-amber-500/50 focus:border-amber-500\"\r\n                            : \"border-slate-200 dark:border-slate-700 text-slate-900 dark:text-emerald-300 placeholder:text-slate-400 dark:placeholder:text-slate-700 focus:border-blue-500 dark:focus:border-emerald-500\"\r\n                        }\r\n                    `}\r\n                    placeholder={isOffline ? \"Manual Input (Broker Offline)\" : (placeholder || \"Select Symbol...\")}\r\n                    value={(open ? query : value) || \"\"}\r\n                    onChange={(e) => {\r\n                        setQuery(e.target.value);\r\n                        if (isOffline) {\r\n                            onChange(e.target.value);\r\n                        } else {\r\n                            setOpen(true);\r\n                        }\r\n                    }}\r\n                    onFocus={() => {\r\n                        if (!disabled) {\r\n                            setOpen(true);\r\n                        }\r\n                    }}\r\n                />\r\n\r\n                {/* Icons */}\r\n                <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 pointer-events-none\">\r\n                    {loading && <div className=\"w-3 h-3 border-2 border-slate-600 border-t-emerald-500 rounded-full animate-spin\"></div>}\r\n                    {isOffline && !loading && !disabled && (\r\n                        <div title={`Offline/Error: ${errorMessage || \"No Symbols\"}`} className=\"flex items-center\">\r\n                            <AlertTriangle size={14} className=\"text-amber-500\" />\r\n                        </div>\r\n                    )}\r\n                    {!loading && !isOffline && !disabled && <ChevronsUpDown size={14} className=\"text-slate-600\" />}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Portal Dropdown */}\r\n            {open && !isOffline && !disabled && typeof document !== 'undefined' && createPortal(\r\n                <div\r\n                    ref={contentRef}\r\n                    className=\"fixed z-[100000] bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-md shadow-2xl max-h-60 overflow-auto animate-in fade-in zoom-in-95 duration-100 symbol-autocomplete-dropdown custom-scrollbar\"\r\n                    style={{\r\n                        top,\r\n                        left,\r\n                        width: inputWidth // Match input width\r\n                    }}\r\n                >\r\n                    {filteredSymbols.length === 0 ? (\r\n                        <div className=\"p-2 text-xs text-slate-500 text-center\">No symbols found.</div>\r\n                    ) : (\r\n                        filteredSymbols.map((s) => (\r\n                            <div\r\n                                key={s.name}\r\n                                className={`px-3 py-2 text-sm cursor-pointer flex items-center justify-between hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\r\n                                    ${value === s.name ? \"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400\" : \"text-slate-700 dark:text-slate-300\"}\r\n                                `}\r\n                                onClick={() => {\r\n                                    onChange(s.name);\r\n                                    setOpen(false);\r\n                                    setQuery(\"\");\r\n                                }}\r\n                            >\r\n                                <span className=\"font-mono\">{s.name}</span>\r\n                                {value === s.name && <Check size={14} className=\"text-emerald-500\" />}\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>,\r\n                document.body\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 813, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/data-history/HistoryTreeTable.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { ChevronRight, ChevronDown, Database, Clock } from 'lucide-react';\r\nimport { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nfunction cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n\r\nexport interface HistoryNode {\r\n    key: string;\r\n    data: {\r\n        name: string;\r\n        type: 'symbol' | 'timeframe';\r\n        min?: number; // timestamp\r\n        max?: number; // timestamp\r\n        count?: number;\r\n        status?: string; // 'CHECKING' | 'RESOLVING' | 'OK' | 'ERROR' | 'INCOMPLETE'\r\n        message?: string;\r\n    };\r\n    children?: HistoryNode[];\r\n}\r\n\r\ninterface HistoryTreeTableProps {\r\n    data: HistoryNode[];\r\n    onCheck?: (symbol: string, timeframe?: string) => void;\r\n}\r\n\r\nexport function HistoryTreeTable({ data, onCheck }: HistoryTreeTableProps) {\r\n    const [expandedKeys, setExpandedKeys] = useState<Set<string>>(new Set());\r\n\r\n    const toggleExpand = (key: string) => {\r\n        const newExpanded = new Set(expandedKeys);\r\n        if (newExpanded.has(key)) {\r\n            newExpanded.delete(key);\r\n        } else {\r\n            newExpanded.add(key);\r\n        }\r\n        setExpandedKeys(newExpanded);\r\n    };\r\n\r\n    const formatDate = (ts?: number) => {\r\n        if (!ts || ts === 0) return \"-\";\r\n        return new Date(ts).toLocaleString();\r\n    };\r\n\r\n    const renderStatus = (status?: string) => {\r\n        if (!status) return <span className=\"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-foreground border-gray-200 dark:border-gray-700 text-gray-500\">Idle</span>;\r\n\r\n        const badgeClass = \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-foreground \";\r\n\r\n        switch (status) {\r\n            case 'CHECKING':\r\n                return <span className={cn(badgeClass, \"border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 animate-pulse\")}>Checking...</span>;\r\n            case 'RESOLVING':\r\n                return <span className={cn(badgeClass, \"border-transparent bg-red-100 text-red-900 hover:bg-red-100/80 animate-pulse\")}>Resolving...</span>;\r\n            case 'OK':\r\n                return <span className={cn(badgeClass, \"border-transparent bg-green-500/10 text-green-600 border-green-500/20\")}>OK</span>;\r\n            case 'INCOMPLETE':\r\n                return <span className={cn(badgeClass, \"border-transparent bg-red-500 text-white hover:bg-red-500/80\")}>Incomplete</span>;\r\n            case 'ERROR':\r\n                return <span className={cn(badgeClass, \"border-transparent bg-red-900 text-white hover:bg-red-900/80\")}>Error</span>;\r\n            case 'OFFLINE':\r\n                return <span className={cn(badgeClass, \"border-transparent bg-gray-500 text-white hover:bg-gray-600\")}>Offline</span>;\r\n            default:\r\n                return <span className={cn(badgeClass, \"text-foreground\")}>{status}</span>;\r\n        }\r\n    };\r\n\r\n    const renderRow = (node: HistoryNode, level: number = 0) => {\r\n        const isExpanded = expandedKeys.has(node.key);\r\n        const hasChildren = node.children && node.children.length > 0;\r\n        const isSymbol = node.data.type === 'symbol';\r\n\r\n        return (\r\n            <React.Fragment key={node.key}>\r\n                <tr className={cn(\"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\", isSymbol ? \"bg-gray-50/20 dark:bg-gray-800/20 hover:bg-gray-100/30\" : \"\")}>\r\n                    <td className=\"p-2 align-middle [&:has([role=checkbox])]:pr-0 font-medium\">\r\n                        <div\r\n                            className=\"flex items-center gap-2 cursor-pointer select-none\"\r\n                            style={{ paddingLeft: `${level * 1.5}rem` }}\r\n                            onClick={() => hasChildren && toggleExpand(node.key)}\r\n                        >\r\n                            {hasChildren ? (\r\n                                isExpanded ? <ChevronDown className=\"h-4 w-4 text-gray-500\" /> : <ChevronRight className=\"h-4 w-4 text-gray-500\" />\r\n                            ) : (\r\n                                <span className=\"w-4\" /> // spacer\r\n                            )}\r\n\r\n                            {isSymbol ? (\r\n                                <Database className=\"h-4 w-4 text-primary\" />\r\n                            ) : (\r\n                                <Clock className=\"h-3 w-3 text-gray-500\" />\r\n                            )}\r\n\r\n                            <span className={cn(isSymbol ? \"font-semibold\" : \"text-gray-500\")}>\r\n                                {node.data.name}\r\n                            </span>\r\n                        </div>\r\n                    </td>\r\n                    <td className=\"p-2 align-middle [&:has([role=checkbox])]:pr-0\">{formatDate(node.data.min)}</td>\r\n                    <td className=\"p-2 align-middle [&:has([role=checkbox])]:pr-0\">{formatDate(node.data.max)}</td>\r\n                    <td className=\"p-2 align-middle [&:has([role=checkbox])]:pr-0\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {renderStatus(node.data.status)}\r\n                            {node.data.message && (\r\n                                <span className=\"text-xs text-gray-500 truncate max-w-[200px]\" title={node.data.message}>\r\n                                    {node.data.message}\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n                    </td>\r\n                    <td className=\"p-2 align-middle [&:has([role=checkbox])]:pr-0\">\r\n                        <button\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                if (onCheck) {\r\n                                    if (isSymbol) onCheck(node.key);\r\n                                    else {\r\n                                        const parts = node.key.split('-');\r\n                                        const tf = parts.pop();\r\n                                        const sym = parts.join('-');\r\n                                        onCheck(sym, tf);\r\n                                    }\r\n                                }\r\n                            }}\r\n                            className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\r\n                            title={isSymbol ? \"Check All Timeframes\" : \"Check This Timeframe\"}\r\n                        >\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"lucide lucide-play w-4 h-4 text-primary\"><polygon points=\"5 3 19 12 5 21 5 3\" /></svg>\r\n                        </button>\r\n                    </td>\r\n                </tr>\r\n\r\n                {isExpanded && node.children?.map(child => renderRow(child, level + 1))}\r\n            </React.Fragment>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"rounded-md border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#1E222D] h-full flex flex-col\">\r\n            <div className=\"w-full h-full overflow-auto\">\r\n                <table className=\"w-full caption-bottom text-sm relative\">\r\n                    <thead className=\"[&_tr]:border-b sticky top-0 bg-white dark:bg-[#1E222D] z-10 shadow-sm\">\r\n                        <tr className=\"border-b border-gray-200 dark:border-gray-800 transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\">\r\n                            <th className=\"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 w-[300px]\">Symbol / Timeframe</th>\r\n                            <th className=\"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\">Date From</th>\r\n                            <th className=\"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\">Date To</th>\r\n                            <th className=\"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 w-[80px]\">Action</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"[&_tr:last-child]:border-0\">\r\n                        {data.length === 0 ? (\r\n                            <tr>\r\n                                <td colSpan={5} className=\"p-2 align-middle [&:has([role=checkbox])]:pr-0 h-24 text-center\">\r\n                                    No data available.\r\n                                </td>\r\n                            </tr>\r\n                        ) : (\r\n                            data.map(node => renderRow(node))\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1207, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/data-history/SanityControls.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState } from 'react';\r\nimport { Play, Loader2 } from 'lucide-react';\r\nimport { clsx, type ClassValue } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nfunction cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n\r\ninterface SanityControlsProps {\r\n    onRunCheck: (startDate: string) => void;\r\n    isChecking: boolean;\r\n}\r\n\r\nexport function SanityControls({ onRunCheck, isChecking }: SanityControlsProps) {\r\n    // Default to 1 week ago\r\n    const getDefaultDate = () => {\r\n        const d = new Date();\r\n        d.setDate(d.getDate() - 7);\r\n        return d.toISOString().slice(0, 16); // Format: YYYY-MM-DDTHH:mm\r\n    };\r\n\r\n    const [startDate, setStartDate] = useState(getDefaultDate());\r\n\r\n    const handleRun = () => {\r\n        if (!startDate) {\r\n            alert(\"Please select a start date\");\r\n            return;\r\n        }\r\n        onRunCheck(startDate);\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full mb-6 rounded-xl border bg-card text-card-foreground shadow bg-white dark:bg-[#1E222D] border-gray-200 dark:border-gray-800\">\r\n            <div className=\"flex flex-col space-y-1.5 p-6 pb-3\">\r\n                <h3 className=\"font-semibold leading-none tracking-tight text-lg flex items-center gap-2\">\r\n                    Sanity Check Controls\r\n                </h3>\r\n            </div>\r\n            <div className=\"p-6 pt-0\">\r\n                <div className=\"flex flex-col sm:flex-row items-end gap-4\">\r\n                    <div className=\"flex flex-col gap-2 w-full sm:w-auto\">\r\n                        <label htmlFor=\"start-date\" className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\">Check From Date</label>\r\n                        <input\r\n                            id=\"start-date\"\r\n                            type=\"datetime-local\"\r\n                            value={startDate}\r\n                            onChange={(e) => setStartDate(e.target.value)}\r\n                            className={cn(\r\n                                \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\r\n                                \"border-gray-300 dark:border-gray-700 w-full sm:w-[250px]\"\r\n                            )}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col gap-2 flex-1\">\r\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">\r\n                            Last Reference Date (UTC): <span className=\"font-mono\">{new Date().toISOString().split('T')[0]} (Yesterday)</span>\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-400 dark:text-gray-500\">\r\n                            Checks data integrity from the selected date up to the end of yesterday (UTC).\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={() => window.open((window as any).API_URL ? `${(window as any).API_URL}/api/sanity-check/report` : 'http://localhost:3005/api/sanity-check/report', '_blank')}\r\n                        className={cn(\r\n                            \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\",\r\n                            \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\r\n                            \"h-9 px-4 py-2 w-full sm:w-auto text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n                        )}\r\n                    >\r\n                        Download Protocol\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={handleRun}\r\n                        disabled={isChecking}\r\n                        className={cn(\r\n                            \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\",\r\n                            \"bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90\",\r\n                            \"h-9 px-4 py-2 w-full sm:w-auto min-w-[140px]\"\r\n                        )}\r\n                    >\r\n                        {isChecking ? (\r\n                            <>\r\n                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                Checking...\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                <Play className=\"mr-2 h-4 w-4\" />\r\n                                Run Sanity Check\r\n                            </>\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AACA;;;AALA;;;;;AAOA,SAAS,GAAG,GAAG,MAAoB;IAC/B,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACxB;AAOO,SAAS,eAAe,EAAE,UAAU,EAAE,UAAU,EAAuB;;IAC1E,wBAAwB;IACxB,MAAM,iBAAiB;QACnB,MAAM,IAAI,IAAI;QACd,EAAE,OAAO,CAAC,EAAE,OAAO,KAAK;QACxB,OAAO,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG,KAAK,2BAA2B;IACpE;IAEA,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,MAAM,YAAY;QACd,IAAI,CAAC,WAAW;YACZ,MAAM;YACN;QACJ;QACA,WAAW;IACf;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAG,WAAU;8BAA4E;;;;;;;;;;;0BAI9F,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAM,SAAQ;oCAAa,WAAU;8CAA6F;;;;;;8CACnI,6LAAC;oCACG,IAAG;oCACH,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;oCAC5C,WAAW,GACP,yUACA;;;;;;;;;;;;sCAKZ,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAI,WAAU;;wCAAgD;sDAChC,6LAAC;4CAAK,WAAU;;gDAAa,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;gDAAC;;;;;;;;;;;;;8CAEnG,6LAAC;oCAAI,WAAU;8CAA2C;;;;;;;;;;;;sCAK9D,6LAAC;4BACG,SAAS,IAAM,OAAO,IAAI,CAAC,AAAC,OAAe,OAAO,GAAG,GAAG,AAAC,OAAe,OAAO,CAAC,wBAAwB,CAAC,GAAG,iDAAiD;4BAC7J,WAAW,GACP,uOACA,6FACA;sCAEP;;;;;;sCAID,6LAAC;4BACG,SAAS;4BACT,UAAU;4BACV,WAAW,GACP,uOACA,8FACA;sCAGH,2BACG;;kDACI,6LAAC,+NAAO;wCAAC,WAAU;;;;;;oCAA8B;;6DAIrD;;kDACI,6LAAC,6MAAI;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;;;;;;;;;;;;;;;;;;;AASjE;GAtFgB;KAAA"}},
    {"offset": {"line": 1403, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Michael/IdeaProjects/MSMTB/src/trading-cockpit/src/components/data-history/DataHistoryView.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState, useCallback, useRef } from 'react';\r\nimport { Socket } from 'socket.io-client';\r\nimport { socketService } from '../../services/socket';\r\nimport { HistoryTreeTable, HistoryNode } from './HistoryTreeTable';\r\nimport { SanityControls } from './SanityControls';\r\n\r\n// Config\r\nconst API_URL = 'http://localhost:3005'; // Correct backend port\r\n\r\ninterface SanityUpdate {\r\n    symbol: string;\r\n    timeframe?: string;\r\n    status?: string;\r\n    message?: string;\r\n}\r\n\r\nexport function DataHistoryView() {\r\n    const [data, setData] = useState<HistoryNode[]>([]);\r\n    const [isChecking, setIsChecking] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [activeJob, setActiveJob] = useState<{ id: string; status: string; progress: number; total: number; completed: number; } | null>(null);\r\n    const socketRef = useRef<Socket | null>(null);\r\n\r\n    // --- Initial Data Fetch ---\r\n    const fetchData = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const res = await fetch(`${API_URL}/api/data-history/stats`, { cache: 'no-store' });\r\n            if (!res.ok) throw new Error(\"Failed to fetch\");\r\n            const body = await res.json();\r\n            if (body.success) {\r\n                setData(body.stats);\r\n            } else {\r\n                console.error(\"Failed to load history stats: \" + body.error);\r\n            }\r\n\r\n            // Sync Sanity Job Status (Sanity 2.0)\r\n            const jobRes = await fetch(`${API_URL}/api/sanity/job/current`, { cache: 'no-store' });\r\n            if (jobRes.ok) {\r\n                const jobBody = await jobRes.json();\r\n                if (jobBody.success && jobBody.job) {\r\n                    setActiveJob({\r\n                        id: jobBody.job.id,\r\n                        status: jobBody.job.status,\r\n                        progress: jobBody.job.completedTasks / jobBody.job.totalTasks,\r\n                        total: jobBody.job.totalTasks,\r\n                        completed: jobBody.job.completedTasks\r\n                    });\r\n                    setIsChecking(true);\r\n                } else {\r\n                    // Fallback to legacy check status if no job but flag active?\r\n                    // Actually, if no job, we assume not checking.\r\n                    setActiveJob(null);\r\n\r\n                    // Legacy Check (for transitions)\r\n                    const statusRes = await fetch(`${API_URL}/api/sanity-check/status`, { cache: 'no-store' });\r\n                    if (statusRes.ok) {\r\n                        const sBody = await statusRes.json();\r\n                        setIsChecking(sBody.isChecking);\r\n                    } else {\r\n                        setIsChecking(false);\r\n                    }\r\n                }\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(\"Failed to connect to backend\", e);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    // --- Handle Real-time Updates ---\r\n    const handleSanityUpdate = (update: SanityUpdate) => {\r\n        setData(currentData => {\r\n            const newData = [...currentData];\r\n\r\n            // Find Symbol Node\r\n            const symbolNode = newData.find(n => n.key === update.symbol);\r\n            if (symbolNode) {\r\n                // If update is for specific timeframe\r\n                if (update.timeframe) {\r\n                    const tfKey = `${update.symbol}-${update.timeframe}`;\r\n                    const tfNode = symbolNode.children?.find(c => c.key === tfKey);\r\n                    if (tfNode) {\r\n                        tfNode.data = {\r\n                            ...tfNode.data,\r\n                            status: update.status,\r\n                            message: update.message\r\n                        };\r\n                    }\r\n                }\r\n                // Also update Symbol Status nicely (Aggregate?)\r\n                // Or if update is generic for symbol\r\n                if (!update.timeframe) { // Only symbol level update\r\n                    symbolNode.data = {\r\n                        ...symbolNode.data,\r\n                        status: update.status,\r\n                        message: update.message\r\n                    };\r\n                }\r\n            }\r\n            return newData;\r\n        });\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n\r\n        // --- Socket Connection ---\r\n        const socket = socketService.getSocket();\r\n\r\n        // No explicit connect() or disconnect() needed for Shared Socket.\r\n        // But we DO need to hook listeners.\r\n\r\n        if (socket.connected) {\r\n            console.log(\"Socket connected (Shared) for Data History\");\r\n        }\r\n\r\n        const onConnect = () => console.log(\"Socket connected (Shared) for Data History\");\r\n        socket.on('connect', onConnect);\r\n\r\n        // Events\r\n        const onSanityUpdate = (update: any) => handleSanityUpdate(update);\r\n        const onTaskUpdate = (update: any) => {\r\n            console.log(\"Task Update:\", update);\r\n            handleSanityUpdate(update);\r\n        };\r\n        const onJobUpdate = (job: any) => {\r\n            console.log(\"Job Update:\", job);\r\n            setActiveJob({\r\n                id: job.id,\r\n                status: job.status,\r\n                progress: job.progress,\r\n                total: job.total,\r\n                completed: job.completed\r\n            });\r\n\r\n            if (job.status === 'COMPLETED' || job.status === 'FAILED') {\r\n                setIsChecking(false);\r\n                setTimeout(() => {\r\n                    setActiveJob(null);\r\n                    fetchData(); // Refresh Data Stats to show final OK/Counts\r\n                }, 2000);\r\n            } else {\r\n                setIsChecking(true);\r\n            }\r\n        };\r\n\r\n        socket.on('sanity_update', onSanityUpdate);\r\n        socket.on('task_update', onTaskUpdate);\r\n        socket.on('job_update', onJobUpdate);\r\n\r\n        return () => {\r\n            // CLEANUP: Remove listeners to prevent leaks or double-handling\r\n            socket.off('connect', onConnect);\r\n            socket.off('sanity_update', onSanityUpdate);\r\n            socket.off('task_update', onTaskUpdate);\r\n            socket.off('job_update', onJobUpdate);\r\n            // DO NOT disconnect shared socket\r\n        };\r\n    }, [fetchData]);\r\n\r\n    const runSanityCheck = async (startDate: string) => {\r\n        setIsChecking(true);\r\n        try {\r\n            const res = await fetch(`${API_URL}/api/sanity-check/run`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ startTime: startDate })\r\n            });\r\n            const body = await res.json();\r\n            if (body.success) {\r\n                console.log(body.message);\r\n                // Maybe trigger a quick refresh of data too?\r\n            } else {\r\n                alert(\"Failed to start sanity check: \" + body.error);\r\n                setIsChecking(false);\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert(\"Network Error\");\r\n            setIsChecking(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"container mx-auto py-8 text-foreground h-full flex flex-col overflow-hidden\">\r\n            <div className=\"flex flex-col gap-2 mb-8 shrink-0\">\r\n                <h1 className=\"text-3xl font-bold tracking-tight\">Data History Management</h1>\r\n                <p className=\"text-gray-500 dark:text-gray-400\">\r\n                    View data availability ranges and running consistency checks.\r\n                </p>\r\n            </div>\r\n\r\n            <SanityControls onRunCheck={runSanityCheck} isChecking={isChecking} />\r\n\r\n            {activeJob && (\r\n                <div className=\"mb-6 p-4 rounded-lg border border-blue-200 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-800\">\r\n                    <div className=\"flex justify-between items-center mb-2\">\r\n                        <span className=\"text-sm font-semibold text-blue-700 dark:text-blue-300\">\r\n                            Job Running: {activeJob.status} ({activeJob.completed}/{activeJob.total} tasks)\r\n                        </span>\r\n                        <span className=\"text-xs text-blue-600 dark:text-blue-400\">\r\n                            {Math.round(activeJob.progress * 100)}%\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2.5\">\r\n                        <div\r\n                            className=\"bg-blue-600 h-2.5 rounded-full transition-all duration-500\"\r\n                            style={{ width: `${Math.max(5, activeJob.progress * 100)}%` }}\r\n                        ></div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {isLoading ? (\r\n                <div className=\"flex-1 flex items-center justify-center\">\r\n                    <div className=\"flex flex-col items-center gap-4\">\r\n                        <div className=\"w-8 h-8 rounded-full border-4 border-primary border-t-transparent animate-spin\" />\r\n                        <p className=\"text-muted-foreground text-sm\">Loading Data History...</p>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"flex-1 min-h-0 overflow-hidden\">\r\n                    <HistoryTreeTable\r\n                        data={data}\r\n                        onCheck={async (symbol, timeframe) => {\r\n                            if (isChecking) {\r\n                                alert(\"Check already in progress.\");\r\n                                return;\r\n                            }\r\n                            setIsChecking(true);\r\n\r\n                            // OPTIMISTIC UPDATE: Mark target as CHECKING immediately\r\n                            setData(prev => {\r\n                                const next = [...prev];\r\n                                const symNode = next.find(n => n.key === symbol);\r\n                                if (symNode) {\r\n                                    if (timeframe) {\r\n                                        // Update specific childcare\r\n                                        const tfKey = `${symbol}-${timeframe}`;\r\n                                        const child = symNode.children?.find(c => c.key === tfKey);\r\n                                        if (child) {\r\n                                            child.data = { ...child.data, status: 'CHECKING', message: 'Request sent...' };\r\n                                        }\r\n                                    } else {\r\n                                        // Update Symbol Node checks ALL (Visual feedback on parent?)\r\n                                        symNode.data = { ...symNode.data, status: 'CHECKING', message: 'Request sent...' };\r\n                                    }\r\n                                }\r\n                                return next;\r\n                            });\r\n\r\n                            try {\r\n                                const d = new Date();\r\n                                d.setDate(d.getDate() - 7);\r\n                                const startDate = d.toISOString().slice(0, 16);\r\n\r\n                                const res = await fetch(`${API_URL}/api/sanity-check/run`, {\r\n                                    method: 'POST',\r\n                                    headers: { 'Content-Type': 'application/json' },\r\n                                    body: JSON.stringify({\r\n                                        startTime: startDate,\r\n                                        symbol: symbol,\r\n                                        timeframe: timeframe\r\n                                    })\r\n                                });\r\n                                const body = await res.json();\r\n                                if (!body.success) {\r\n                                    alert(\"Failed: \" + body.error);\r\n                                    setIsChecking(false);\r\n                                }\r\n                            } catch (e) {\r\n                                console.error(e);\r\n                                setIsChecking(false);\r\n                            }\r\n                        }}\r\n                    />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}